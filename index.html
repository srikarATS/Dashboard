<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Dairy Management System - Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #0077b6;
            --secondary: #00b4d8;
            --dark: #caf0f8;
            --light: #ffffff;
            --text: #03045e;
            --success: #2a9d8f;
            --warning: #e9c46a;
            --danger: #e76f51;
            --gray: #adb5bd;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: var(--text);
        }

        /*Dark  Mode Styles*/
        .dark-mode {
            background-color: #1e1e2f;
            color: #f0f0f0;
        }

        .dark-mode .content-section {
            background-color: #2a2a40;
            border-color: #444;
        }

        .dark-mode input,
        .dark-mode select,
        .dark-mode textarea {
            background-color: #3a3a55;
            color: #fff;
            border-color: #555;
        }





        /* Retail Charts Container Styling */
        .stats-grid {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .stat-card {
            flex: 1 1 30%;
            padding: 20px;
            background: #ffffff;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: box-shadow 0.3s;
        }

        .stat-card:hover {
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
        }

        .stat-card h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #1e1e90;
            text-align: center;
        }

        /* Retail Summary Table */
        .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 14px;
            background-color: #fdfdfd;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .summary-table th,
        .summary-table td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid #ececec;
        }

        .summary-table th {
            background-color: #f2f2f2;
            color: #3f3f8f;
            font-weight: 600;
        }

        .summary-table td {
            color: #333;
        }

        .summary-table tr:last-child td {
            border-bottom: none;
        }


        /* ============ HEADER ============ */
        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 90px;
            background: #fff;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .hdr-left,
        .hdr-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .hdr-left button {
            font-size: 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            transition: transform 0.2s;
            color: var(--primary);
        }

        .hdr-left button:hover {
            transform: scale(1.1);
        }

        .hdr-logo {
            height: 60px;
            cursor: pointer;
            transition: transform 0.2s;
            width: 150px;
        }



        .hdr-search {
            padding: 8px 15px;
            border-radius: 6px;
            border: 1px solid #ccc;
            min-width: 200px;
            transition: all 0.3s;
        }

        .hdr-search:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }

        .hdr-icon {
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.2s;
            padding: 8px;
            border-radius: 50%;
            color: var(--text);
        }

        .hdr-icon:hover {
            background: #f3f4f6;
            transform: scale(1.1);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* Dropdown styles */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #fff;
            min-width: 160px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            z-index: 1;
            border-radius: 8px;
            padding: 8px 0;
            right: 0;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }

        .dropdown-item {
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .dropdown-item:hover {
            background-color: #f3f4f6;
        }

        .dropdown-btn {
            background: none;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 1rem;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.2s;
            color: var(--text);
        }

        .dropdown-btn:hover {
            background-color: #f3f4f6;
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }

        .dot.green {
            background: var(--success);
        }

        .dot.red {
            background: var(--danger);
        }

        .dot.gray {
            background: var(--gray);
        }

        /* Profile section */
        .profile-section {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .profile-section:hover {
            background-color: #f3f4f6;
        }

        .profile-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary);
        }

        .profile-name {
            font-weight: 600;
            margin-right: 5px;
        }

        /* Main container */
        .main-container {
            display: flex;
            margin-top: 2px;
            min-height: calc(100vh - 80px);
        }

        /* Sidebar styles */
        .sidebar {
            width: 320px;
            background: linear-gradient(180deg, #0f172a, #1e293b);
            /* Dark navy to slate */
            box-shadow: 3px 0 10px rgba(0, 0, 0, 0.15);
            padding: 25px 0;
            color: #e2e8f0;
            overflow-y: auto;
            transition: all 0.3s ease;
            border-right: 2px solid rgba(255, 255, 255, 0.05);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .sidebar-menu ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .sidebar-menu li {
            display: block;
            width: 100%;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 24px;
            color: #cbd5e1;
            text-decoration: none;
            font-size: 18px;
            font-weight: 600;
            border-left: 4px solid transparent;
            transition: all 0.3s ease;
            letter-spacing: 0.4px;
        }

        .sidebar-menu a i {
            min-width: 22px;
            text-align: center;
            font-size: 20px;
            color: #94a3b8;
            transition: color 0.3s ease;
        }

        .sidebar-menu a:hover {
            background-color: rgba(255, 255, 255, 0.08);
            color: #ffffff;
            border-left: 4px solid #3b82f6;
            transform: translateX(4px);
        }

        .sidebar-menu a:hover i {
            color: #3b82f6;
        }

        .sidebar-menu a.active {
            background-color: #1d4ed8;
            color: #ffffff;
            border-left: 4px solid #60a5fa;
        }

        .sidebar-menu a.active i {
            color: #ffffff;
        }

        /* ===== Indented Vertical Submenu ===== */
        .submenu {
            list-style: none;
            padding-left: 40px;
            /* Indent submenu items more */
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .submenu.show {
            max-height: 1000px;
            /* Allow expand */
        }

        .submenu li {
            display: block;
            width: 100%;
        }

        .submenu a {
            display: block;
            padding: 10px 24px;
            font-size: 16px;
            color: #9ca3af;
            font-weight: 500;
            border-left: none;
            background: none;
            margin-left: 30px;
            /* Extra left space for visual indentation */
            transition: all 0.3s ease;
        }

        .submenu a:hover {
            background-color: rgba(255, 255, 255, 0.06);
            color: #ffffff;
            transform: translateX(8px);
        }

        /* Dropdown Arrow for Expandable Menus */
        .has-submenu>a::after {
            content: '\f078';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            margin-left: auto;
            font-size: 0.75rem;
            color: #cbd5e1;
            transition: transform 0.3s ease, color 0.3s ease;
        }

        .has-submenu>a.expanded::after {
            transform: rotate(180deg);
            color: #3b82f6;
        }

        .sidebar.collapsed {
            transform: translateX(-100%);
        }

        .content-area {
            flex: 1;
            padding: 2px;
            background-color: #f5f7fa;
            overflow-y: auto;
        }

        /* Child section styles */
        .child-section {
            display: none;
            padding: 20px;
        }

        .child-section.active {
            display: block;
        }

        .back-button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 20px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            text-decoration: none;
            transition: background-color 0.3s;
        }

        .back-button:hover {
            background-color: var(--secondary);
        }

        .content-section {
            background-color: var(--light);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--dark);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--dark);
        }

        .section-title {
            color: var(--primary);
            font-size: 1.4rem;
        }

        .section-link {
            color: var(--primary);
            text-decoration: none;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: color 0.3s;
        }

        .section-link:hover {
            color: var(--secondary);
        }

        /* Table styles */
        .recent-orders {
            width: 100%;
            border-collapse: collapse;
        }

        .recent-orders th,
        .recent-orders td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--dark);
        }

        .recent-orders th {
            font-weight: 600;
            color: var(--primary);
            background-color: var(--dark);
        }

        .recent-orders tr:hover {
            background-color: var(--dark);
        }

        /* Status badges */
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status.completed {
            background-color: rgba(102, 187, 106, 0.1);
            color: var(--success);
        }

        .status.pending {
            background-color: rgba(239, 83, 80, 0.1);
            color: var(--danger);
        }

        .status.scheduled {
            background-color: rgba(66, 165, 245, 0.1);
            color: var(--secondary);
        }

        /* Buttons */
        .btn-primary {
            background-color: var(--primary);
            color: white;
            border-radius: 4px;
            padding: 8px 15px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn-primary:hover {
            background-color: #3949ab;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
            border-radius: 4px;
            padding: 8px 15px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn-success:hover {
            background-color: #43a047;
        }

        .edit-btn {
            background-color: var(--warning);
            color: #5d4037;
            border-radius: 4px;
            padding: 8px 15px;
            margin-top: 10px;
            font-weight: 500;
            border: none;
            cursor: pointer;
        }

        .edit-btn:hover {
            background-color: #fbc02d;
        }

        /* Profile form styles */
        .profile-grid {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .profile-grid label {
            font-size: 1.1rem;
            font-weight: bold;
            align-self: center;
            color: var(--primary);
        }

        .avatar-container {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            align-items: center;
        }

        .avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 36px;
            font-weight: bold;
            flex-shrink: 0;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }

        .avatar-input {
            display: none;
        }

        /* Form elements */
        input,
        textarea,
        select {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--dark);
            border-radius: 4px;
            margin-bottom: 10px;
            transition: border 0.3s;
            font-size: 1rem;
        }

        input:focus,
        textarea:focus,
        select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(92, 107, 192, 0.2);
        }

        input[readonly],
        textarea[readonly] {
            background-color: #f5f5f5;
            cursor: not-allowed;
        }

        /* Stats grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background-color: var(--light);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .stat-title {
            font-size: 0.9rem;
            font-weight: bold;
            color: black;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-change {
            font-size: 0.8rem;
            color: var(--success);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stat-change.down {
            color: var(--danger);
        }

        .stat-chart {
            height: 170px;
            margin-top: auto;
        }

        /* Activity list */
        .activity-list {
            list-style: none;
        }

        .activity-item {
            display: flex;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid var(--dark);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--dark);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .activity-time {
            font-size: 0.8rem;
            color: var(--gray);
        }

        /* Product cards */
        .top-products {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .product-card {
            background-color: var(--light);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .product-image {
            height: 120px;
            background-color: var(--dark);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .product-image img {
            max-width: 100%;
            max-height: 100%;
        }

        .product-info {
            padding: 15px;
        }

        .product-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .product-category {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 10px;
        }

        .product-stats {
            display: flex;
            justify-content: space-between;
        }

        .product-price {
            font-weight: 600;
            color: var(--primary);
        }

        .product-sales {
            font-size: 0.8rem;
            color: var(--gray);
        }

        /* Add these styles to your existing CSS */
        .activity-timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline-item {
            position: relative;
            padding-bottom: 20px;
        }

        .timeline-marker {
            position: absolute;
            left: -30px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .timeline-marker.success {
            background-color: var(--success);
        }

        .timeline-marker.warning {
            background-color: var(--warning);
        }

        .timeline-marker.danger {
            background-color: var(--danger);
        }

        .timeline-marker.info {
            background-color: var(--secondary);
        }

        .timeline-content {
            padding: 10px 15px;
            background-color: white;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .timeline-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .timeline-title {
            font-weight: 600;
        }

        .timeline-time {
            color: var(--gray);
            font-size: 0.8rem;
        }

        .timeline-details {
            font-size: 0.9rem;
            color: #555;
        }

        .permission-matrix {
            width: 100%;
            border-collapse: collapse;
        }

        .permission-matrix th,
        .permission-matrix td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid var(--dark);
        }

        .permission-matrix th {
            background-color: var(--dark);
            font-weight: 600;
        }

        .permission-matrix td:first-child {
            text-align: left;
            font-weight: 500;
        }

        .success {
            color: var(--success);
        }

        .danger {
            color: var(--danger);
        }

        /* Toggle switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            background-color: #ccc;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: var(--success);
        }

        input:checked+.slider:before {
            transform: translateX(24px);
        }

        /* Settings items */
        .setting-item {
            margin-bottom: 20px;
        }

        .setting-label {
            font-weight: bold;
            display: block;
            margin-bottom: 8px;
            font-size: 1.1rem;
            color: var(--primary);
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-group label {
            font-size: 1rem;
        }

        /* Responsive styles */
        @media (max-width: 992px) {
            .sidebar {
                position: fixed;
                top: 80px;
                bottom: 0;
                left: 0;
                transform: translateX(-100%);
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .content-area {
                margin-left: 0;
            }
        }

        /* Ensure proper scrolling */
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        .main-container {
            position: fixed;
            top: 80px;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            overflow: hidden;
        }

        .sidebar {
            height: 100%;
            overflow-y: auto;
        }

        .content-area {
            flex: 1;
            height: 100%;
            overflow-y: auto;
        }

        .feedback-theme {
            --primary: #9b5de5;
            --secondary: #f15bb5;
            --success: #00bbf9;
            --danger: #f71735;
            --warning: #ff9f1c;
        }

        .sidebar.collapsed {
            transform: translateX(-100%);
        }

        .content-area.expanded {
            margin-left: 0 !important;
            flex: 1;
        }


        .sidebar.collapsed {
            display: none !important;
        }

        .content-area.expanded {
            width: 100% !important;
            margin: 0 !important;
            padding: 20px;
        }


        #users-table th,
        #users-table td {
            padding: 12px 16px;
            text-align: left;
            vertical-align: top;
            border-bottom: 1px solid #eee;
        }

        #users-table th {
            background-color: #f8f8f8;
            color: #333;
            font-weight: 600;
        }

        #users-table td ul {
            padding-left: 20px;
            margin: 0;
            list-style-position: inside;
        }


        .delete-btn {
            background-color: #e74c3c;
            border: none;
            padding: 8px 12px;
            color: #fff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .delete-btn i {
            margin-right: 4px;
        }

        .delete-btn:hover {
            background-color: #c0392b;
        }


        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.2);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }

        .modal-box {
            background: #ffffff;
            padding: 24px;
            border-radius: 8px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            font-size: 13px;
        }

        .modal-box h3 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #1a237e;
        }

        .modal-box label {
            margin-top: 6px;
            margin-bottom: 3px;
            font-weight: 500;
            display: block;
        }

        .modal-box input,
        .modal-box select {
            padding: 6px 10px;
            font-size: 13px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 100%;
        }

        .modal-box button.btn-success {
            margin-top: 12px;
            padding: 8px 12px;
            font-size: 13px;
            background-color: #27ae60;
            color: #fff;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
        }

        .modal-box button.btn-success:hover {
            background-color: #219150;
        }

        #close-add-user-form-btn {
            font-size: 13px;
            padding: 6px 10px;
            margin-bottom: 8px;
        }

        .permissions-preview {
            background: #f4f6f8;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 10px;
            margin-top: 8px;
        }

        .permissions-preview strong {
            font-size: 13px;
            display: block;
            margin-bottom: 5px;
        }

        .permissions-preview ul {
            margin: 0;
            padding-left: 16px;
        }

        .permissions-preview li {
            font-size: 13px;
            line-height: 1.5;
        }

        /* Center the Actions column horizontally and vertically */
        #paymentsTable td.actions-cell,
        #paymentsTable th.actions-cell {
            text-align: center;
            vertical-align: middle;
        }

        #paymentsTable td.actions-cell button {
            min-width: 70px;
            margin: 0 2px;
            display: inline-block;
        }

        #feedbackComplaintsChart {
            max-width: 400px;
            max-height: 400px;
            margin: 20px auto;
            display: block;
        }

        .qc-chart-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-top: 30px;
            justify-content: space-around;
        }

        .qc-chart-box {
            flex: 1 1 400px;
            max-width: 480px;
            background: #ffffff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            text-align: center;
        }

        .qc-chart-title {
            font-size: 18px;
            color: #1e1e90;
            margin-bottom: 15px;
        }

        .dropdown {
            position: relative;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: #fff;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            z-index: 100;
            border-radius: 6px;
            overflow: hidden;
        }

        .dropdown.show .dropdown-content {
            display: block;
        }

        .dropdown-item {
            padding: 10px 15px;
            cursor: pointer;
        }

        .dropdown-item:hover {
            background: #f0f0f0;
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }

        .green {
            background: #2ecc71;
        }

        .red {
            background: #e74c3c;
        }

        .gray {
            background: #bdc3c7;
        }

        :root {
            --primary: #9B1352;
            --secondary: #C23373;
            --success: #C23373;
            --warning: #FDE6EF;
            --danger: #E63946;
            --dark: #333333;
            --light: #F8F9FA;
            --text: #333333;
            --background: #ffffff;
            --soft-pink: #FDE6EF;
        }

        /* Body Background */
        body {
            background-color: var(--background);
            color: var(--text);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Buttons */
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: #801043;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-success:hover {
            background-color: #a8225c;
        }

        .edit-btn {
            background-color: var(--secondary);
            color: white;
        }

        .edit-btn:hover {
            background-color: #a8225c;
        }

        .delete-btn {
            background-color: var(--danger);
        }

        .delete-btn:hover {
            background-color: #c62828;
        }

        /* Stats Cards */
        .stat-card {
            background-color: var(--light);
            border: 1px solid var(--primary);
            color: var(--text);
        }

        .stat-card h3,
        .stat-title {
            color: var(--primary);
        }

        .stat-change {
            color: var(--secondary);
        }

        .stat-change.down {
            color: var(--danger);
        }

        /* Tables */
        .summary-table th,
        .recent-orders th,
        .permission-matrix th {
            background-color: var(--primary);
            color: white;
        }

        .summary-table td,
        .recent-orders td,
        .permission-matrix td {
            color: #333;
        }

        .summary-table tr:hover,
        .recent-orders tr:hover,
        .permission-matrix tr:hover {
            background-color: var(--soft-pink);
            color: #333;
        }

        /* Section Titles */
        .section-title {
            color: var(--primary);
        }

        .section-link {
            color: var(--primary);
        }

        .section-link:hover {
            color: var(--secondary);
        }

        /* Sidebar */
        .sidebar {
            background-color: var(--primary);
            color: white;
            width: 280px
        }

        .sidebar-menu a {
            color: #fff5f5;
        }

        .sidebar-menu a:hover {
            background-color: #801043;
            color: white;
            border-left-color: var(--secondary);
        }

        .sidebar-menu a.active {
            background-color: #801043;
            color: white;
            border-left-color: var(--secondary);
        }

        .sidebar-menu a.active i {
            color: white;
        }

        /* Submenus */
        .submenu a {
            color: #fcddec;
        }

        .submenu a:hover {
            background-color: #801043;
            color: white;
        }

        /* Forms */
        input,
        textarea,
        select {
            border: 1px solid var(--primary);
        }

        input:focus,
        textarea:focus,
        select:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 2px rgba(155, 19, 82, 0.2);
        }

        .avatar {
            background-color: var(--primary);
            color: white;
        }

        /* Activity Icons */
        .activity-icon {
            background-color: var(--secondary);
            color: white;
        }

        /* Timeline Markers */
        .timeline-marker.success {
            background-color: var(--success);
        }

        .timeline-marker.warning {
            background-color: var(--warning);
        }

        .timeline-marker.danger {
            background-color: var(--danger);
        }

        .timeline-marker.info {
            background-color: var(--secondary);
        }

        /* Chart Container */
        .qc-chart-box {
            background-color: var(--light);
            border: 1px solid var(--secondary);
        }

        /* Table Status Badges */
        .status.completed {
            background-color: rgba(194, 51, 115, 0.1);
            color: var(--secondary);
        }

        .status.pending {
            background-color: rgba(230, 57, 70, 0.1);
            color: var(--danger);
        }

        .status.scheduled {
            background-color: rgba(155, 19, 82, 0.1);
            color: var(--primary);
        }

        /* Progress Bars */
        .progress-bar {
            background-color: var(--primary);
            color: white;
        }

        /* Modal Box */
        .modal-box {
            border: 2px solid var(--primary);
        }

        .modal-box h3 {
            color: var(--primary);
        }

        .sidebar {
            width: 80px;
            background-color: #0f172a;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: width 0.3s ease;
            overflow-x: hidden;
            overflow-y: auto;
            max-height: 100vh;
            scroll-behavior: smooth;

            /* Hide scrollbar for Webkit (Chrome, Safari) */
            scrollbar-width: none;
            /* Firefox */
            -ms-overflow-style: none;
            /* IE and Edge */
        }

        .sidebar::-webkit-scrollbar {
            display: none;
            /* Chrome, Safari, Opera */
        }


        .sidebar:hover {
            width: 280px;
        }



        .sidebar-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-menu li a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            gap: 15px;
            color: #e2e8f0;
            text-decoration: none;
            transition: background-color 0.3s ease;
        }

        .sidebar-menu li a i {
            font-size: 28px;
            width: 40px;
            text-align: center;
        }

        .sidebar-menu li a span {
            display: none;
            white-space: nowrap;
        }

        .sidebar:hover .sidebar-menu li a span {
            display: inline;
        }

        .sidebar-menu li a:hover {
            background-color: rgba(255, 255, 255, 0.08);
            color: white;
        }

        .sidebar-profile {
            padding: 15px;
            position: relative;
            text-align: center;
        }

        .sidebar-profile .profile-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #3b82f6;
            cursor: pointer;
        }

        .profile-dropdown {
            display: none;
            position: absolute;
            left: 80px;
            bottom: 60px;
            width: 180px;
            background: white;
            color: #000;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 10px;
            font-size: 14px;
            z-index: 100;
        }

        .sidebar-profile:hover .profile-dropdown {
            display: block;
        }

        .profile-dropdown a {
            display: block;
            color: #000;
            text-decoration: none;
            margin-top: 8px;
        }

        .profile-dropdown a:hover {
            color: #3b82f6;
        }

        .submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .submenu.open {
            max-height: 500px;
            /* enough height for submenu items */
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>

<body>
    <!-- Header/Navbar -->
    <header>
        <div class="hdr-left">
            <img alt="Logo" class="hdr-logo" onclick="showSection('dashboard-section')"
                src="https://www.astrolitetech.com/assets/images/logo.png" />
            <button id="menuToggle" class="menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <div class="hdr-right">
            <!-- Search -->
            <div class="hdr-center" style="flex: 1; display: flex; justify-content: center;">
                <input class="hdr-search" placeholder="Search..." type="text" style="width: 300px;" />
            </div>

            <!-- Notifications -->
            <i class="fas fa-bell hdr-icon"></i>
            <i class="fas fa-envelope hdr-icon"></i>


            <!-- LANGUAGE DROPDOWN -->
            <div class="dropdown" id="languageDropdownWrapper" style="position: relative;">
                <button class="dropdown-btn" id="languageButton">
                    <img id="languageFlag" src="https://flagcdn.com/w20/gb.png" width="20" />
                    <span id="languageLabel">EN</span>
                    <i class="fas fa-chevron-down"></i>
                </button>

                <div class="dropdown-content" id="languageDropdown"
                    style="display: none; position: absolute; top: 100%; background: white; border: 1px solid #ccc; z-index: 100;">
                    <div class="dropdown-item" data-lang="en" style="cursor: pointer;">
                        <img src="https://flagcdn.com/w20/gb.png" width="20" style="margin-right: 8px;" /> English
                    </div>
                    <div class="dropdown-item" data-lang="es" style="cursor: pointer;">
                        <img src="https://flagcdn.com/w20/es.png" width="20" style="margin-right: 8px;" /> Español
                    </div>
                    <div class="dropdown-item" data-lang="fr" style="cursor: pointer;">
                        <img src="https://flagcdn.com/w20/fr.png" width="20" style="margin-right: 8px;" /> Français
                    </div>
                    <div class="dropdown-item" data-lang="de" style="cursor: pointer;">
                        <img src="https://flagcdn.com/w20/de.png" width="20" style="margin-right: 8px;" /> Deutsch
                    </div>
                </div>
            </div>


            <!-- STATUS DROPDOWN -->
            <div class="dropdown" id="statusDropdownWrapper">
                <button class="dropdown-btn" id="statusButton">
                    <span id="statusDot" class="dot green"></span>
                    <span id="statusLabel">Active</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="dropdown-content" id="statusDropdown">
                    <div class="dropdown-item" data-status="active"><span class="dot green"></span> Active</div>
                    <div class="dropdown-item" data-status="away"><span class="dot gray"></span> Away</div>
                    <div class="dropdown-item" data-status="busy"><span class="dot red"></span> Busy</div>
                    <div class="dropdown-item" data-status="offline"><span class="dot gray"></span> Offline</div>
                </div>
            </div>

            <!-- User Profile -->
            <div class="profile-section" id="userProfile" onclick="showSection('profile-section')">
                <span class="profile-name">John Doe</span>
                <div class="user-avatar">
                    <img class="profile-img"
                        src="https://t4.ftcdn.net/jpg/02/14/74/61/360_F_214746128_31JkeaP6rU0NzzzdFC4khGkmqc8noe6h.jpg"
                        alt="User Profile" />
                    <span class="status-indicator status-active"></span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <div class="main-container">
        <!-- Left Sidebar -->
        <div class="sidebar" id="sidebar">

            <!-- Sidebar Menu -->
            <div class="sidebar-menu">
                <ul>
                    <li><a class="nav-link active" data-section="dashboard-section" href="#"><i
                                class="fas fa-tachometer-alt"></i><span>Dashboard</span></a></li>
                    <li><a class="nav-link" data-section="profile-section" href="#"><i class="fas fa-user"></i><span>My
                                Profile</span></a></li>

                    <li class="has-submenu">
                        <a class="nav-link" data-section="farmer-management-section" href="#"><i
                                class="fas fa-user-tie"></i><span>Farmer Management</span></a>
                        <ul class="submenu">
                            <li><a class="nav-link" data-section="farmer-registration-section" href="#"><i
                                        class="fas fa-user-plus"></i>Registration</a></li>
                            <li><a class="nav-link" data-section="payments-section" href="#"><i
                                        class="fas fa-rupee-sign"></i>Payments</a></li>
                        </ul>
                    </li>

                    <li class="has-submenu">
                        <a class="nav-link" data-section="milk-collection-section" href="#"><i
                                class="fas fa-faucet"></i><span>Milk Collection</span></a>
                        <ul class="submenu">
                            <li><a class="nav-link" data-section="collection-schedule-section" href="#"><i
                                        class="fas fa-calendar-alt"></i>Collection Schedule</a></li>
                            <li><a class="nav-link" data-section="quality-testing-section" href="#"><i
                                        class="fas fa-vial"></i>Quality Testing</a></li>
                        </ul>
                    </li>

                    <li class="has-submenu">
                        <a class="nav-link" data-section="chilling-centers-section" href="#"><i
                                class="fas fa-warehouse"></i><span>Chilling Centers</span></a>
                        <ul class="submenu">
                            <li><a class="nav-link" data-section="inventory-section" href="#"><i
                                        class="fas fa-box"></i>Inventory</a></li>
                        </ul>
                    </li>

                    <li class="has-submenu">
                        <a class="nav-link" data-section="processing-plants-section" href="#"><i
                                class="fas fa-industry"></i><span>Processing Plants</span></a>
                        <ul class="submenu">
                            <li><a class="nav-link" data-section="production-lines-section" href="#"><i
                                        class="fas fa-cogs"></i>Production Lines</a></li>
                        </ul>
                    </li>

                    <li class="has-submenu">
                        <a class="nav-link" data-section="quality-control-section" href="#"><i
                                class="fas fa-flask"></i><span>Quality Control</span></a>
                        <ul class="submenu">
                            <li><a class="nav-link" data-section="feedbackComplaintsSection" href="#"><i
                                        class="fas fa-comment-dots"></i>Feedback & Complaints</a></li>
                        </ul>
                    </li>

                    <li class="has-submenu">
                        <a class="nav-link" data-section="product-inventory-section" href="#"><i
                                class="fas fa-boxes"></i><span>Product Inventory</span></a>
                        <ul class="submenu">
                            <li><a class="nav-link" data-section="inventory-movements-section" href="#"><i
                                        class="fas fa-exchange-alt"></i>Inventory Movements</a></li>
                        </ul>
                    </li>

                    <li class="has-submenu">
                        <a class="nav-link" data-section="distribution-section" href="#"><i
                                class="fas fa-truck"></i><span>Distribution</span></a>
                        <ul class="submenu">
                            <li><a class="nav-link" data-section="delivery-routes-section" href="#"><i
                                        class="fas fa-route"></i>Delivery Routes</a></li>
                            <li><a class="nav-link" data-section="fleet-management-section" href="#"><i
                                        class="fas fa-truck-moving"></i>Fleet Management</a></li>
                        </ul>
                    </li>

                    <li class="has-submenu">
                        <a class="nav-link" data-section="retail-section" href="#"><i
                                class="fas fa-store"></i><span>Retail</span></a>
                        <ul class="submenu">
                            <li><a class="nav-link" data-section="retail-outlets-section" href="#"><i
                                        class="fas fa-store-alt"></i>Retail Outlets</a></li>
                            <li><a class="nav-link" data-section="sales-data-section" href="#"><i
                                        class="fas fa-chart-line"></i>Sales Data</a></li>
                        </ul>
                    </li>

                    <li class="has-submenu">
                        <a class="nav-link" data-section="reports-section" href="#"><i
                                class="fas fa-chart-pie"></i><span>Reports</span></a>
                        <ul class="submenu">
                            <li><a class="nav-link" onclick="showSection('financial-reports-section')" href="#"><i
                                        class="fas fa-file-invoice-dollar"></i>Financial Reports</a></li>
                        </ul>
                    </li>

                    <li class="has-submenu">
                        <a class="nav-link" data-section="settings-section" href="#"><i
                                class="fas fa-cog"></i><span>Settings</span></a>
                        <ul class="submenu">
                            <li><a class="nav-link" data-section="user-management-section" href="#"><i
                                        class="fas fa-users-cog"></i>User Management</a></li>
                            <li><a class="nav-link" data-section="system-settings-section" href="#"><i
                                        class="fas fa-sliders-h"></i>System Settings</a></li>
                        </ul>
                    </li>
                </ul>
            </div>


        </div>

        <!-- Right Content Area -->
        <div class="content-area">
            <!-- Dashboard Section -->
            <div class="child-section active" id="dashboard-section">

                <div class="section-header"
                    style="margin-bottom: 20px; padding: 15px 20px; border-radius: 6px; background-color: #f3e5f5; border: 1px solid #e1bee7; box-shadow: 0 2px 6px rgba(0,0,0,0.05); display: flex; flex-direction: column; gap: 6px;">
                    <h1 class="section-title" style="margin: 0 0 8px 0; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-tachometer-alt" style="color: #6a1b9a;"></i>
                        Dashboard Overview
                    </h1>

                </div>




                <div class="stats-grid"
                    style="display: flex; flex-wrap: wrap; justify-content: space-between; gap: 20px;">
                    <div class="stat-card" style="flex: 1 1 calc(33.33% - 20px); box-sizing: border-box;">
                        <h3>Total Farmers</h3>
                        <div class="stat-value">5,247</div>
                        <div class="stat-change"><i class="fas fa-arrow-up"></i> +5.2%</div>
                    </div>
                    <div class="stat-card" style="flex: 1 1 calc(33.33% - 20px); box-sizing: border-box;">
                        <h3>Milk Collected Today</h3>
                        <div class="stat-value">12,430 L</div>
                        <div class="stat-change">+2.1%</div>
                    </div>
                    <div class="stat-card" style="flex: 1 1 calc(33.33% - 20px); box-sizing: border-box;">
                        <h3>Avg. Fat %</h3>
                        <div class="stat-value">3.9%</div>
                        <div class="stat-change">Stable</div>
                    </div>
                    <div class="stat-card" style="flex: 1 1 calc(33.33% - 20px); box-sizing: border-box;">
                        <h3>Total Payments (This Month)</h3>
                        <div class="stat-value">₹18,22,000</div>
                        <div class="stat-change">+6.5%</div>
                    </div>
                    <div class="stat-card" style="flex: 1 1 calc(33.33% - 20px); box-sizing: border-box;">
                        <h3>Pending Payments</h3>
                        <div class="stat-value">₹3,50,000</div>
                        <div class="stat-change down">-1.8%</div>
                    </div>
                    <div class="stat-card" style="flex: 1 1 calc(33.33% - 20px); box-sizing: border-box;">
                        <h3>Complaints</h3>
                        <div class="stat-value">12</div>
                        <div class="stat-change"><i class="fas fa-arrow-up"></i> +2</div>
                    </div>
                </div>


                <!-- First Row: Two Charts with Fixed Width -->
                <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; margin-bottom: 30px;">
                    <div class="content-section" style="width: 610px; box-sizing: border-box;">
                        <div class="section-header">
                            <h2 class="section-title">Milk Collection Trend</h2>
                        </div>
                        <canvas id="milkChart" width="600" height="350"></canvas>
                    </div>

                    <div class="content-section" style="width: 610px; box-sizing: border-box;">
                        <div class="section-header"
                            style="display: flex; justify-content: space-between; align-items: center;">
                            <h2 class="section-title">Farmer Income Overview</h2>
                            <button class="btn-primary" id="exportIncomeChart">
                                <i class="fas fa-file-export"></i> Export Chart
                            </button>
                        </div>
                        <canvas id="incomeBarChart" width="600" height="350"></canvas>
                    </div>
                </div>


                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Delivery Timelines</h2>
                    </div>
                    <ul class="activity-timeline">
                        <li class="timeline-item">
                            <div class="timeline-marker success"></div>
                            <div class="timeline-content">
                                <div class="timeline-header">
                                    <span class="timeline-title">Route #101 - Completed</span>
                                    <span class="timeline-time">Today 8:00 AM</span>
                                </div>
                                <div class="timeline-details">Delivered to 6 outlets in 3.5 hrs</div>
                            </div>
                        </li>
                        <li class="timeline-item">
                            <div class="timeline-marker warning"></div>
                            <div class="timeline-content">
                                <div class="timeline-header">
                                    <span class="timeline-title">Route #88 - Delayed</span>
                                    <span class="timeline-time">Today 9:15 AM</span>
                                </div>
                                <div class="timeline-details">Traffic delay at Sector 7</div>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Quick Access</h2>
                    </div>
                    <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                        <button class="btn-primary" onclick="showSection('farmer-management-section')"><i
                                class="fas fa-user-tie"></i> Farmer Management</button>
                        <button class="btn-primary" onclick="showSection('payments-section')"><i
                                class="fas fa-rupee-sign"></i> Payments</button>
                        <button class="btn-primary" onclick="showSection('milk-collection-section')"><i
                                class="fas fa-faucet"></i> Milk Collection</button>
                        <button class="btn-primary" onclick="showSection('fleet-management-section')"><i
                                class="fas fa-truck-moving"></i> Fleet Management</button>
                    </div>
                </div>
                <!-- Top Products Section -->
                <div class="content-section">
                    <div class="section-header"
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 class="section-title" style="margin: 0;">Top Dairy Products</h2>
                    </div>

                    <div class="top-products"
                        style="display: flex; flex-wrap: wrap; gap: 20px; justify-content: space-between;">
                        <!-- Product Card 1 -->
                        <div class="product-card"
                            style="flex: 1 1 calc(25% - 15px); border: 1px solid #ddd; border-radius: 8px; overflow: hidden; background: #fff;">
                            <div class="product-image" style="width: 100%; height: 180px; overflow: hidden;">
                                <img alt="Standard Milk"
                                    src="https://www.bbassets.com/media/uploads/p/xxl/40151386_2-dodla-standardised-milk.jpg"
                                    style="width: 100%; height: 100%; object-fit: cover;" />
                            </div>
                            <div class="product-info" style="padding: 15px;">
                                <h3 class="product-name" style="margin: 0 0 5px;">Standard Milk</h3>
                                <p class="product-category" style="margin: 0 0 10px; color: #777;">Liquid Milk</p>
                                <div class="product-stats"
                                    style="display: flex; justify-content: space-between; font-weight: bold;">
                                    <span class="product-price">₹45/L</span>
                                    <span class="product-sales">1,200 sales</span>
                                </div>
                            </div>
                        </div>

                        <!-- Product Card 2 -->
                        <div class="product-card"
                            style="flex: 1 1 calc(25% - 15px); border: 1px solid #ddd; border-radius: 8px; overflow: hidden; background: #fff;">
                            <div class="product-image" style="width: 100%; height: 180px; overflow: hidden;">
                                <img alt="Toned Milk"
                                    src="https://www.bbassets.com/media/uploads/p/l/40149826_2-dodla-toned-milk.jpg"
                                    style="width: 100%; height: 100%; object-fit: cover;" />
                            </div>
                            <div class="product-info" style="padding: 15px;">
                                <h3 class="product-name" style="margin: 0 0 5px;">Toned Milk</h3>
                                <p class="product-category" style="margin: 0 0 10px; color: #777;">Liquid Milk</p>
                                <div class="product-stats"
                                    style="display: flex; justify-content: space-between; font-weight: bold;">
                                    <span class="product-price">₹40/L</span>
                                    <span class="product-sales">950 sales</span>
                                </div>
                            </div>
                        </div>

                        <!-- Product Card 3 -->
                        <div class="product-card"
                            style="flex: 1 1 calc(25% - 15px); border: 1px solid #ddd; border-radius: 8px; overflow: hidden; background: #fff;">
                            <div class="product-image" style="width: 100%; height: 180px; overflow: hidden;">
                                <img alt="Ghee"
                                    src="https://www.bigbasket.com/media/uploads/p/xxl/40058589_6-dodla-pure-cow-ghee-rich-natural-aroma.jpg"
                                    style="width: 100%; height: 100%; object-fit: cover;" />
                            </div>
                            <div class="product-info" style="padding: 15px;">
                                <h3 class="product-name" style="margin: 0 0 5px;">Pure Ghee</h3>
                                <p class="product-category" style="margin: 0 0 10px; color: #777;">Dairy Fat</p>
                                <div class="product-stats"
                                    style="display: flex; justify-content: space-between; font-weight: bold;">
                                    <span class="product-price">₹500/kg</span>
                                    <span class="product-sales">320 sales</span>
                                </div>
                            </div>
                        </div>

                        <!-- Product Card 4 -->
                        <div class="product-card"
                            style="flex: 1 1 calc(25% - 15px); border: 1px solid #ddd; border-radius: 8px; overflow: hidden; background: #fff;">
                            <div class="product-image" style="width: 100%; height: 180px; overflow: hidden;">
                                <img alt="Paneer"
                                    src="https://www.bigbasket.com/media/uploads/p/l/40221064_1-dodla-paneer-rich-in-protein.jpg"
                                    style="width: 100%; height: 100%; object-fit: cover;" />
                            </div>
                            <div class="product-info" style="padding: 15px;">
                                <h3 class="product-name" style="margin: 0 0 5px;">Fresh Paneer</h3>
                                <p class="product-category" style="margin: 0 0 10px; color: #777;">Cheese</p>
                                <div class="product-stats"
                                    style="display: flex; justify-content: space-between; font-weight: bold;">
                                    <span class="product-price">₹200/kg</span>
                                    <span class="product-sales">280 sales</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="content-section">
                    <div class="section-header"
                        style="display: flex; justify-content: space-between; align-items: center;">
                        <h2 class="section-title">Live Data Refresh</h2>
                        <button class="btn-success" onclick="location.reload();">
                            <i class="fas fa-sync-alt"></i> Refresh Data
                        </button>
                    </div>
                    <p>Click the button above to reload the entire dashboard.</p>
                </div>

            </div>
            <!-- Profile Section -->
            <div class="child-section" id="profile-section">
                <div class="section-header"
                    style="margin-bottom: 20px; padding: 15px 20px; border-radius: 6px; background-color: #f3e5f5; border: 1px solid #e1bee7; box-shadow: 0 2px 6px rgba(0,0,0,0.05); display: flex; flex-direction: column; gap: 6px;">
                    <h1 class="section-title" style="margin: 0 0 8px 0; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-user" style="color: #6a1b9a;"></i>
                        My Profile
                    </h1>
                </div>
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Basic Information</h2>
                        <button class="edit-btn" id="editProfileBtn">
                            <i class="fas fa-edit"></i> Edit Profile
                        </button>
                    </div>
                    <div class="avatar-container" style="justify-content: center;">
                        <div class="avatar" id="avatarDisplay">JD</div>
                        <div>
                            <input accept="image/*" class="avatar-input" id="avatarInput" type="file" />
                            <button class="btn-primary" id="changeAvatarBtn" style="margin-top: 10px;">
                                <i class="fas fa-camera"></i> Change Photo
                            </button>
                        </div>
                    </div>
                    <form id="profileForm">
                        <div class="profile-grid">
                            <label for="fullName">Full Name</label>
                            <input id="fullName" name="fullName" readonly="" type="text" value="D. JOY" />
                            <label for="phone">Phone</label>
                            <input id="phone" name="phone" readonly="" type="tel" value="+91" />
                            <label for="email">Email</label>
                            <input id="email" name="email" readonly="" type="email" value="" />
                            <label for="address">Address</label>
                            <textarea id="address" name="address" readonly="" rows="3"></textarea>
                        </div>
                        <div id="formActions" style="display: none;">
                            <button class="btn-success" id="saveProfileBtn" type="button">
                                <i class="fas fa-save"></i> Save Changes
                            </button>
                            <button id="cancelEditBtn" style="margin-left: 10px;" type="button">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="child-section" id="farmer-management-section" href="#">
                <div class="section-header"
                    style="margin-bottom: 20px; padding: 15px 20px; border-radius: 6px; background-color: #f3e5f5; border: 1px solid #e1bee7; box-shadow: 0 2px 6px rgba(0,0,0,0.05); display: flex; flex-direction: column; gap: 6px;">
                    <h1 class="section-title" style="margin: 0 0 8px 0; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-user-tie" style="color: #6a1b9a;"></i>
                        Farmer Management
                    </h1>
                </div>


                <div class="content-section">
                    <div class="section-header"
                        style="display: flex; justify-content: space-between; align-items: center;">
                        <h2 class="section-title" style="display: flex; align-items: center; gap: 10px;">
                            <i style="color: #6a1b9a;"></i>
                            Farmer Management Overview
                        </h2>
                    </div>

                    <!-- Stats Grid -->
                    <div class="stats-grid" style="margin-top: 20px;">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Total Farmers</div>
                                    <div class="stat-value">5,247</div>
                                    <div class="stat-change"><i class="fas fa-arrow-up"></i> +5.2%</div>
                                </div>
                            </div>
                            <div class="stat-chart"><canvas class="mini-chart" id="farmerCountChart"></canvas></div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Avg. Milk Production</div>
                                    <div class="stat-value">38.5 L</div>
                                    <div class="stat-change"><i class="fas fa-arrow-up"></i> +2.1%</div>
                                </div>
                            </div>
                            <div class="stat-chart"><canvas class="mini-chart" id="avgMilkChart"></canvas></div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Total Cattle</div>
                                    <div class="stat-value">14,902</div>
                                    <div class="stat-change"><i class="fas fa-arrow-up"></i> +3.4%</div>
                                </div>
                            </div>
                            <div class="stat-chart"><canvas class="mini-chart" id="cattleChart"></canvas></div>
                        </div>
                    </div>

                    <!-- Top Farmers Table -->
                    <div class="content-section" style="margin-top: 30px;">
                        <div class="section-header">
                            <h2 class="section-title">Top Performing Farmers</h2>
                        </div>
                        <table class="recent-orders" style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                            <thead>
                                <tr style="background: #f3e5f5;">
                                    <th>Farmer Name</th>
                                    <th>Village</th>
                                    <th>Milk Production (L/day)</th>
                                    <th>Cattle</th>
                                    <th>Phone</th>
                                </tr>
                            </thead>
                            <tbody id="farmerTableBody"></tbody>
                        </table>
                    </div>

                    <!-- Activity Timeline -->
                    <div class="content-section" style="margin-top: 30px;">
                        <div class="section-header">
                            <h2 class="section-title">Recent Activities</h2>
                        </div>
                        <ul class="activity-timeline" id="farmerTimeline" style="list-style: none; padding: 0;"></ul>
                    </div>
                </div>
            </div>


            <!-- Farmer Registration Section (HTML) -->
            <div class="child-section" id="farmer-registration-section">
               <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-user-plus"></i> Farmer Registration</h2>
                        <button class="btn-primary" id="addFarmerBtn">
                            <i class="fas fa-plus"></i> Add New Farmer
                        </button>
                    </div>

                    <!-- Farmer Registration Form -->
                    <div class="content-section" id="farmerFormContainer" style="display: none;">
                        <div class="section-header">
                            <h3 class="section-title" id="farmerFormTitle">Register New Farmer</h3>
                            <button class="btn-primary" id="closeFarmerForm">
                                <i class="fas fa-times"></i> Close
                            </button>
                        </div>
                        <form id="farmerForm">
                            <input type="hidden" id="farmerId">
                            <div class="profile-grid">
                                <label for="farmerName">Full Name*</label>
                                <input type="text" id="farmerName" required placeholder="Enter full name">

                                <label for="farmerAge">Age*</label>
                                <input type="number" id="farmerAge" required min="18" max="100" placeholder="Enter age">

                                <label for="farmerGender">Gender*</label>
                                <select id="farmerGender" required>
                                    <option value="">Select Gender</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                </select>

                                <label for="farmerAddress">Address*</label>
                                <textarea id="farmerAddress" required rows="3"
                                    placeholder="Enter full address"></textarea>

                                <label for="farmerVillage">Village*</label>
                                <input type="text" id="farmerVillage" required placeholder="Enter village">

                                <label for="farmerDistrict">District*</label>
                                <input type="text" id="farmerDistrict" required placeholder="Enter district">

                                <label for="farmerState">State*</label>
                                <input type="text" id="farmerState" required placeholder="Enter state">

                                <label for="farmerPincode">Pincode*</label>
                                <input type="text" id="farmerPincode" required pattern="[0-9]{6}"
                                    placeholder="6-digit pincode">

                                <label for="farmerPhone">Phone Number*</label>
                                <input type="tel" id="farmerPhone" required pattern="[0-9]{10}"
                                    placeholder="10-digit phone number">

                                <label for="farmerAadhar">Aadhar Number*</label>
                                <input type="text" id="farmerAadhar" required pattern="[0-9]{12}"
                                    placeholder="12-digit Aadhar number">

                                <label for="farmerBank">Bank Account Number*</label>
                                <input type="text" id="farmerBank" required placeholder="Bank account number">

                                <label for="farmerIfsc">IFSC Code*</label>
                                <input type="text" id="farmerIfsc" required placeholder="Bank IFSC code">

                                <label for="farmerCattle">Number of Cattle*</label>
                                <input type="number" id="farmerCattle" required min="1" placeholder="Total cattle">

                                <label for="farmerMilkProd">Avg. Milk Production (L/day)*</label>
                                <input type="number" id="farmerMilkProd" required step="0.1" min="0"
                                    placeholder="Litres per day">

                                <label for="farmerJoinDate">Joining Date*</label>
                                <input type="date" id="farmerJoinDate" required>
                            </div>
                            <div style="margin-top: 20px;">
                                <button type="submit" class="btn-success">
                                    <i class="fas fa-save"></i> Save Farmer
                                </button>
                                <button type="button" id="cancelFarmerForm" class="btn-primary"
                                    style="margin-left: 10px;">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Farmers List Table -->
                    <div class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">Registered Farmers</h2>
                            <div>
                                <input type="text" id="farmerSearch" placeholder="Search farmers..." class="hdr-search">
                                <button class="btn-primary" id="exportFarmersBtn" style="margin-left: 10px;">
                                    <i class="fas fa-file-excel"></i> Export
                                </button>
                            </div>
                        </div>
                        <table class="recent-orders" id="farmersTable">
                            <thead>
                                <tr>
                                    <th>Farmer ID</th>
                                    <th>Name</th>
                                    <th>Phone</th>
                                    <th>Village</th>
                                    <th>Cattle</th>
                                    <th>Milk (L/day)</th>
                                    <th>Join Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="farmersTableBody">
                                <!-- Farmers will be loaded here -->
                            </tbody>
                        </table>
                        <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                            <div id="farmersPaginationInfo">
                                Showing 0 to 0 of 0 farmers
                            </div>
                            <div>
                                <button class="btn-primary" id="prevFarmersPage" disabled>
                                    <i class="fas fa-chevron-left"></i> Previous
                                </button>
                                <button class="btn-primary" id="nextFarmersPage" disabled style="margin-left: 10px;">
                                    Next <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>





            <!-- Payments Section -->
            <div class="child-section" id="payments-section">
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-rupee-sign"></i> Payment Management</h2>
                        <button class="btn-primary" id="addPaymentBtn">
                            <i class="fas fa-plus"></i> Add New Payment
                        </button>
                    </div>

                    <!-- Stats Cards -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Total Payments</div>
                                    <div class="stat-value" id="totalPaymentsValue">₹0</div>
                                    <div class="stat-change" id="paymentChange">
                                        <svg fill="none" height="12" stroke="currentColor" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="12">
                                            <polyline points="18 15 12 9 6 15"></polyline>
                                        </svg>
                                        0%
                                    </div>
                                </div>
                            </div>
                            <div class="stat-chart">
                                <canvas class="mini-chart" id="totalPaymentsChart"></canvas>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Pending Payments</div>
                                    <div class="stat-value" id="pendingPaymentsValue">₹0</div>
                                    <div class="stat-change" id="pendingChange">
                                        <svg fill="none" height="12" stroke="currentColor" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="12">
                                            <polyline points="18 15 12 9 6 15"></polyline>
                                        </svg>
                                        0
                                    </div>
                                </div>
                            </div>
                            <div class="stat-chart">
                                <canvas class="mini-chart" id="pendingPaymentsChart"></canvas>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Avg. Payment</div>
                                    <div class="stat-value" id="avgPaymentValue">₹0</div>
                                    <div class="stat-change" id="avgPaymentChange">
                                        <svg fill="none" height="12" stroke="currentColor" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="12">
                                            <polyline points="18 15 12 9 6 15"></polyline>
                                        </svg>
                                        0%
                                    </div>
                                </div>
                            </div>
                            <div class="stat-chart">
                                <canvas class="mini-chart" id="avgPaymentChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Filters -->
                    <div class="content-section">
                        <div class="section-header">
                            <h3 class="section-title">Payment Records</h3>
                            <div>
                                <input type="text" id="paymentSearch" placeholder="Search payments..."
                                    class="hdr-search">
                                <select id="paymentFilter" style="margin-left: 10px; padding: 8px;">
                                    <option value="all">All Payments</option>
                                    <option value="completed">Completed</option>
                                    <option value="pending">Pending</option>
                                    <option value="overdue">Overdue</option>
                                </select>
                                <input type="date" id="paymentDateFilter" style="margin-left: 10px; padding: 7px;">
                            </div>
                        </div>

                        <!-- Payments Table -->
                        <table class="recent-orders" id="paymentsTable">
                            <thead>
                                <tr>
                                    <th>Payment ID</th>
                                    <th>Date</th>
                                    <th>Recipient</th>
                                    <th>Amount</th>
                                    <th>Method</th>
                                    <th>Reference</th>
                                    <th>Status</th>
                                    <th class="actions-cell">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="paymentsTableBody">
                                <!-- Payments will be loaded here -->
                            </tbody>
                        </table>

                        <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                            <div id="paymentPaginationInfo">
                                Showing 0 to 0 of 0 payments
                            </div>
                            <div>
                                <button class="btn-primary" id="prevPaymentPage" disabled>
                                    <i class="fas fa-chevron-left"></i> Previous
                                </button>
                                <button class="btn-primary" id="nextPaymentPage" disabled style="margin-left: 10px;">
                                    Next <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Trends -->
                    <div class="content-section">
                        <div class="section-header">
                            <h3 class="section-title">Payment Trends</h3>
                            <select id="paymentTrendFilter" style="padding: 8px;">
                                <option value="7d">Last 7 Days</option>
                                <option value="30d">Last 30 Days</option>
                                <option value="90d">Last 90 Days</option>
                                <option value="12m">Last 12 Months</option>
                            </select>
                        </div>
                        <canvas height="100" id="paymentTrendChart"></canvas>
                    </div>
                </div>

                <!-- Add Payment Form (hidden by default) -->
                <div class="content-section" id="addPaymentForm" style="display: none;">
                    <div class="section-header">
                        <h3 class="section-title">Add New Payment</h3>
                        <button class="btn-primary" id="closePaymentForm">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>
                    <form id="paymentForm">
                        <div class="profile-grid">
                            <label for="paymentDate">Payment Date</label>
                            <input type="date" id="paymentDate" required>

                            <label for="paymentRecipient">Recipient</label>
                            <select id="paymentRecipient" required>
                                <option value="">Select Recipient</option>
                                <option value="farmer">Farmer</option>
                                <option value="supplier">Supplier</option>
                                <option value="employee">Employee</option>
                                <option value="other">Other</option>
                            </select>

                            <label for="paymentRecipientId">Recipient ID/Name</label>
                            <input type="text" id="paymentRecipientId" required placeholder="Enter ID or name">

                            <label for="paymentAmount">Amount (₹)</label>
                            <input type="number" id="paymentAmount" required step="0.01" min="0">

                            <label for="paymentMethod">Payment Method</label>
                            <select id="paymentMethod" required>
                                <option value="">Select Method</option>
                                <option value="cash">Cash</option>
                                <option value="bank_transfer">Bank Transfer</option>
                                <option value="cheque">Cheque</option>
                                <option value="upi">UPI</option>
                                <option value="other">Other</option>
                            </select>

                            <label for="paymentReference">Reference/Note</label>
                            <input type="text" id="paymentReference" placeholder="Optional reference">

                            <label for="paymentStatus">Status</label>
                            <select id="paymentStatus" required>
                                <option value="completed">Completed</option>
                                <option value="pending">Pending</option>
                                <option value="failed">Failed</option>
                            </select>
                        </div>

                        <div style="margin-top: 20px;">
                            <button type="submit" class="btn-success">
                                <i class="fas fa-save"></i> Save Payment
                            </button>
                            <button type="button" id="cancelPaymentForm" class="btn-primary" style="margin-left: 10px;">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Edit Payment Modal (hidden by default) -->
                <div id="editPaymentModal"
                    style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
                    <div
                        style="background-color: white; padding: 20px; border-radius: 8px; width: 600px; max-width: 90%;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                            <h3>Edit Payment</h3>
                            <button id="closeEditPaymentModal"
                                style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
                        </div>
                        <form id="editPaymentForm">
                            <input type="hidden" id="editPaymentId">
                            <div class="profile-grid">
                                <label for="editPaymentDate">Payment Date</label>
                                <input type="date" id="editPaymentDate" required>

                                <label for="editPaymentRecipient">Recipient</label>
                                <select id="editPaymentRecipient" required>
                                    <option value="">Select Recipient</option>
                                    <option value="farmer">Farmer</option>
                                    <option value="supplier">Supplier</option>
                                    <option value="employee">Employee</option>
                                    <option value="other">Other</option>
                                </select>

                                <label for="editPaymentRecipientId">Recipient ID/Name</label>
                                <input type="text" id="editPaymentRecipientId" required placeholder="Enter ID or name">

                                <label for="editPaymentAmount">Amount (₹)</label>
                                <input type="number" id="editPaymentAmount" required step="0.01" min="0">

                                <label for="editPaymentMethod">Payment Method</label>
                                <select id="editPaymentMethod" required>
                                    <option value="">Select Method</option>
                                    <option value="cash">Cash</option>
                                    <option value="bank_transfer">Bank Transfer</option>
                                    <option value="cheque">Cheque</option>
                                    <option value="upi">UPI</option>
                                    <option value="other">Other</option>
                                </select>

                                <label for="editPaymentReference">Reference/Note</label>
                                <input type="text" id="editPaymentReference" placeholder="Optional reference">

                                <label for="editPaymentStatus">Status</label>
                                <select id="editPaymentStatus" required>
                                    <option value="completed">Completed</option>
                                    <option value="pending">Pending</option>
                                    <option value="failed">Failed</option>
                                </select>
                            </div>

                            <div style="margin-top: 20px; text-align: right;">
                                <button type="submit" class="btn-success">
                                    <i class="fas fa-save"></i> Update Payment
                                </button>
                                <button type="button" id="cancelEditPaymentBtn" class="btn-primary"
                                    style="margin-left: 10px;">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Milk Collection Section -->
            <div class="child-section" id="milk-collection-section">

                <div class="section-header"
                    style="margin-bottom: 20px; padding: 15px 20px; border-radius: 6px; background-color: #f3e5f5; border: 1px solid #e1bee7; box-shadow: 0 2px 6px rgba(0,0,0,0.05); display: flex; flex-direction: column; gap: 6px;">
                    <h1 class="section-title" style="margin: 0 0 8px 0; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-faucet" style="color: #6a1b9a;"></i>
                        Milk Collection
                    </h1>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-title">Today's Collection</div>
                                <div class="stat-value">12,450 L</div>
                                <div class="stat-change">
                                    <svg fill="none" height="12" stroke="currentColor" stroke-linecap="round"
                                        stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="12">
                                        <polyline points="18 15 12 9 6 15"></polyline>
                                    </svg>
                                    3.2%
                                </div>
                            </div>
                        </div>
                        <div class="stat-chart">
                            <canvas class="mini-chart" id="todayCollectionChart"></canvas>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-title">Avg. Fat %</div>
                                <div class="stat-value">4.1%</div>
                                <div class="stat-change down">
                                    <svg fill="none" height="12" stroke="currentColor" stroke-linecap="round"
                                        stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="12">
                                        <polyline points="6 9 12 15 18 9"></polyline>
                                    </svg>
                                    0.5%
                                </div>
                            </div>
                        </div>
                        <div class="stat-chart">
                            <canvas class="mini-chart" id="fatContentChart"></canvas>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-title">Avg. SNF %</div>
                                <div class="stat-value">8.5%</div>
                                <div class="stat-change">
                                    <svg fill="none" height="12" stroke="currentColor" stroke-linecap="round"
                                        stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="12">
                                        <polyline points="18 15 12 9 6 15"></polyline>
                                    </svg>
                                    0.2%
                                </div>
                            </div>
                        </div>
                        <div class="stat-chart">
                            <canvas class="mini-chart" id="snfContentChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="content-section">
                    <div class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">Milk Collection Data</h2>
                        </div>
                        <table class="recent-orders">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Farmer Name</th>
                                    <th>Quantity (Liters)</th>
                                    <th>Fat %</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>2025-05-01</td>
                                    <td>John Doe</td>
                                    <td>15.5</td>
                                    <td>3.8%</td>
                                </tr>
                                <tr>
                                    <td>2025-05-02</td>
                                    <td>Mary Smith</td>
                                    <td>18.2</td>
                                    <td>4.0%</td>
                                </tr>
                                <tr>
                                    <td>2025-05-03</td>
                                    <td>Ali Khan</td>
                                    <td>12.7</td>
                                    <td>3.6%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">Milk Collection Trend</h2>
                        </div>
                        <canvas height="100" id="milkCollectionTrendChart" width="600"></canvas>
                        <script>
                            const trendCtx = document.getElementById('milkCollectionTrendChart').getContext('2d');
                            new Chart(trendCtx, {
                                type: 'line',
                                data: {
                                    labels: ['May 1', 'May 2', 'May 3'],
                                    datasets: [{
                                        label: 'Milk Collected (L)',
                                        data: [15.5, 18.2, 12.7],
                                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                                        borderColor: 'rgba(54, 162, 235, 1)',
                                        borderWidth: 2,
                                        tension: 0.3
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    scales: {
                                        y: { beginAtZero: true }
                                    }
                                }
                            });
                        </script>
                    </div>
                    <div class="section-header">
                        <h2 class="section-title">Collection Centers Performance</h2>
                        <a class="section-link" href="#">View All <i class="fas fa-chevron-right"></i></a>
                    </div>
                    <table class="recent-orders">
                        <thead>
                            <tr>
                                <th>Center</th>
                                <th>Today's Collection</th>
                                <th>Avg. Fat %</th>
                                <th>Avg. SNF %</th>
                                <th>Quality Score</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Ahmedabad Center</td>
                                <td>3,450 L</td>
                                <td>4.2%</td>
                                <td>8.6%</td>
                                <td>92%</td>
                                <td><span class="status completed">Active</span></td>
                            </tr>
                            <tr>
                                <td>Gandhinagar Center</td>
                                <td>2,890 L</td>
                                <td>4.0%</td>
                                <td>8.4%</td>
                                <td>88%</td>
                                <td><span class="status completed">Active</span></td>
                            </tr>
                            <tr>
                                <td>Vadodara Center</td>
                                <td>3,120 L</td>
                                <td>4.3%</td>
                                <td>8.7%</td>
                                <td>94%</td>
                                <td><span class="status completed">Active</span></td>
                            </tr>
                            <tr>
                                <td>Surat Center</td>
                                <td>2,560 L</td>
                                <td>3.9%</td>
                                <td>8.3%</td>
                                <td>85%</td>
                                <td><span class="status completed">Active</span></td>
                            </tr>
                            <tr>
                                <td>Rajkot Center</td>
                                <td>2,430 L</td>
                                <td>4.1%</td>
                                <td>8.5%</td>
                                <td>90%</td>
                                <td><span class="status completed">Active</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>



            <!-- Collection Schedule Section -->
            <div class="child-section" id="collection-schedule-section">


                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-calendar-alt"></i> Milk Collection Schedule</h2>
                        <button class="btn-primary" id="addCollectionBtn">
                            <i class="fas fa-plus"></i> Add Schedule
                        </button>
                    </div>

                    <!-- Stats Cards -->
                    <div class="stats-grid"
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px;">
                        <div class="stat-card"
                            style="background-color: #ffffff; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: flex; flex-direction: column;">
                            <div class="stat-header"
                                style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                                <div>
                                    <div class="stat-title"
                                        style="font-size: 1rem; font-weight: bold; color: #1e1e90; margin-bottom: 5px;">
                                        Scheduled Today</div>
                                    <div class="stat-value" id="scheduledToday"
                                        style="font-size: 1.8rem; font-weight: bold; color: #333; margin-bottom: 5px;">0
                                    </div>
                                    <div class="stat-change"
                                        style="font-size: 0.85rem; color: #2a9d8f; display: flex; align-items: center; gap: 5px;">
                                        <svg fill="none" height="12" stroke="currentColor" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="12">
                                            <polyline points="18 15 12 9 6 15"></polyline>
                                        </svg>
                                        <span id="scheduledChange">0%</span>
                                    </div>
                                </div>
                            </div>
                            <div class="stat-chart" style="height: 170px; margin-top: auto;">
                                <canvas class="mini-chart" id="scheduledChart"></canvas>
                            </div>
                        </div>

                        <div class="stat-card"
                            style="background-color: #ffffff; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: flex; flex-direction: column;">
                            <div class="stat-header"
                                style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                                <div>
                                    <div class="stat-title"
                                        style="font-size: 1rem; font-weight: bold; color: #1e1e90; margin-bottom: 5px;">
                                        Completed Today</div>
                                    <div class="stat-value" id="completedToday"
                                        style="font-size: 1.8rem; font-weight: bold; color: #333; margin-bottom: 5px;">0
                                    </div>
                                    <div class="stat-change"
                                        style="font-size: 0.85rem; color: #2a9d8f; display: flex; align-items: center; gap: 5px;">
                                        <svg fill="none" height="12" stroke="currentColor" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="12">
                                            <polyline points="18 15 12 9 6 15"></polyline>
                                        </svg>
                                        <span id="completedChange">0%</span>
                                    </div>
                                </div>
                            </div>
                            <div class="stat-chart" style="height: 170px; margin-top: auto;">
                                <canvas class="mini-chart" id="completedChart"></canvas>
                            </div>
                        </div>

                        <div class="stat-card"
                            style="background-color: #ffffff; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: flex; flex-direction: column; justify-content: space-between;">
                            <div class="stat-header" style="margin-bottom: 15px;">
                                <div>
                                    <div class="stat-title"
                                        style="font-size: 1rem; font-weight: bold; color: #1e1e90; margin-bottom: 5px;">
                                        Pending Collections</div>
                                    <div class="stat-value" id="pendingCollections"
                                        style="font-size: 1.8rem; font-weight: bold; color: #333; margin-bottom: 5px;">2
                                    </div>
                                    <div class="stat-change"
                                        style="font-size: 0.85rem; color: #2a9d8f; display: flex; align-items: center; gap: 5px;">
                                        <svg fill="none" height="12" stroke="currentColor" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="12">
                                            <polyline points="18 15 12 9 6 15"></polyline>
                                        </svg>
                                        <span id="pendingChange">0</span>
                                    </div>
                                </div>
                            </div>

                            <div style="display: flex; flex-direction: column; align-items: center; margin-top: 7px;">
                                <div style="width: 140px; height: 140px; margin-bottom: 10px;">
                                    <canvas id="pendingChart"></canvas>
                                </div>

                                <!-- Legend 2x2 -->
                                <div
                                    style="display: grid; grid-template-columns: repeat(2, auto); gap: 8px 20px; text-align: left; font-size: 0.85rem; color: #555;">
                                    <div style="display: flex; align-items: center; gap: 6px;">
                                        <span
                                            style="display: inline-block; width: 12px; height: 12px; background-color: #2a9d8f; border-radius: 2px;"></span>
                                        Completed
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 6px;">
                                        <span
                                            style="display: inline-block; width: 12px; height: 12px; background-color: #f4c430; border-radius: 2px;"></span>
                                        In Progress
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 6px;">
                                        <span
                                            style="display: inline-block; width: 12px; height: 12px; background-color: #0077b6; border-radius: 2px;"></span>
                                        Scheduled
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 6px;">
                                        <span
                                            style="display: inline-block; width: 12px; height: 12px; background-color: #e76f51; border-radius: 2px;"></span>
                                        Cancelled
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>


                    <!-- Filters -->
                    <div style="margin: 20px 0; display: flex; gap: 15px; flex-wrap: wrap;">
                        <select id="collectionCenterFilter" class="hdr-search">
                            <option value="">All Centers</option>
                            <option value="Ahmedabad">Ahmedabad Center</option>
                            <option value="Gandhinagar">Gandhinagar Center</option>
                            <option value="Vadodara">Vadodara Center</option>
                            <option value="Surat">Surat Center</option>
                            <option value="Rajkot">Rajkot Center</option>
                        </select>

                        <select id="collectionStatusFilter" class="hdr-search">
                            <option value="">All Statuses</option>
                            <option value="scheduled">Scheduled</option>
                            <option value="in-progress">In Progress</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>

                        <input type="date" id="collectionDateFilter" class="hdr-search">

                        <button class="btn-primary" id="applyFiltersBtn">
                            <i class="fas fa-filter"></i> Apply Filters
                        </button>

                        <button class="btn-primary" id="resetFiltersBtn">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                    </div>

                    <!-- Collection Schedule Table -->
                    <table class="recent-orders" id="collectionTable">
                        <thead>
                            <tr>
                                <th>Collection ID</th>
                                <th>Date</th>
                                <th>Farmer</th>
                                <th>Center</th>
                                <th>Expected Qty (L)</th>
                                <th>Actual Qty (L)</th>
                                <th>Time Slot</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="collectionTableBody">
                            <!-- Data will be loaded here -->
                        </tbody>
                    </table>

                    <!-- Pagination -->
                    <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                        <div id="collectionPaginationInfo">
                            Showing 0 to 0 of 0 collections
                        </div>
                        <div>
                            <button class="btn-primary" id="prevCollectionPage" disabled>
                                <i class="fas fa-chevron-left"></i> Previous
                            </button>
                            <button class="btn-primary" id="nextCollectionPage" disabled style="margin-left: 10px;">
                                Next <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Add/Edit Collection Form (hidden by default) -->
                <div class="content-section" id="collectionFormContainer" style="display: none;">
                    <div class="section-header">
                        <h2 class="section-title" id="collectionFormTitle">Add New Collection</h2>
                        <button class="btn-primary" id="closeCollectionForm">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>

                    <form id="collectionForm">
                        <input type="hidden" id="collectionId">

                        <div class="profile-grid">
                            <label for="collectionFarmer">Farmer</label>
                            <select id="collectionFarmer" required>
                                <option value="">Select Farmer</option>
                                <!-- Options will be populated by JavaScript -->
                            </select>

                            <label for="collectionCenter">Collection Center</label>
                            <select id="collectionCenter" required>
                                <option value="">Select Center</option>
                                <option value="Ahmedabad">Ahmedabad Center</option>
                                <option value="Gandhinagar">Gandhinagar Center</option>
                                <option value="Vadodara">Vadodara Center</option>
                                <option value="Surat">Surat Center</option>
                                <option value="Rajkot">Rajkot Center</option>
                            </select>

                            <label for="collectionDate">Collection Date</label>
                            <input type="date" id="collectionDate" required>

                            <label for="collectionTimeSlot">Time Slot</label>
                            <select id="collectionTimeSlot" required>
                                <option value="">Select Time Slot</option>
                                <option value="Morning (6-9 AM)">Morning (6-9 AM)</option>
                                <option value="Late Morning (9-12 PM)">Late Morning (9-12 PM)</option>
                                <option value="Afternoon (12-3 PM)">Afternoon (12-3 PM)</option>
                                <option value="Evening (3-6 PM)">Evening (3-6 PM)</option>
                            </select>

                            <label for="collectionExpectedQty">Expected Quantity (Liters)</label>
                            <input type="number" id="collectionExpectedQty" step="0.1" min="0" required>

                            <label for="collectionActualQty">Actual Quantity (Liters)</label>
                            <input type="number" id="collectionActualQty" step="0.1" min="0">

                            <label for="collectionStatus">Status</label>
                            <select id="collectionStatus" required>
                                <option value="scheduled">Scheduled</option>
                                <option value="in-progress">In Progress</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>

                            <label for="collectionNotes">Notes</label>
                            <textarea id="collectionNotes" rows="3"></textarea>
                        </div>

                        <div style="margin-top: 20px;">
                            <button type="submit" class="btn-success">
                                <i class="fas fa-save"></i> Save Collection
                            </button>
                            <button type="button" id="cancelCollectionForm" class="btn-primary"
                                style="margin-left: 10px;">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>


            <!-- Quality Testing Section -->
            <div id="quality-testing-section" class="child-section">
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-vial"></i> Quality Testing</h2>
                        <button class="btn-primary" onclick="showQualityTestForm()">+ Add Test</button>
                    </div>

                    <!-- Description -->
                    <div
                        style="margin-bottom: 20px; background: #f1f8fe; border-radius: 7px; padding: 15px; border: 1px solid #caf0f8;">
                        <b>About Quality Testing:</b><br>
                        This section allows you to record, track, and visualize the results of quality tests performed
                        on milk batches. Monitoring metrics such as fat content, SNF, adulteration, and microbial tests
                        helps ensure product safety and consistency.
                        <ul style="margin: 8px 0 0 18px;">
                            <li><b>Add</b> a new test result for each milk batch.</li>
                            <li><b>Edit</b> or <b>delete</b> records as needed.</li>
                            <li>Check the <b>charts</b> for trends and pass/fail rates.</li>
                        </ul>
                    </div>

                    <!-- Stats -->
                    <div style="display: flex; gap: 20px; margin-bottom: 25px;">
                        <div
                            style="flex:1; background: #e9f7ef; border-radius: 8px; padding: 16px; text-align: center; border:1px solid #b7e4c7;">
                            <div style="font-size:24px;" id="qt-total-tests">0</div>
                            <div>Total Tests Conducted</div>
                        </div>
                        <div
                            style="flex:1; background: #fff3cd; border-radius: 8px; padding: 16px; text-align: center; border:1px solid #ffe066;">
                            <div style="font-size:24px;" id="qt-pass-rate">0%</div>
                            <div>Pass Rate</div>
                        </div>
                        <div
                            style="flex:1; background: #f8d7da; border-radius: 8px; padding: 16px; text-align: center; border:1px solid #f5c2c7;">
                            <div style="font-size:24px;" id="qt-failed-tests">0</div>
                            <div>Failed Tests</div>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="stats-grid" style="margin-bottom: 32px; grid-template-columns: 1fr 1fr;">
                        <div class="stat-card" style="height: 350px; display: flex; flex-direction: column;">
                            <div class="stat-header"><span class="stat-title">Test Results Overview</span></div>
                            <div style="flex: 1; display: flex; align-items: center; justify-content: center;">
                                <canvas id="qtResultPie"
                                    style="max-width: 340px; max-height: 280px; width:100%; height:100%;"></canvas>
                            </div>
                        </div>
                        <div class="stat-card" style="height: 350px; display: flex; flex-direction: column;">
                            <div class="stat-header"><span class="stat-title">Tests by Type</span></div>
                            <div style="flex: 1; display: flex; align-items: center; justify-content: center;">
                                <canvas id="qtTypeBar"
                                    style="max-width: 340px; max-height: 280px; width:100%; height:100%;"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Form -->
                    <div id="quality-test-form" style="display: none; margin-bottom: 20px;">
                        <h3>Add / Edit Quality Test</h3>
                        <form id="qtForm">
                            <input type="hidden" id="qtIndex" value="">
                            <div class="profile-grid">
                                <label for="qtDate">Date</label>
                                <input type="date" id="qtDate" required>
                            </div>
                            <div class="profile-grid">
                                <label for="qtBatch">Batch Number</label>
                                <input type="text" id="qtBatch" required>
                            </div>
                            <div class="profile-grid">
                                <label for="qtType">Test Type</label>
                                <select id="qtType" required>
                                    <option value="">Select Type</option>
                                    <option value="Fat Content">Fat Content</option>
                                    <option value="SNF">SNF</option>
                                    <option value="Adulteration">Adulteration</option>
                                    <option value="Microbial">Microbial</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="profile-grid">
                                <label for="qtResult">Result</label>
                                <select id="qtResult" required>
                                    <option value="">Select Result</option>
                                    <option value="Pass">Pass</option>
                                    <option value="Fail">Fail</option>
                                    <option value="Pending">Pending</option>
                                </select>
                            </div>
                            <div class="profile-grid">
                                <label for="qtRemarks">Remarks</label>
                                <textarea id="qtRemarks" rows="2"></textarea>
                            </div>
                            <button type="submit" class="btn-success">Save</button>
                            <button type="button" class="btn-primary" onclick="hideQualityTestForm()">Cancel</button>
                        </form>
                    </div>

                    <!-- Table -->
                    <table class="recent-orders" id="quality-test-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Batch #</th>
                                <th>Test Type</th>
                                <th>Result</th>
                                <th>Remarks</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>

                    <!-- Export Button -->
                    <div style="margin-top:18px;">
                        <button class="btn-primary" onclick="exportQualityTests()">Export Data as CSV</button>
                    </div>
                </div>
            </div>

            <!-- Chilling Centers Section -->
            <div class="child-section" id="chilling-centers-section">

                <div class="section-header"
                    style="margin-bottom: 20px; padding: 15px 20px; border-radius: 6px; background-color: #f3e5f5; border: 1px solid #e1bee7; box-shadow: 0 2px 6px rgba(0,0,0,0.05); display: flex; flex-direction: column; gap: 6px;">
                    <h1 class="section-title" style="margin: 0 0 8px 0; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-warehouse" style="color: #6a1b9a;"></i>
                        Chilling Centers
                    </h1>
                </div>


                <div class="content-section">
                    <div class="section-header"
                        style="display: flex; justify-content: space-between; align-items: center;">
                        <h2 class="section-title" style="display: flex; align-items: center; gap: 10px;">
                            <i style="color: #6a1b9a;"></i>
                            Chilling Centers Overview
                        </h2>
                        <button class="btn-primary" id="addCenterBtn">
                            <i class="fas fa-plus"></i> Add New Center
                        </button>
                    </div>

                    <!-- Stats Cards -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Total Centers</div>
                                    <div class="stat-value">12</div>
                                    <div class="stat-change">
                                        <svg fill="none" height="12" stroke="currentColor" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="12">
                                            <polyline points="18 15 12 9 6 15"></polyline>
                                        </svg>
                                        8.3%
                                    </div>
                                </div>
                            </div>
                            <div class="stat-chart">
                                <canvas class="mini-chart" id="totalCentersChart"></canvas>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Total Capacity</div>
                                    <div class="stat-value">150,000 L</div>
                                    <div class="stat-change">
                                        <svg fill="none" height="12" stroke="currentColor" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="12">
                                            <polyline points="18 15 12 9 6 15"></polyline>
                                        </svg>
                                        12.5%
                                    </div>
                                </div>
                            </div>
                            <div class="stat-chart">
                                <canvas class="mini-chart" id="totalCapacityChart"></canvas>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Current Storage</div>
                                    <div class="stat-value">112,500 L</div>
                                    <div class="stat-change">
                                        <svg fill="none" height="12" stroke="currentColor" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="12">
                                            <polyline points="18 15 12 9 6 15"></polyline>
                                        </svg>
                                        5.7%
                                    </div>
                                </div>
                            </div>
                            <div class="stat-chart">
                                <canvas class="mini-chart" id="currentStorageChart"></canvas>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Avg. Temp</div>
                                    <div class="stat-value">4.2°C</div>
                                    <div class="stat-change down">
                                        <svg fill="none" height="12" stroke="currentColor" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="12">
                                            <polyline points="6 9 12 15 18 9"></polyline>
                                        </svg>
                                        0.3°C
                                    </div>
                                </div>
                            </div>
                            <div class="stat-chart">
                                <canvas class="mini-chart" id="avgTempChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Center Performance Table -->
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Center Performance</h2>
                        <a class="section-link" href="#">View All <i class="fas fa-chevron-right"></i></a>
                    </div>
                    <table class="recent-orders">
                        <thead>
                            <tr>
                                <th>Center ID</th>
                                <th>Location</th>
                                <th>Capacity (L)</th>
                                <th>Current Storage</th>
                                <th>Avg. Temp</th>
                                <th>Quality Score</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>CC-1001</td>
                                <td>Ahmedabad</td>
                                <td>15,000</td>
                                <td>12,500 (83%)</td>
                                <td>4.1°C</td>
                                <td>94%</td>
                                <td><span class="status completed">Operational</span></td>
                            </tr>
                            <tr>
                                <td>CC-1002</td>
                                <td>Gandhinagar</td>
                                <td>12,000</td>
                                <td>10,800 (90%)</td>
                                <td>4.3°C</td>
                                <td>92%</td>
                                <td><span class="status completed">Operational</span></td>
                            </tr>
                            <tr>
                                <td>CC-1003</td>
                                <td>Vadodara</td>
                                <td>18,000</td>
                                <td>15,300 (85%)</td>
                                <td>4.0°C</td>
                                <td>95%</td>
                                <td><span class="status completed">Operational</span></td>
                            </tr>
                            <tr>
                                <td>CC-1004</td>
                                <td>Surat</td>
                                <td>20,000</td>
                                <td>16,000 (80%)</td>
                                <td>4.2°C</td>
                                <td>91%</td>
                                <td><span class="status completed">Operational</span></td>
                            </tr>
                            <tr>
                                <td>CC-1005</td>
                                <td>Rajkot</td>
                                <td>15,000</td>
                                <td>13,500 (90%)</td>
                                <td>4.4°C</td>
                                <td>93%</td>
                                <td><span class="status completed">Operational</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- Temperature Monitoring Section -->
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Temperature Monitoring</h2>
                        <select id="tempTimeRange" style="padding: 8px;">
                            <option value="24h">Last 24 Hours</option>
                            <option value="7d">Last 7 Days</option>
                            <option value="30d">Last 30 Days</option>
                        </select>
                    </div>
                    <canvas height="100" id="tempMonitoringChart"></canvas>
                </div>
                <!-- Inventory Movement Section -->
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Inventory Movement</h2>
                        <button class="btn-primary" id="exportInventoryBtn">
                            <i class="fas fa-download"></i> Export Data
                        </button>
                    </div>
                    <canvas height="100" id="inventoryMovementChart"></canvas>
                </div>
                <!-- Maintenance Logs -->
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Maintenance Logs</h2>
                        <button class="btn-primary" id="addMaintenanceBtn">
                            <i class="fas fa-plus"></i> Add Log
                        </button>
                    </div>
                    <table class="recent-orders">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Center</th>
                                <th>Issue</th>
                                <th>Action Taken</th>
                                <th>Technician</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>2023-06-15</td>
                                <td>CC-1001</td>
                                <td>Temperature fluctuation</td>
                                <td>Thermostat replaced</td>
                                <td>Rajesh Patel</td>
                                <td><span class="status completed">Resolved</span></td>
                            </tr>
                            <tr>
                                <td>2023-06-10</td>
                                <td>CC-1003</td>
                                <td>Coolant leak</td>
                                <td>Seals replaced</td>
                                <td>Vijay Singh</td>
                                <td><span class="status completed">Resolved</span></td>
                            </tr>
                            <tr>
                                <td>2023-06-08</td>
                                <td>CC-1002</td>
                                <td>Power supply issue</td>
                                <td>Backup generator serviced</td>
                                <td>Sunil Sharma</td>
                                <td><span class="status completed">Resolved</span></td>
                            </tr>
                            <tr>
                                <td>2023-06-05</td>
                                <td>CC-1004</td>
                                <td>Door seal damage</td>
                                <td>New seal installed</td>
                                <td>Anil Gupta</td>
                                <td><span class="status completed">Resolved</span></td>
                            </tr>
                            <tr>
                                <td>2023-06-01</td>
                                <td>CC-1005</td>
                                <td>Compressor noise</td>
                                <td>Pending diagnosis</td>
                                <td>Mohan Kumar</td>
                                <td><span class="status pending">In Progress</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- Add Center Form (hidden by default) -->
                <div class="content-section" id="addCenterForm" style="display: none;">
                    <div class="section-header">
                        <h3 class="section-title">Add New Chilling Center</h3>
                        <button class="btn-primary" id="closeCenterForm">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>
                    <form id="centerForm">
                        <div class="profile-grid">
                            <label for="centerName">Center Name</label>
                            <input id="centerName" required="" type="text" />
                            <label for="centerLocation">Location</label>
                            <input id="centerLocation" required="" type="text" />
                            <label for="centerCapacity">Capacity (Liters)</label>
                            <input id="centerCapacity" required="" type="number" />
                            <label for="centerManager">Manager</label>
                            <input id="centerManager" required="" type="text" />
                            <label for="centerContact">Contact Number</label>
                            <input id="centerContact" required="" type="tel" />
                            <label for="centerStatus">Status</label>
                            <select id="centerStatus" required="">
                                <option value="active">Active</option>
                                <option value="maintenance">Maintenance</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                        <div style="margin-top: 20px;">
                            <button class="btn-success" type="submit">
                                <i class="fas fa-save"></i> Save Center
                            </button>
                            <button class="btn-primary" id="cancelCenterForm" style="margin-left: 10px;" type="button">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>


            <!-- ✅ Inventory Management Section -->
            <div class="child-section" id="inventory-section">
                <div class="section-header" style="margin-bottom: 20px;">
                    <h1 class="section-title"><i class="fas fa-boxes" style="color: #6a1b9a;"></i> Inventory Management
                    </h1>
                </div>

                <!-- Summary Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Items</h3>
                        <div class="stat-value" id="totalItems">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Value</h3>
                        <div class="stat-value" id="totalValue">₹0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Categories</h3>
                        <div class="stat-value" id="totalCategories">0</div>
                    </div>
                </div>

                <!-- Table Controls -->
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Inventory List</h2>
                        <div>
                            <button class="btn-success" onclick="openInventoryForm()">+ Add Item</button>
                            <button class="btn-primary" onclick="exportInventoryToCSV()">Export CSV</button>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <input type="text" id="inventorySearch" placeholder="Search by item..." style="padding: 6px;">
                        <select id="categoryFilter" style="padding: 6px;">
                            <option value="all">All Categories</option>
                        </select>
                    </div>

                    <!-- Inventory Table -->
                    <table class="summary-table" id="inventoryTable">
                        <thead>
                            <tr>
                                <th>Item Name</th>
                                <th>Category</th>
                                <th>Quantity</th>
                                <th>Unit Price</th>
                                <th>Total Value</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryBody"></tbody>
                    </table>
                </div>

                <!-- Inventory Modal -->
                <div class="modal-overlay" id="inventoryModal" style="display: none;">
                    <div class="modal-box">
                        <h3 id="inventoryFormTitle">Add Inventory Item</h3>
                        <label>Item Name*</label>
                        <input type="text" id="itemName">
                        <label>Category*</label>
                        <input type="text" id="itemCategory">
                        <label>Quantity*</label>
                        <input type="number" id="itemQuantity">
                        <label>Unit Price (₹)*</label>
                        <input type="number" id="itemPrice">
                        <button class="btn-success" onclick="saveInventoryItem()">Save</button>
                        <button class="delete-btn" onclick="closeInventoryForm()"
                            style="margin-top: 10px;">Cancel</button>
                    </div>
                </div>
            </div>
            <!-- Processing Plants Section -->
            <div class="child-section" id="processing-plants-section">

                <div class="section-header"
                    style="margin-bottom: 20px; padding: 15px 20px; border-radius: 6px; background-color: #f3e5f5; border: 1px solid #e1bee7; box-shadow: 0 2px 6px rgba(0,0,0,0.05); display: flex; flex-direction: column; gap: 6px;">
                    <h1 class="section-title" style="margin: 0 0 8px 0; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-industry" style="color: #6a1b9a;"></i>
                        Processing Plants
                    </h1>
                </div>


                <div class="content-section">
                    <div class="section-header"
                        style="display: flex; justify-content: space-between; align-items: center;">
                        <h2 class="section-title" style="display: flex; align-items: center; gap: 10px;">
                            <i style="color: #6a1b9a;"></i>
                            Processing Plants Overview
                        </h2>
                        <button class="btn-primary" id="addCenterBtn">
                            <i class="fas fa-plus"></i> Add New Plant
                        </button>
                    </div>

                    <!-- Stats Cards -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Total Plants</div>
                                    <div class="stat-value">8</div>
                                    <div class="stat-change">
                                        <svg fill="none" height="12" stroke="currentColor" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="12">
                                            <polyline points="18 15 12 9 6 15"></polyline>
                                        </svg>
                                        14.3%
                                    </div>
                                </div>
                            </div>
                            <div class="stat-chart">
                                <canvas class="mini-chart" id="totalPlantsChart"></canvas>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Daily Capacity</div>
                                    <div class="stat-value">250,000 L</div>
                                    <div class="stat-change">
                                        <svg fill="none" height="12" stroke="currentColor" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="12">
                                            <polyline points="18 15 12 9 6 15"></polyline>
                                        </svg>
                                        8.7%
                                    </div>
                                </div>
                            </div>
                            <div class="stat-chart">
                                <canvas class="mini-chart" id="dailyCapacityChart"></canvas>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Current Utilization</div>
                                    <div class="stat-value">78%</div>
                                    <div class="stat-change down">
                                        <svg fill="none" height="12" stroke="currentColor" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="12">
                                            <polyline points="6 9 12 15 18 9"></polyline>
                                        </svg>
                                        5.2%
                                    </div>
                                </div>
                            </div>
                            <div class="stat-chart">
                                <canvas class="mini-chart" id="utilizationChart"></canvas>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Avg. Efficiency</div>
                                    <div class="stat-value">82%</div>
                                    <div class="stat-change">
                                        <svg fill="none" height="12" stroke="currentColor" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="12">
                                            <polyline points="18 15 12 9 6 15"></polyline>
                                        </svg>
                                        1.5%
                                    </div>
                                </div>
                            </div>
                            <div class="stat-chart">
                                <canvas class="mini-chart" id="efficiencyChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Plant Performance Table -->
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Plant Performance</h2>
                        <a class="section-link" href="#">View All <i class="fas fa-chevron-right"></i></a>
                    </div>
                    <table class="recent-orders">
                        <thead>
                            <tr>
                                <th>Plant ID</th>
                                <th>Location</th>
                                <th>Capacity (L/day)</th>
                                <th>Current Output</th>
                                <th>Efficiency</th>
                                <th>Downtime</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>PP-1001</td>
                                <td>Ahmedabad</td>
                                <td>50,000</td>
                                <td>42,500 (85%)</td>
                                <td>88%</td>
                                <td>2.1%</td>
                                <td><span class="status completed">Operational</span></td>
                            </tr>
                            <tr>
                                <td>PP-1002</td>
                                <td>Gandhinagar</td>
                                <td>40,000</td>
                                <td>32,800 (82%)</td>
                                <td>85%</td>
                                <td>3.5%</td>
                                <td><span class="status completed">Operational</span></td>
                            </tr>
                            <tr>
                                <td>PP-1003</td>
                                <td>Vadodara</td>
                                <td>45,000</td>
                                <td>36,900 (82%)</td>
                                <td>84%</td>
                                <td>2.8%</td>
                                <td><span class="status completed">Operational</span></td>
                            </tr>
                            <tr>
                                <td>PP-1004</td>
                                <td>Surat</td>
                                <td>35,000</td>
                                <td>28,000 (80%)</td>
                                <td>82%</td>
                                <td>4.2%</td>
                                <td><span class="status completed">Operational</span></td>
                            </tr>
                            <tr>
                                <td>PP-1005</td>
                                <td>Rajkot</td>
                                <td>30,000</td>
                                <td>25,500 (85%)</td>
                                <td>87%</td>
                                <td>1.9%</td>
                                <td><span class="status completed">Operational</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- Production Lines Section -->
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Production Lines</h2>
                        <button class="btn-primary" id="addProductionLineBtn">
                            <i class="fas fa-plus"></i> Add Line
                        </button>
                    </div>
                    <table class="recent-orders">
                        <thead>
                            <tr>
                                <th>Line ID</th>
                                <th>Plant</th>
                                <th>Product Type</th>
                                <th>Capacity (L/hr)</th>
                                <th>Current Rate</th>
                                <th>Uptime</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>PL-101</td>
                                <td>PP-1001 (Ahmedabad)</td>
                                <td>Pasteurized Milk</td>
                                <td>5,000</td>
                                <td>4,750</td>
                                <td>98.2%</td>
                                <td><span class="status completed">Running</span></td>
                                <td>
                                    <button class="btn-primary"><i class="fas fa-chart-line"></i></button>
                                    <button class="btn-success"><i class="fas fa-edit"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td>PL-102</td>
                                <td>PP-1001 (Ahmedabad)</td>
                                <td>Flavored Milk</td>
                                <td>3,500</td>
                                <td>3,200</td>
                                <td>96.5%</td>
                                <td><span class="status completed">Running</span></td>
                                <td>
                                    <button class="btn-primary"><i class="fas fa-chart-line"></i></button>
                                    <button class="btn-success"><i class="fas fa-edit"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td>PL-201</td>
                                <td>PP-1002 (Gandhinagar)</td>
                                <td>Yogurt</td>
                                <td>2,800</td>
                                <td>2,600</td>
                                <td>97.8%</td>
                                <td><span class="status completed">Running</span></td>
                                <td>
                                    <button class="btn-primary"><i class="fas fa-chart-line"></i></button>
                                    <button class="btn-success"><i class="fas fa-edit"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td>PL-301</td>
                                <td>PP-1003 (Vadodara)</td>
                                <td>Cheese</td>
                                <td>1,500</td>
                                <td>1,350</td>
                                <td>95.2%</td>
                                <td><span class="status pending">Maintenance</span></td>
                                <td>
                                    <button class="btn-primary"><i class="fas fa-chart-line"></i></button>
                                    <button class="btn-success"><i class="fas fa-edit"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- Production Trends Section -->
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Production Trends</h2>
                        <select id="productionTimeRange" style="padding: 8px;">
                            <option value="7d">Last 7 Days</option>
                            <option value="30d">Last 30 Days</option>
                            <option value="90d">Last 90 Days</option>
                        </select>
                    </div>
                    <canvas height="100" id="productionTrendChart"></canvas>
                </div>
                <!-- Equipment Monitoring Section -->
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Equipment Monitoring</h2>
                        <button class="btn-primary" id="exportEquipmentDataBtn">
                            <i class="fas fa-download"></i> Export Data
                        </button>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Critical Alerts</div>
                                    <div class="stat-value">3</div>
                                    <div class="stat-change down">
                                        <svg fill="none" height="12" stroke="currentColor" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="12">
                                            <polyline points="6 9 12 15 18 9"></polyline>
                                        </svg>
                                        25%
                                    </div>
                                </div>
                            </div>
                            <div class="stat-chart">
                                <canvas class="mini-chart" id="criticalAlertsChart"></canvas>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Preventive Maint.</div>
                                    <div class="stat-value">12</div>
                                    <div class="stat-change">
                                        <svg fill="none" height="12" stroke="currentColor" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="12">
                                            <polyline points="18 15 12 9 6 15"></polyline>
                                        </svg>
                                        8%
                                    </div>
                                </div>
                            </div>
                            <div class="stat-chart">
                                <canvas class="mini-chart" id="preventiveMaintenanceChart"></canvas>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Avg. Temp</div>
                                    <div class="stat-value">4.2°C</div>
                                    <div class="stat-change down">
                                        <svg fill="none" height="12" stroke="currentColor" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="12">
                                            <polyline points="6 9 12 15 18 9"></polyline>
                                        </svg>
                                        0.3°C
                                    </div>
                                </div>
                            </div>
                            <div class="stat-chart">
                                <canvas class="mini-chart" id="avgTempChart"></canvas>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Energy Usage</div>
                                    <div class="stat-value">1,250 kWh</div>
                                    <div class="stat-change">
                                        <svg fill="none" height="12" stroke="currentColor" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="12">
                                            <polyline points="18 15 12 9 6 15"></polyline>
                                        </svg>
                                        3.5%
                                    </div>
                                </div>
                            </div>
                            <div class="stat-chart">
                                <canvas class="mini-chart" id="energyUsageChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <table class="recent-orders" style="margin-top: 20px;">
                        <thead>
                            <tr>
                                <th>Equipment ID</th>
                                <th>Name</th>
                                <th>Plant</th>
                                <th>Last Maintenance</th>
                                <th>Next Maintenance</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>EQ-1001</td>
                                <td>Pasteurizer</td>
                                <td>PP-1001</td>
                                <td>2023-05-15</td>
                                <td>2023-07-15</td>
                                <td><span class="status completed">Operational</span></td>
                                <td>
                                    <button class="btn-primary"><i class="fas fa-info-circle"></i></button>
                                    <button class="btn-success"><i class="fas fa-wrench"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td>EQ-1002</td>
                                <td>Homogenizer</td>
                                <td>PP-1001</td>
                                <td>2023-06-01</td>
                                <td>2023-08-01</td>
                                <td><span class="status completed">Operational</span></td>
                                <td>
                                    <button class="btn-primary"><i class="fas fa-info-circle"></i></button>
                                    <button class="btn-success"><i class="fas fa-wrench"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td>EQ-1003</td>
                                <td>Filling Machine</td>
                                <td>PP-1001</td>
                                <td>2023-06-10</td>
                                <td>2023-07-10</td>
                                <td><span class="status pending">Maintenance Due</span></td>
                                <td>
                                    <button class="btn-primary"><i class="fas fa-info-circle"></i></button>
                                    <button class="btn-success"><i class="fas fa-wrench"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td>EQ-2001</td>
                                <td>Cheese Vat</td>
                                <td>PP-1003</td>
                                <td>2023-05-20</td>
                                <td>2023-07-20</td>
                                <td><span class="status pending">In Maintenance</span></td>
                                <td>
                                    <button class="btn-primary"><i class="fas fa-info-circle"></i></button>
                                    <button class="btn-success"><i class="fas fa-wrench"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td>EQ-2002</td>
                                <td>Yogurt Fermenter</td>
                                <td>PP-1002</td>
                                <td>2023-06-05</td>
                                <td>2023-08-05</td>
                                <td><span class="status completed">Operational</span></td>
                                <td>
                                    <button class="btn-primary"><i class="fas fa-info-circle"></i></button>
                                    <button class="btn-success"><i class="fas fa-wrench"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- Maintenance Logs -->
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Maintenance Logs</h2>
                        <button class="btn-primary" id="addMaintenanceLogBtn">
                            <i class="fas fa-plus"></i> Add Log
                        </button>
                    </div>
                    <table class="recent-orders">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Equipment</th>
                                <th>Plant</th>
                                <th>Issue</th>
                                <th>Action Taken</th>
                                <th>Technician</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>2023-06-15</td>
                                <td>Pasteurizer (EQ-1001)</td>
                                <td>PP-1001</td>
                                <td>Temperature fluctuation</td>
                                <td>Thermostat replaced</td>
                                <td>Rajesh Patel</td>
                                <td><span class="status completed">Resolved</span></td>
                            </tr>
                            <tr>
                                <td>2023-06-10</td>
                                <td>Cheese Vat (EQ-2001)</td>
                                <td>PP-1003</td>
                                <td>Coolant leak</td>
                                <td>Seals replaced</td>
                                <td>Vijay Singh</td>
                                <td><span class="status completed">Resolved</span></td>
                            </tr>
                            <tr>
                                <td>2023-06-08</td>
                                <td>Filling Machine (EQ-1003)</td>
                                <td>PP-1001</td>
                                <td>Power supply issue</td>
                                <td>Backup generator serviced</td>
                                <td>Sunil Sharma</td>
                                <td><span class="status completed">Resolved</span></td>
                            </tr>
                            <tr>
                                <td>2023-06-05</td>
                                <td>Homogenizer (EQ-1002)</td>
                                <td>PP-1001</td>
                                <td>Unusual noise</td>
                                <td>Bearings lubricated</td>
                                <td>Anil Gupta</td>
                                <td><span class="status completed">Resolved</span></td>
                            </tr>
                            <tr>
                                <td>2023-06-01</td>
                                <td>Yogurt Fermenter (EQ-2002)</td>
                                <td>PP-1002</td>
                                <td>Compressor noise</td>
                                <td>Pending diagnosis</td>
                                <td>Mohan Kumar</td>
                                <td><span class="status pending">In Progress</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- Add Plant Form (hidden by default) -->
                <div class="content-section" id="addPlantForm" style="display: none;">
                    <div class="section-header">
                        <h3 class="section-title">Add New Processing Plant</h3>
                        <button class="btn-primary" id="closePlantForm">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>
                    <form id="plantForm">
                        <div class="profile-grid">
                            <label for="plantName">Plant Name</label>
                            <input id="plantName" required="" type="text" />
                            <label for="plantLocation">Location</label>
                            <input id="plantLocation" required="" type="text" />
                            <label for="plantCapacity">Daily Capacity (Liters)</label>
                            <input id="plantCapacity" required="" type="number" />
                            <label for="plantManager">Plant Manager</label>
                            <input id="plantManager" required="" type="text" />
                            <label for="plantContact">Contact Number</label>
                            <input id="plantContact" required="" type="tel" />
                            <label for="plantStatus">Status</label>
                            <select id="plantStatus" required="">
                                <option value="active">Active</option>
                                <option value="maintenance">Maintenance</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                        <div style="margin-top: 20px;">
                            <button class="btn-success" type="submit">
                                <i class="fas fa-save"></i> Save Plant
                            </button>
                            <button class="btn-primary" id="cancelPlantForm" style="margin-left: 10px;" type="button">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="child-section" id="production-lines-section">
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-cogs"></i> Production Lines Management</h2>
                        <button class="btn-primary" id="addProductionLineBtn">
                            <i class="fas fa-plus"></i> Add Production Line
                        </button>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div>
                                <div class="stat-title">Total Lines</div>
                                <div class="stat-value" id="totalLinesCount">0</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div>
                                <div class="stat-title">Active Lines</div>
                                <div class="stat-value" id="activeLinesCount">0</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div>
                                <div class="stat-title">Avg. Utilization</div>
                                <div class="stat-value" id="avgUtilization">0%</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div>
                                <div class="stat-title">Maintenance Due</div>
                                <div class="stat-value" id="maintenanceDueCount">0</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Production Lines</h2>
                        <div>
                            <input type="text" id="lineSearch" placeholder="Search lines..." class="hdr-search">
                            <select id="lineFilter" style="margin-left: 10px; padding: 8px;">
                                <option value="all">All Lines</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="maintenance">Maintenance</option>
                            </select>
                            <button class="btn-primary" id="exportLinesBtn" style="margin-left: 10px;">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                    <table class="recent-orders" id="productionLinesTable">
                        <thead>
                            <tr>
                                <th>Line ID</th>
                                <th>Name</th>
                                <th>Plant</th>
                                <th>Product Type</th>
                                <th>Capacity (L/hr)</th>
                                <th>Current Rate</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="productionLinesBody">
                            <!-- Lines will be loaded here -->
                        </tbody>
                    </table>

                    <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                        <div id="linesPaginationInfo">
                            Showing 0 to 0 of 0 lines
                        </div>
                        <div>
                            <button class="btn-primary" id="prevLinePage" disabled>
                                <i class="fas fa-chevron-left"></i> Previous
                            </button>
                            <button class="btn-primary" id="nextLinePage" disabled style="margin-left: 10px;">
                                Next <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Add/Edit Production Line Form (hidden by default) -->
                <div class="content-section" id="productionLineForm" style="display: none;">
                    <div class="section-header">
                        <h2 class="section-title" id="lineFormTitle">Add New Production Line</h2>
                        <button class="btn-primary" id="closeLineForm">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>
                    <form id="lineForm" autocomplete="off">
                        <input type="hidden" id="lineId">
                        <div class="profile-grid">
                            <label for="lineName">Line Name*</label>
                            <input type="text" id="lineName" required placeholder="Enter line name">

                            <label for="linePlant">Plant*</label>
                            <select id="linePlant" required>
                                <option value="">Select Plant</option>
                            </select>

                            <label for="lineProductType">Product Type*</label>
                            <select id="lineProductType" required>
                                <option value="">Select Product Type</option>
                                <option value="pasteurized_milk">Pasteurized Milk</option>
                                <option value="toned_milk">Toned Milk</option>
                                <option value="flavored_milk">Flavored Milk</option>
                                <option value="yogurt">Yogurt</option>
                                <option value="paneer">Paneer</option>
                                <option value="cheese">Cheese</option>
                                <option value="ghee">Ghee</option>
                                <option value="butter">Butter</option>
                                <option value="cream">Cream</option>
                                <option value="lassi">Lassi</option>
                            </select>

                            <label for="lineCapacity">Capacity (L/hr)*</label>
                            <input type="number" id="lineCapacity" required min="0" step="1">

                            <label for="lineCurrentRate">Current Rate (L/hr)</label>
                            <input type="number" id="lineCurrentRate" min="0" step="1">

                            <label for="lineStatus">Status*</label>
                            <select id="lineStatus" required>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="maintenance">Maintenance</option>
                            </select>

                            <label for="lineLastMaintenance">Last Maintenance Date</label>
                            <input type="date" id="lineLastMaintenance">

                            <label for="lineNextMaintenance">Next Maintenance Date</label>
                            <input type="date" id="lineNextMaintenance">

                            <label for="lineNotes">Notes</label>
                            <textarea id="lineNotes" rows="3"></textarea>
                        </div>

                        <div style="margin-top: 20px;">
                            <button type="submit" class="btn-success">
                                <i class="fas fa-save"></i> Save Line
                            </button>
                            <button type="button" id="cancelLineForm" class="btn-primary" style="margin-left: 10px;">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="child-section" id="quality-control-section">

                <div class="section-header"
                    style="margin-bottom: 20px; padding: 15px 20px; border-radius: 6px; background-color: #f3e5f5; border: 1px solid #e1bee7; box-shadow: 0 2px 6px rgba(0,0,0,0.05); display: flex; flex-direction: column; gap: 6px;">
                    <h1 class="section-title" style="margin: 0 0 8px 0; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-flask" style="color: #6a1b9a;"></i>
                        Quality Control
                    </h1>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Quality Control - Test Management</h2>
                        <button class="btn-primary" onclick="qcOpenAddModal()">Add New Test</button>
                    </div>

                    <!-- Summary Stats -->
                    <div class="stats-grid"
                        style="display: flex; gap: 20px; flex-wrap: wrap; margin-top: 20px; margin-bottom: 30px; justify-content: space-between;">
                        <div class="stat-card"
                            style="flex: 1 1 30%; padding: 20px; background: #ffffff; border-radius: 12px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); text-align: center; transition: box-shadow 0.3s ease;">
                            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 10px; color: #1e1e90;">Total
                                Tests</h3>
                            <div id="qc-total-tests" style="font-size: 28px; font-weight: bold; color: #0077b6;">0</div>
                        </div>
                        <div class="stat-card"
                            style="flex: 1 1 30%; padding: 20px; background: #ffffff; border-radius: 12px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); text-align: center; transition: box-shadow 0.3s ease;">
                            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 10px; color: #1e1e90;">Pass
                                Count</h3>
                            <div id="qc-total-pass" style="font-size: 28px; font-weight: bold; color: #0077b6;">0</div>
                        </div>
                        <div class="stat-card"
                            style="flex: 1 1 30%; padding: 20px; background: #ffffff; border-radius: 12px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); text-align: center; transition: box-shadow 0.3s ease;">
                            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 10px; color: #1e1e90;">Fail
                                Count</h3>
                            <div id="qc-total-fail" style="font-size: 28px; font-weight: bold; color: #0077b6;">0</div>
                        </div>
                    </div>


                    <!-- Filter/Search -->
                    <div style="margin-bottom: 10px;">
                        <input type="text" id="qc-search-input"
                            placeholder="Search by Batch ID, Type, Result, Technician" class="hdr-search"
                            oninput="qcRenderTable()">
                    </div>

                    <!-- Test Records Table -->
                    <table class="recent-orders" id="qc-tests-table">
                        <thead>
                            <tr>
                                <th>Test ID</th>
                                <th>Batch ID</th>
                                <th>Test Type</th>
                                <th>Result</th>
                                <th>Date</th>
                                <th>Technician</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="qc-tests-body">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>

                    <div class="qc-chart-container">
                        <div class="qc-chart-box">
                            <h3 class="qc-chart-title">Test Types Distribution</h3>
                            <canvas id="qc-type-chart"></canvas>
                        </div>
                        <div class="qc-chart-box">
                            <h3 class="qc-chart-title">Pass vs Fail Results</h3>
                            <canvas id="qc-passfail-chart"></canvas>
                        </div>
                    </div>


                    <!-- Export Buttons -->
                    <div style="margin-top: 15px;">
                        <button class="btn-primary" onclick="qcExportToExcel()">Export to Excel</button>
                        <button class="btn-primary" onclick="qcExportToPDF()">Export to PDF</button>
                    </div>
                </div>

                <!-- Add/Edit Modal -->
                <div id="qc-modal" class="modal-overlay" style="display:none;">
                    <div class="modal-box">
                        <h3 id="qc-modal-title">Add New Test</h3>
                        <label>Batch ID</label>
                        <input type="text" id="qc-batch-id">
                        <label>Test Type</label>
                        <select id="qc-test-type">
                            <option>Protein</option>
                            <option>Fat</option>
                            <option>SNF</option>
                            <option>Acidity</option>
                        </select>
                        <label>Result</label>
                        <select id="qc-test-result">
                            <option>Pass</option>
                            <option>Fail</option>
                        </select>
                        <label>Date</label>
                        <input type="date" id="qc-test-date">
                        <label>Technician</label>
                        <input type="text" id="qc-technician">
                        <label>Remarks</label>
                        <input type="text" id="qc-remarks">

                        <button class="btn-success" onclick="qcSaveTest()">Save</button>
                        <button class="btn-primary" onclick="qcCloseModal()">Cancel</button>
                    </div>
                </div>

            </div>

            <!-- Feedback & Complaints Section -->
            <div class="child-section" id="feedbackComplaintsSection">
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-comment-dots"></i> Feedback & Complaints Management
                        </h2>
                        <button class="btn-primary" onclick="feedbackComplaintsOpenModal()">Add New
                            Feedback/Complaint</button>
                    </div>

                    <input type="text" id="feedbackComplaintsSearchInput" class="hdr-search"
                        placeholder="Search by Customer Name or Status" oninput="feedbackComplaintsRenderTable()">

                    <table class="recent-orders" id="feedbackComplaintsTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Customer Name</th>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="feedbackComplaintsTableBody"></tbody>
                    </table>

                    <div style="margin-top: 10px;">
                        <button class="btn-primary" onclick="feedbackComplaintsExportPDF()">Export to PDF</button>
                        <button class="btn-primary" onclick="feedbackComplaintsExportExcel()">Export to
                            Excel</button>
                    </div>

                    <div
                        style="max-width: 420px; margin: 30px auto; padding: 20px; background: #fff; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); text-align: center;">
                        <h3 style="font-size: 18px; color: #1e1e90; margin-bottom: 15px;">Feedback & Complaints Overview
                        </h3>
                        <canvas id="feedbackComplaintsChart" style="max-width: 100%; height: auto;"></canvas>
                    </div>

                </div>

                <!-- Modal Form -->
                <div class="modal-overlay" id="feedbackComplaintsModal" style="display: none;">
                    <div class="modal-box">
                        <h3 id="feedbackComplaintsModalTitle">Add Feedback/Complaint</h3>
                        <input type="hidden" id="feedbackComplaintsId">

                        <label>Customer Name:</label>
                        <input type="text" id="feedbackComplaintsCustomer">

                        <label>Date:</label>
                        <input type="date" id="feedbackComplaintsDate">

                        <label>Type:</label>
                        <select id="feedbackComplaintsType">
                            <option>Feedback</option>
                            <option>Complaint</option>
                        </select>

                        <label>Details:</label>
                        <textarea id="feedbackComplaintsDetails"></textarea>

                        <label>Status:</label>
                        <select id="feedbackComplaintsStatus">
                            <option>Pending</option>
                            <option>Resolved</option>
                            <option>Closed</option>
                        </select>

                        <button class="btn-success" onclick="feedbackComplaintsSave()">Save</button>
                        <button class="btn-primary" onclick="feedbackComplaintsCloseModal()">Cancel</button>
                    </div>
                </div>
            </div>


            <div class="child-section" id="product-inventory-section">

                <div class="section-header"
                    style="margin-bottom: 20px; padding: 15px 20px; border-radius: 6px; background-color: #f3e5f5; border: 1px solid #e1bee7; box-shadow: 0 2px 6px rgba(0,0,0,0.05); display: flex; flex-direction: column; gap: 6px;">
                    <h1 class="section-title" style="margin: 0 0 8px 0; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-boxes" style="color: #6a1b9a;"></i>
                        Product Inventory
                    </h1>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Product Inventory Overview</h2>
                        <button class="btn-primary" id="addInventoryBtn">
                            <i class="fas fa-plus"></i> Add Product
                        </button>
                    </div>

                    <!-- Stats Cards -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Total Products</div>
                                    <div class="stat-value">28</div>
                                    <div class="stat-change">
                                        <svg fill="none" height="12" stroke="currentColor" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="12">
                                            <polyline points="18 15 12 9 6 15"></polyline>
                                        </svg>
                                        12%
                                    </div>
                                </div>
                            </div>
                            <div class="stat-chart">
                                <canvas class="mini-chart" id="totalProductsChart"></canvas>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Total Stock Value</div>
                                    <div class="stat-value">₹2.8M</div>
                                    <div class="stat-change">
                                        <svg fill="none" height="12" stroke="currentColor" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="12">
                                            <polyline points="18 15 12 9 6 15"></polyline>
                                        </svg>
                                        8.5%
                                    </div>
                                </div>
                            </div>
                            <div class="stat-chart">
                                <canvas class="mini-chart" id="stockValueChart"></canvas>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Avg. Stock Days</div>
                                    <div class="stat-value">14</div>
                                    <div class="stat-change down">
                                        <svg fill="none" height="12" stroke="currentColor" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="12">
                                            <polyline points="6 9 12 15 18 9"></polyline>
                                        </svg>
                                        2
                                    </div>
                                </div>
                            </div>
                            <div class="stat-chart">
                                <canvas class="mini-chart" id="stockDaysChart"></canvas>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Low Stock Items</div>
                                    <div class="stat-value">5</div>
                                    <div class="stat-change">
                                        <svg fill="none" height="12" stroke="currentColor" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="12">
                                            <polyline points="18 15 12 9 6 15"></polyline>
                                        </svg>
                                        1
                                    </div>
                                </div>
                            </div>
                            <div class="stat-chart">
                                <canvas class="mini-chart" id="lowStockChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Current Stock Table -->
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Current Stock Levels</h2>
                        <div>
                            <input id="inventorySearch" placeholder="Search products..." type="text" />
                            <select id="inventoryFilter" style="margin-left: 10px;">
                                <option value="all">All Products</option>
                                <option value="low">Low Stock</option>
                                <option value="liquid">Liquid Milk</option>
                                <option value="cheese">Cheese Products</option>
                                <option value="dairy">Dairy Fat</option>
                            </select>
                        </div>
                    </div>
                    <table class="recent-orders">
                        <thead>
                            <tr>
                                <th>Product ID</th>
                                <th>Product Name</th>
                                <th>Category</th>
                                <th>Current Stock</th>
                                <th>Min. Stock</th>
                                <th>Unit Price</th>
                                <th>Stock Value</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>PD-1001</td>
                                <td>Standard Milk (1L)</td>
                                <td>Liquid Milk</td>
                                <td>12,500</td>
                                <td>5,000</td>
                                <td>₹45</td>
                                <td>₹562,500</td>
                                <td><span class="status completed">In Stock</span></td>
                            </tr>
                            <tr>
                                <td>PD-1002</td>
                                <td>Toned Milk (1L)</td>
                                <td>Liquid Milk</td>
                                <td>10,800</td>
                                <td>5,000</td>
                                <td>₹40</td>
                                <td>₹432,000</td>
                                <td><span class="status completed">In Stock</span></td>
                            </tr>
                            <tr>
                                <td>PD-1003</td>
                                <td>Pure Ghee (1kg)</td>
                                <td>Dairy Fat</td>
                                <td>1,350</td>
                                <td>500</td>
                                <td>₹500</td>
                                <td>₹675,000</td>
                                <td><span class="status completed">In Stock</span></td>
                            </tr>
                            <tr>
                                <td>PD-1004</td>
                                <td>Fresh Paneer (1kg)</td>
                                <td>Cheese</td>
                                <td>850</td>
                                <td>300</td>
                                <td>₹200</td>
                                <td>₹170,000</td>
                                <td><span class="status completed">In Stock</span></td>
                            </tr>
                            <tr>
                                <td>PD-1005</td>
                                <td>Flavored Milk (500ml)</td>
                                <td>Liquid Milk</td>
                                <td>3,200</td>
                                <td>2,000</td>
                                <td>₹30</td>
                                <td>₹96,000</td>
                                <td><span class="status completed">In Stock</span></td>
                            </tr>
                            <tr>
                                <td>PD-1006</td>
                                <td>Yogurt (500g)</td>
                                <td>Fermented</td>
                                <td>2,600</td>
                                <td>1,500</td>
                                <td>₹50</td>
                                <td>₹130,000</td>
                                <td><span class="status completed">In Stock</span></td>
                            </tr>
                            <tr>
                                <td>PD-1007</td>
                                <td>Cheese Slice (200g)</td>
                                <td>Cheese</td>
                                <td>420</td>
                                <td>500</td>
                                <td>₹80</td>
                                <td>₹33,600</td>
                                <td><span class="status pending">Low Stock</span></td>
                            </tr>
                            <tr>
                                <td>PD-1008</td>
                                <td>Butter (100g)</td>
                                <td>Dairy Fat</td>
                                <td>380</td>
                                <td>500</td>
                                <td>₹60</td>
                                <td>₹22,800</td>
                                <td><span class="status pending">Low Stock</span></td>
                            </tr>
                        </tbody>
                    </table>
                    <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                        <div>
                            Showing 1 to 8 of 28 products
                        </div>
                        <div>
                            <button class="btn-primary">Previous</button>
                            <button class="btn-primary">Next</button>
                        </div>
                    </div>
                </div>

                <!-- Inventory Charts -->
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Inventory Analytics</h2>
                        <select id="inventoryTimeRange" style="padding: 8px;">
                            <option value="7d">Last 7 Days</option>
                            <option value="30d">Last 30 Days</option>
                            <option value="90d">Last 90 Days</option>
                        </select>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Stock by Category</h3>
                            <canvas height="200" id="stockCategoryChart"></canvas>
                        </div>
                        <div class="stat-card">
                            <h3>Inventory Turnover</h3>
                            <canvas height="280" id="inventoryTurnoverChart"></canvas>
                        </div>
                    </div>
                </div>





                <!-- Add Product Form (hidden by default) -->
                <div class="content-section" id="addProductForm" style="display: none;">
                    <div class="section-header">
                        <h3 class="section-title">Add New Product</h3>
                        <button class="btn-primary" id="closeProductForm">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>
                    <form id="productForm">
                        <div class="profile-grid">
                            <label for="productName">Product Name</label>
                            <input id="productName" required type="text" />

                            <label for="productCategory">Category</label>
                            <select id="productCategory" required>
                                <option value="">Select Category</option>
                                <option value="liquid">Liquid Milk</option>
                                <option value="cheese">Cheese Products</option>
                                <option value="dairy">Dairy Fat</option>
                                <option value="fermented">Fermented Products</option>
                                <option value="other">Other</option>
                            </select>

                            <label for="productCode">Product Code</label>
                            <input id="productCode" required type="text" />

                            <label for="productUnit">Unit of Measure</label>
                            <select id="productUnit" required>
                                <option value="liter">Liter</option>
                                <option value="kg">Kilogram</option>
                                <option value="g">Gram</option>
                                <option value="ml">Milliliter</option>
                                <option value="pack">Pack</option>
                            </select>

                            <label for="productPrice">Unit Price (₹)</label>
                            <input id="productPrice" required type="number" step="0.01" />

                            <label for="productMinStock">Minimum Stock Level</label>
                            <input id="productMinStock" required type="number" />

                            <label for="productShelfLife">Shelf Life (Days)</label>
                            <input id="productShelfLife" required type="number" />

                            <label for="productDescription">Description</label>
                            <textarea id="productDescription" rows="3"></textarea>
                        </div>
                        <div style="margin-top: 20px;">
                            <button class="btn-success" type="submit">
                                <i class="fas fa-save"></i> Save Product
                            </button>
                            <button class="btn-primary" id="cancelProductForm" style="margin-left: 10px;" type="button">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="child-section" id="inventory-movements-section">
                <div class="section-header">
                    <h1 class="section-title"><i class="fas fa-exchange-alt"></i> Inventory Movements</h1>
                    <button class="btn-primary" onclick="openMovementModal()">+ Add Movement</button>
                </div>

                <!-- Table -->
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-table"></i> Movement Records</h2>
                    </div>
                    <table class="summary-table" id="movementTable">
                        <thead>
                            <tr>
                                <th>Date/Time</th>
                                <th>Product</th>
                                <th>Quantity</th>
                                <th>Type</th>
                                <th>Source</th>
                                <th>Destination</th>
                                <th>Remarks</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="movementTableBody"></tbody>
                    </table>
                </div>

                <!-- Charts -->
                <div class="content-section">

                    <div class="content-section">
                        <div class="section-header">
                            <h2 class="section-title"><i class="fas fa-chart-pie"></i> Movement Summary</h2>
                        </div>

                        <div class="chart-wrapper"
                            style="width: 70%; margin: 20px auto; display: flex; justify-content: space-between; gap: 20px; flex-wrap: wrap;">

                            <!-- Movements by Type Chart -->
                            <div class="chart-box"
                                style="flex: 1 1 48%; padding: 15px; background: #fff; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center;">
                                <h3 style="font-size: 1rem; margin-bottom: 10px; color: #333;">Movements by Type</h3>
                                <canvas id="movementTypeChart" style="width: 100%; height: 200px;"></canvas>
                            </div>

                            <!-- Quantities by Date Chart -->
                            <div class="chart-box"
                                style="flex: 1 1 48%; padding: 15px; background: #fff; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center;">
                                <h3 style="font-size: 1rem; margin-bottom: 10px; color: #333;">Quantities by Date</h3>
                                <canvas id="movementQuantityChart" style="width: 100%; height: 300px;"></canvas>
                            </div>

                        </div>

                    </div>

                </div>



                <!-- Modal -->
                <div class="modal-overlay" id="movementModal" style="display: none;">
                    <div class="modal-box">
                        <h3 id="modalTitle">Add Inventory Movement</h3>
                        <input type="hidden" id="editIndex">
                        <label>Product</label><input type="text" id="product">
                        <label>Quantity</label><input type="number" id="quantity">
                        <label>Type</label>
                        <select id="type">
                            <option value="Inbound">Inbound</option>
                            <option value="Outbound">Outbound</option>
                            <option value="Transfer">Transfer</option>
                        </select>
                        <label>Source</label><input type="text" id="source">
                        <label>Destination</label><input type="text" id="destination">
                        <label>Remarks</label><input type="text" id="remarks">
                        <button class="btn-success" onclick="saveMovement()">Save</button>
                        <button class="btn-primary" onclick="closeMovementModal()">Cancel</button>
                    </div>
                </div>
            </div>


            <section class="child-section" id="distribution-section">

                <div class="section-header"
                    style="margin-bottom: 20px; padding: 15px 20px; border-radius: 6px; background-color: #f3e5f5; border: 1px solid #e1bee7; box-shadow: 0 2px 6px rgba(0,0,0,0.05); display: flex; flex-direction: column; gap: 6px;">
                    <h1 class="section-title" style="margin: 0 0 8px 0; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-truck" style="color: #6a1b9a;"></i>
                        Distribution
                    </h1>
                </div>
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Distribution Management</h2>
                        <button class="btn-primary" onclick="distributionShowForm()"><i class="fas fa-plus"></i> Add
                            Distribution</button>
                    </div>

                    <div class="stats-grid"
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div class="stat-card"
                            style="background: var(--card-bg); padding: 15px; border-radius: 8px; text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
                            <h3 style="margin-bottom: 10px;">Total Distributions</h3>
                            <div id="distribution-total" style="font-size: 1.5rem; font-weight: bold;">0</div>
                        </div>
                        <div class="stat-card"
                            style="background: var(--card-bg); padding: 15px; border-radius: 8px; text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
                            <h3 style="margin-bottom: 10px;">Total Quantity</h3>
                            <div id="distribution-quantity" style="font-size: 1.5rem; font-weight: bold;">0</div>
                        </div>
                        <div class="stat-card"
                            style="background: var(--card-bg); padding: 15px; border-radius: 8px; text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
                            <h3 style="margin-bottom: 10px;">Pending Deliveries</h3>
                            <div id="distribution-pending" style="font-size: 1.5rem; font-weight: bold;">0</div>
                        </div>
                        <div class="stat-card"
                            style="background: var(--card-bg); padding: 15px; border-radius: 8px; text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
                            <h3 style="margin-bottom: 10px;">Completed Deliveries</h3>
                            <div id="distribution-completed" style="font-size: 1.5rem; font-weight: bold;">0</div>
                        </div>
                    </div>


                    <div style="margin: 15px 0;">
                        <input type="text" id="distribution-search" placeholder="Search by Product or Destination..."
                            class="hdr-search" oninput="distributionRenderTable()">
                        <select id="distribution-status-filter" class="hdr-search" onchange="distributionRenderTable()">
                            <option value="">All Status</option>
                            <option>Pending</option>
                            <option>Dispatched</option>
                            <option>Delivered</option>
                        </select>
                    </div>

                    <table class="summary-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Product</th>
                                <th>Quantity</th>
                                <th>Destination</th>
                                <th>Driver</th>
                                <th>Vehicle</th>
                                <th>Status</th>
                                <th style="text-align:center;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="distribution-tbody"></tbody>
                    </table>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Status Split</h3>
                            <canvas id="distributionStatusChart"
                                style="width:100%; height:300px; max-height:300px;"></canvas>
                        </div>
                        <div class="stat-card">
                            <h3>Quantity by Product</h3>
                            <canvas id="distributionProductChart"
                                style="width:100%; height:300px; max-height:300px;"></canvas>
                        </div>
                    </div>

                    <div>
                        <button class="btn-primary" onclick="distributionExportCSV()">Export CSV</button>
                        <button class="btn-primary" onclick="distributionExportPDF()">Export PDF</button>
                    </div>

                </div>

                <!-- Distribution Form Modal -->
                <div id="distribution-form-modal" class="modal-overlay" style="display:none;">
                    <div class="modal-box">
                        <h3 id="distribution-form-title">Add Distribution</h3>
                        <form id="distribution-form" onsubmit="distributionSave(event)">
                            <input type="hidden" id="distribution-id">

                            <label>Date:</label>
                            <input type="date" id="distribution-date" required>

                            <label>Product Type:</label>
                            <input type="text" id="distribution-product" required>

                            <label>Quantity:</label>
                            <input type="number" id="distribution-quantity-input" required>

                            <label>Destination:</label>
                            <input type="text" id="distribution-destination" required>

                            <label>Driver Name:</label>
                            <input type="text" id="distribution-driver" required>

                            <label>Vehicle Number:</label>
                            <input type="text" id="distribution-vehicle" required>

                            <label>Status:</label>
                            <select id="distribution-status" required>
                                <option>Pending</option>
                                <option>Dispatched</option>
                                <option>Delivered</option>
                            </select>

                            <div style="margin-top:10px; display:flex; gap:10px; justify-content:flex-end;">
                                <button type="submit" class="btn-primary">Save</button>
                                <button type="button" class="edit-btn" onclick="distributionCloseForm()">Cancel</button>
                            </div>
                        </form>


                    </div>
                </div>


            </section>

            <div class="child-section" id="delivery-routes-section">
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-route"></i> Delivery Routes</h2>
                        <button class="btn-primary" onclick="openRouteForm()">
                            <i class="fas fa-plus"></i> Add Route
                        </button>
                    </div>

                    <!-- Form -->
                    <div id="routeFormContainer" class="content-section" style="display: none;">
                        <div class="section-header">
                            <h3 class="section-title" id="formTitle">Add New Route</h3>
                            <button class="btn-primary" onclick="closeRouteForm()">
                                <i class="fas fa-times"></i> Close
                            </button>
                        </div>
                        <form id="routeForm">
                            <input type="hidden" id="routeId" />
                            <div class="profile-grid">
                                <label>Driver Name</label><input type="text" id="driver" required />
                                <label>Vehicle ID</label><input type="text" id="vehicle" required />
                                <label>Start Location</label><input type="text" id="start" required />
                                <label>End Location</label><input type="text" id="end" required />
                                <label>Route Date</label><input type="date" id="date" required />
                                <label>Status</label>
                                <select id="status" required>
                                    <option value="Scheduled">Scheduled</option>
                                    <option value="In Transit">In Transit</option>
                                    <option value="Delivered">Delivered</option>
                                </select>
                            </div>
                            <button type="submit" class="btn-success">
                                <i class="fas fa-save"></i> Save Route
                            </button>
                        </form>
                    </div>

                    <!-- Filters -->
                    <div class="content-section">
                        <input class="hdr-search" id="searchInput" placeholder="Search by Driver or Vehicle" />
                        <select id="statusFilter" class="hdr-search">
                            <option value="">All Status</option>
                            <option value="Scheduled">Scheduled</option>
                            <option value="In Transit">In Transit</option>
                            <option value="Delivered">Delivered</option>
                        </select>
                    </div>

                    <!-- Table -->
                    <div class="content-section" id="routesTableContainer">
                        <table class="recent-orders">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Driver</th>
                                    <th>Vehicle</th>
                                    <th>Start</th>
                                    <th>End</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="routesTable"></tbody>
                        </table>
                    </div>

                    <!-- Charts -->
                    <div class="stats-grid" style="display: flex; gap: 30px; justify-content: center; flex-wrap: wrap;">
                        <!-- Bar Chart -->
                        <div class="stat-card"
                            style="flex: 1 1 400px; max-width: 450px; display: flex; flex-direction: column; align-items: center;">
                            <h3 style="text-align: center;">Routes per Status</h3>
                            <canvas id="statusChart" style="width: 100% !important; height: 300px !important;"></canvas>
                        </div>

                        <!-- Pie Chart -->
                        <div class="stat-card"
                            style="flex: 1 1 400px; max-width: 450px; display: flex; flex-direction: column; align-items: center;">
                            <h3 style="text-align: center;">Routes by Driver</h3>
                            <div style="width: 100%; max-width: 400px; aspect-ratio: 1 / 1;">
                                <canvas id="driverChart"
                                    style="width: 100% !important; height: 300px !important;"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Export Buttons -->
                    <div style="margin-top: 20px;">
                        <button class="btn-primary" onclick="exportToPDF()">
                            <i class="fas fa-file-pdf"></i> Export to PDF
                        </button>
                    </div>
                </div>
            </div>



            <!-- 🚛 Fleet Management: Functional UI -->
            <div class="child-section" id="fleet-management-section">  
                <div class="section-header">
                    <h2 class="section-title"><i class="fas fa-truck-moving"></i> Fleet Management
                    </h2>

                </div>


                <!-- Overview Stats -->
                <div id="fleetStats" style="
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    gap: 20px;
    margin-top: 30px;
">

                    <div style="
        flex: 1 1 calc(25% - 20px);
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        padding: 20px;
        text-align: center;
    ">
                        <h3 style="color: #1a237e; font-size: 18px; margin-bottom: 10px;">Total Vehicles</h3>
                        <div id="fleet-total" style="font-size: 26px; font-weight: bold; color: #2c3e50;">4</div>
                    </div>

                    <div style="
        flex: 1 1 calc(25% - 20px);
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        padding: 20px;
        text-align: center;
    ">
                        <h3 style="color: #1a237e; font-size: 18px; margin-bottom: 10px;">Active Drivers</h3>
                        <div id="fleet-drivers" style="font-size: 26px; font-weight: bold; color: #2c3e50;">4</div>
                    </div>

                    <div style="
        flex: 1 1 calc(25% - 20px);
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        padding: 20px;
        text-align: center;
    ">
                        <h3 style="color: #1a237e; font-size: 18px; margin-bottom: 10px;">Deliveries</h3>
                        <div id="fleet-deliveries" style="font-size: 26px; font-weight: bold; color: #2c3e50;">8
                        </div>
                    </div>

                    <div style="
        flex: 1 1 calc(25% - 20px);
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        padding: 20px;
        text-align: center;
    ">
                        <h3 style="color: #1a237e; font-size: 18px; margin-bottom: 10px;">Breakdowns</h3>
                        <div id="fleet-breakdowns" style="font-size: 26px; font-weight: bold; color: #c0392b;">2
                        </div>
                    </div>

                </div><br>

                <!-- Vehicle Table -->
                <div class="content-section">
                    <div class="section-header">

                        <h2 class="section-title">Vehicle Management</h2>
                        <div>
                            <button class="btn-success" onclick="showFleetModal()">+ Add Vehicle</button>
                            <button class="btn-primary" onclick="exportFleetToCSV()">Export CSV</button>
                        </div>
                    </div>
                    <table class="recent-orders">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Type</th>
                                <th>Driver</th>
                                <th>Status</th>
                                <th>Capacity</th>
                                <th>Last Maint.</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="fleetTableBody"></tbody>
                    </table>
                </div>

                <!-- Modal -->
                <div id="fleetModal"
                    style="display:none; position:fixed; z-index:9999; background:#fff; top:10%; left:50%; transform:translateX(-50%); padding:20px; border-radius:8px; width:90%; max-width:500px; box-shadow:0 0 10px rgba(0,0,0,0.3);">
                    <h3 id="fleetModalTitle">Add Vehicle</h3>
                    <form onsubmit="saveFleetVehicle(event)">
                        <input type="hidden" id="fleetIndex">
                        <label>Vehicle ID</label><input type="text" id="fleetId" required>
                        <label>Type</label><input type="text" id="fleetType" required>
                        <label>Driver</label><input type="text" id="fleetDriver" required>
                        <label>Status</label>
                        <select id="fleetStatus">
                            <option>Active</option>
                            <option>Under Maintenance</option>
                            <option>Retired</option>
                        </select>
                        <label>Capacity</label><input type="text" id="fleetCapacity" required>
                        <label>Last Maintenance</label><input type="date" id="fleetLastMaint" required>
                        <div style="margin-top:10px;">
                            <button type="submit" class="btn-success">Save</button>
                            <button type="button" onclick="hideFleetModal()" class="btn-primary">Cancel</button>
                        </div>
                    </form>
                </div>

                <!-- Charts -->
                <div class="stats-grid" style="display: flex; gap: 30px; justify-content: center; flex-wrap: wrap;">
                    <!-- Doughnut Chart -->
                    <div class="stat-card"
                        style="flex: 1 1 400px; max-width: 400px; display: flex; flex-direction: column; align-items: center;">
                        <h3 style="text-align: center;">Utilization</h3>
                        <div style="width: 100%; max-width: 400px; aspect-ratio: 1 / 1;">
                            <canvas id="fleetUtilChart"
                                style="width: 100% !important; height: auto !important;"></canvas>
                        </div>
                    </div>

                    <!-- Bar Chart -->
                    <div class="stat-card"
                        style="flex: 1 1 400px; max-width: 400px; display: flex; flex-direction: column; align-items: center;">
                        <h3 style="text-align: center;">Breakdowns</h3>
                        <canvas id="fleetBreakChart" style="width: 100% !important; height: 300px !important;"></canvas>
                    </div>
                </div>
            </div>



            <!-- Retail Main Module Section -->
            <div class="child-section" id="retail-section">
                <div class="section-header"
                    style="margin-bottom: 20px; padding: 15px 20px; border-radius: 6px; background-color: #f3e5f5; border: 1px solid #e1bee7; box-shadow: 0 2px 6px rgba(0,0,0,0.05); display: flex; flex-direction: column; gap: 6px;">
                    <h1 class="section-title" style="margin: 0 0 8px 0; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-store" style="color: #6a1b9a;"></i>
                        Retail
                    </h1>
                </div>
                <div class="content-section retail-content">
                    <div class="section-header retail-header">
                        <h2 class="section-title">Retail Management</h2>
                        <div>
                            <button class="btn-primary" id="exportRetailCSV">
                                <i class="fas fa-file-export"></i> Export to CSV
                            </button>
                            <button class="btn-primary" id="addRetailBtn">
                                <i class="fas fa-plus"></i> Add Retail Entry
                            </button>
                        </div>
                    </div>

                    <!-- Add/Edit Retail Entry Form -->
                    <div class="content-section" id="retailFormContainer" style="display: none;">
                        <div class="section-header">
                            <h3 class="section-title">Retail Entry</h3>
                            <button class="btn-primary" id="closeRetailForm"><i class="fas fa-times"></i>
                                Close</button>
                        </div>
                        <form id="retailForm">
                            <div class="profile-grid">
                                <label for="retailName">Retail Name*</label>
                                <input type="text" id="retailName" required>

                                <label for="retailCity">City*</label>
                                <input type="text" id="retailCity" required>

                                <label for="retailOwner">Owner Name*</label>
                                <input type="text" id="retailOwner" required>

                                <label for="retailPhone">Contact Number*</label>
                                <input type="text" id="retailPhone" required>

                                <label for="retailEmail">Email</label>
                                <input type="email" id="retailEmail">

                                <label for="retailCategory">Category</label>
                                <select id="retailCategory">
                                    <option value="General">General</option>
                                    <option value="Franchise">Franchise</option>
                                    <option value="Supermarket">Supermarket</option>
                                    <option value="Convenience">Convenience</option>
                                    <option value="Department">Department</option>
                                </select>

                                <label for="retailStatus">Status*</label>
                                <select id="retailStatus" required>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                    <option value="pending">Pending Approval</option>
                                    <option value="closed">Closed</option>
                                </select>
                            </div>
                            <div style="margin-top: 20px;">
                                <button type="submit" class="btn-success"><i class="fas fa-save"></i>
                                    Save</button>
                                <button type="button" id="cancelRetailForm" class="btn-primary"
                                    style="margin-left: 10px;">Cancel</button>
                            </div>
                        </form>
                    </div>

                    <!-- Retail Table Search & Filter -->
                    <div class="section-header">
                        <h3 class="section-title">Retail List</h3>
                        <div>
                            <input type="text" id="retailSearch" placeholder="Search..." class="hdr-search">
                            <select id="retailFilter" style="margin-left: 10px; padding: 8px;">
                                <option value="all">All</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="pending">Pending</option>
                                <option value="closed">Closed</option>
                            </select>
                        </div>
                    </div>

                    <!-- Retail Entries Table -->
                    <table class="recent-orders">
                        <thead>
                            <tr>
                                <th>Retail</th>
                                <th>City</th>
                                <th>Owner</th>
                                <th>Contact</th>
                                <th>Email</th>
                                <th>Category</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="retailTableBody">
                            <!-- JS will populate rows -->
                        </tbody>
                    </table>

                    <!-- Retail Summary Table -->
                    <div class="content-section">
                        <h3 class="section-title">Retail Summary by Category</h3>
                        <table class="summary-table">
                            <thead>
                                <tr>
                                    <th>Category</th>
                                    <th>Total Outlets</th>
                                    <th>Active</th>
                                    <th>Inactive</th>
                                    <th>Pending</th>
                                    <th>Closed</th>
                                </tr>
                            </thead>
                            <tbody id="retailSummaryBody">
                                <!-- JS will populate summary -->
                            </tbody>
                        </table>
                    </div>

                   <!-- Extra Retail Details Section -->
                    <div class="content-section">
                        <h3 class="section-title">Retail Expansion Insights</h3>
                        <ul>
                            <li>Top 10 cities by outlet density</li>
                            <li>Year-over-year outlet growth trends</li>
                            <li>Category-wise outlet distribution analysis</li>
                            <li>Closed outlets and reasons for closure</li>
                            <li>Pending approvals and licensing updates</li>
                            <li>Upcoming launches for the next quarter</li>
                            <li>Average outlet capacity by category and location</li>
                            <li>Revenue estimation by retail type (future)</li>
                        </ul>
                        <p>Future enhancements may include real-time map integration, outlet profitability
                            stats,
                            mobile app sync, and role-based admin panels for franchisees and corporate teams.
                        </p>
                    </div>
                </div>
            </div>





            <section id="retail-outlets-section" class="child-section">
                <div class="section-header">
                    <div class="section-title">Retail Outlets</div>
                    <button class="btn-primary" onclick="showAddOutletModal()">Add Outlet</button>
                </div>
                <div class="content-section">
                    <table class="recent-orders" id="retail-outlet-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Location</th>
                                <th>Manager</th>
                                <th>Contact</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="retail-outlet-tbody">
                            <!-- Rows injected by JS -->
                        </tbody>
                    </table>
                </div>
                <div class="inventory-charts-grid"
                    style="display:grid;grid-template-columns:1fr 1fr;gap:30px;margin-top:20px;">
                    <div class="chart-card"
                        style="display:flex;flex-direction:column;align-items:center;background:#fff;border-radius:8px;padding:24px 10px 16px 10px;box-shadow:0 1px 4px rgba(0,0,0,0.06);min-width:0;min-height:0;">
                        <div class="stat-header" style="margin-bottom:12px;">
                            <span class="stat-title" style="font-size:1rem;font-weight:600;color:#0077b6;">Outlets
                                by Location (Bar)</span>
                        </div>
                        <div class="chart-container"
                            style="width:100%;height:320px;min-width:250px;min-height:250px;max-width:400px;max-height:320px;display:flex;align-items:center;justify-content:center;">
                            <canvas id="outletBarChart"
                                style="width:100%!important;height:100%!important;max-width:400px;max-height:320px;min-width:250px;min-height:250px;aspect-ratio:1/1;display:block;margin:0 auto;"></canvas>
                        </div>
                    </div>
                    <div class="chart-card"
                        style="display:flex;flex-direction:column;align-items:center;background:#fff;border-radius:8px;padding:24px 10px 16px 10px;box-shadow:0 1px 4px rgba(0,0,0,0.06);min-width:0;min-height:0;">
                        <div class="stat-header" style="margin-bottom:12px;">
                            <span class="stat-title" style="font-size:1rem;font-weight:600;color:#0077b6;">Manager
                                Distribution (Pie)</span>
                        </div>
                        <div class="chart-container"
                            style="width:100%;height:320px;min-width:250px;min-height:250px;max-width:400px;max-height:320px;display:flex;align-items:center;justify-content:center;">
                            <canvas id="outletPieChart"
                                style="width:100%!important;height:100%!important;max-width:400px;max-height:320px;min-width:250px;min-height:250px;aspect-ratio:1/1;display:block;margin:0 auto;"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Add/Edit Modal -->
                <div id="outlet-modal"
                    style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:2000;background:rgba(0,0,0,0.25);align-items:center;justify-content:center;">
                    <form id="outlet-form"
                        style="background:#fff;padding:22px 26px;border-radius:8px;min-width:340px;max-width:90vw;box-shadow:0 2px 10px rgba(0,0,0,0.2);"
                        onsubmit="event.preventDefault();saveOutlet();">
                        <h3 id="outlet-form-title" style="margin-bottom:12px;color:#0077b6;text-align:center;">
                            Add
                            Outlet</h3>
                        <input type="hidden" id="outlet-id">
                        <label style="display:block;font-weight:500;margin-top:8px;margin-bottom:4px;">Name</label>
                        <input type="text" id="outlet-name" required>
                        <label style="display:block;font-weight:500;margin-top:8px;margin-bottom:4px;">Location</label>
                        <input type="text" id="outlet-location" required>
                        <label style="display:block;font-weight:500;margin-top:8px;margin-bottom:4px;">Manager</label>
                        <input type="text" id="outlet-manager" required>
                        <label style="display:block;font-weight:500;margin-top:8px;margin-bottom:4px;">Contact</label>
                        <input type="text" id="outlet-contact" required>
                        <div class="modal-actions"
                            style="margin-top:10px;display:flex;gap:10px;justify-content:flex-end;">
                            <button type="submit" class="btn-primary">Save</button>
                            <button type="button" class="edit-btn" onclick="closeOutletModal()">Cancel</button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- Sales Data Section matching your existing style and layout -->
            <section id="sales-data-section" class="child-section">
                <div class="section-header">
                    <div class="section-title">
                        Sales Data
                    </div>
                    <button class="btn-primary" onclick="showAddSaleModal()">+ Add Sale</button>
                </div>
                <!-- Info Cards (styled like your stat-card grid) -->
                <div class="stats-grid" style="margin-bottom:18px;">
                    <div class="stat-card">
                        <div class="stat-title">Total Sales (₹)</div>
                        <div class="stat-value" id="sales-total">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Top Product</div>
                        <div class="stat-value" id="top-product">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Unique Customers</div>
                        <div class="stat-value" id="unique-customers">-</div>
                    </div>
                </div>
                <!-- Table -->
                <div class="content-section">
                    <table class="recent-orders" id="sales-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Product</th>
                                <th>Customer</th>
                                <th>Quantity</th>
                                <th>Amount (₹)</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="sales-tbody">
                            <!-- Rows injected by JS -->
                        </tbody>
                    </table>
                </div>
                <!-- Charts grid, matching your .stats-grid and .stat-card style -->
                <div class="stats-grid" style="margin-top:18px;grid-template-columns:1fr 1fr;">
                    <div class="stat-card" style="align-items:center;">
                        <div class="stat-title" style="margin-bottom:10px;">Monthly Sales Trend (Bar)</div>
                        <div
                            style="width:100%;height:320px;max-width:400px;max-height:320px;display:flex;align-items:center;justify-content:center;">
                            <canvas id="salesBarChart"
                                style="width:100%!important;height:100%!important;max-width:400px;max-height:320px;min-width:250px;min-height:250px;aspect-ratio:2/1;display:block;margin:0 auto;"></canvas>
                        </div>
                    </div>
                    <div class="stat-card" style="align-items:center;">
                        <div class="stat-title" style="margin-bottom:10px;">Product Share (Pie)</div>
                        <div
                            style="width:100%;height:320px;max-width:400px;max-height:320px;display:flex;align-items:center;justify-content:center;">
                            <canvas id="salesPieChart"
                                style="width:100%!important;height:100%!important;max-width:400px;max-height:320px;min-width:250px;min-height:250px;aspect-ratio:1/1;display:block;margin:0 auto;"></canvas>
                        </div>
                    </div>
                </div>
                <!-- Modal -->
                <div id="sale-modal"
                    style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:2000;background:rgba(0,0,0,0.23);align-items:center;justify-content:center;">
                    <form id="sale-form"
                        style="background:#fff;padding:24px 20px;border-radius:10px;min-width:320px;max-width:90vw;box-shadow:0 2px 14px rgba(0,0,0,0.12);"
                        onsubmit="event.preventDefault();saveSale();">
                        <h3 id="sale-form-title" style="margin-bottom:14px;color:#2a9d8f;text-align:center;">Add
                            Sale</h3>
                        <input type="hidden" id="sale-id">
                        <label style="display:block;font-weight:600;margin-top:8px;margin-bottom:4px;">Date</label>
                        <input type="date" id="sale-date" required>
                        <label style="display:block;font-weight:600;margin-top:8px;margin-bottom:4px;">Product</label>
                        <input type="text" id="sale-product" required>
                        <label style="display:block;font-weight:600;margin-top:8px;margin-bottom:4px;">Customer</label>
                        <input type="text" id="sale-customer" required>
                        <label style="display:block;font-weight:600;margin-top:8px;margin-bottom:4px;">Quantity</label>
                        <input type="number" id="sale-quantity" min="1" required>
                        <label style="display:block;font-weight:600;margin-top:8px;margin-bottom:4px;">Amount
                            (₹)</label>
                        <input type="number" id="sale-amount" min="1" required>
                        <div class="modal-actions"
                            style="margin-top:12px;display:flex;gap:12px;justify-content:flex-end;">
                            <button type="submit" class="btn-primary" style="font-size:1rem;">Save</button>
                            <button type="button" class="edit-btn" style="font-size:1rem;"
                                onclick="closeSaleModal()">Cancel</button>
                        </div>
                    </form>
                </div>
            </section>

            <div id="reports-section" class="child-section">
                <div class="section-header"
                    style="margin-bottom: 20px; padding: 15px 20px; border-radius: 6px; background-color: #f3e5f5; border: 1px solid #e1bee7; box-shadow: 0 2px 6px rgba(0,0,0,0.05); display: flex; flex-direction: column; gap: 6px;">
                    <h1 class="section-title" style="margin: 0 0 8px 0; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-chart-pie" style="color: #6a1b9a;"></i>
                        Reports
                    </h1>
                </div>
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Reports Management</h2>
                        <div>
                            <button class="btn-primary" onclick="reportsOpenForm()"><i class="fas fa-plus"></i> Add New
                                Report</button>
                            <button class="btn-primary" onclick="reportsExportCSV()">Export to CSV</button>
                        </div>
                    </div>

                    <!-- Stats -->
                    <div class="stats-grid"
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div class="stat-card"
                            style="background: var(--card-bg); padding: 15px; border-radius: 8px; text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
                            <h3 style="margin-bottom: 10px;">Total Reports</h3>
                            <div id="reports-total-count" style="font-size: 1.5rem; font-weight: bold;">0</div>
                        </div>
                        <div class="stat-card"
                            style="background: var(--card-bg); padding: 15px; border-radius: 8px; text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
                            <h3 style="margin-bottom: 10px;">Sales Reports</h3>
                            <div id="reports-sales-count" style="font-size: 1.5rem; font-weight: bold;">0</div>
                        </div>
                        <div class="stat-card"
                            style="background: var(--card-bg); padding: 15px; border-radius: 8px; text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
                            <h3 style="margin-bottom: 10px;">Inventory Reports</h3>
                            <div id="reports-inventory-count" style="font-size: 1.5rem; font-weight: bold;">0</div>
                        </div>
                    </div>


                    <!-- Search & Filter -->
                    <div style="margin:10px 0; display:flex; gap:10px;">
                        <input type="text" id="reports-search-input" placeholder="Search by Title or Type"
                            style="flex:1; padding:8px;">
                        <select id="reports-filter-type" onchange="reportsRenderTable()" style="padding:8px;">
                            <option value="">All Types</option>
                            <option value="Sales">Sales</option>
                            <option value="Inventory">Inventory</option>
                            <option value="Distribution">Distribution</option>
                            <option value="Quality">Quality</option>
                            <option value="Payments">Payments</option>
                        </select>
                    </div>

                    <!-- Table -->
                    <table class="summary-table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Type</th>
                                <th>Date</th>
                                <th>Created By</th>
                                <th>Description</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="reports-table-body"></tbody>
                    </table>

                    <div
                        style="background-color: #ffffff; border-radius: 8px; padding: 20px; margin-top: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #caf0f8;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #caf0f8;">
                            <h2 style="color: #0077b6; font-size: 1.4rem;">Reports Distribution by Type</h2>
                        </div>
                        <div style="height: 350px;">
                            <canvas id="reports-chart" style="max-height: 100%;"></canvas>
                        </div>
                    </div>


                </div>

                <!-- Form -->
                <div class="content-section" id="reports-form-container" style="display:none;">
                    <h3 id="reports-form-title">Add New Report</h3>
                    <input type="hidden" id="reports-edit-id">

                    <label>Report Title:</label>
                    <input type="text" id="reports-title">

                    <label>Report Type:</label>
                    <select id="reports-type">
                        <option value="">Select Type</option>
                        <option value="Sales">Sales</option>
                        <option value="Inventory">Inventory</option>
                        <option value="Distribution">Distribution</option>
                        <option value="Quality">Quality</option>
                        <option value="Payments">Payments</option>
                    </select>

                    <label>Date:</label>
                    <input type="date" id="reports-date">

                    <label>Created By:</label>
                    <input type="text" id="reports-createdby">

                    <label>Description:</label>
                    <textarea id="reports-description" rows="3"></textarea>

                    <div style="margin-top:10px; display:flex; gap:10px; justify-content:flex-end;">
                        <button class="btn-success" onclick="reportsSave()">Save</button>
                        <button class="edit-btn" onclick="reportsCloseForm()">Cancel</button>
                    </div>
                </div>
            </div>

            

            <!-- Financial Reports Module -->
            <div id="financial-reports-section" class="child-section">
                <div class="content-section">
                    <div class="section-header" style="align-items:flex-end;">
                        <span class="section-title"><i class="fas fa-file-invoice-dollar"></i> Financial
                            Reports</span>
                        <div>
                            <button class="btn-primary" onclick="exportFinancialPDF()">Export PDF</button>
                            <button class="btn-success" onclick="exportFinancialCSV()">Export CSV</button>
                        </div>
                    </div>

                    <div id="financial-summary-dashboard" class="stats-grid" style="margin-bottom: 18px;">
                        <div class="stat-card">
                            <h3>Total Income</h3>
                            <div class="stat-value" id="fin-total-income">₹0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Total Expenses</h3>
                            <div class="stat-value" id="fin-total-expense">₹0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Net Profit</h3>
                            <div class="stat-value" id="fin-net-profit">₹0</div>
                        </div>
                    </div>

                    <form id="fin-form" onsubmit="handleFinancialSubmit(event)" class="content-section">
                        <input type="hidden" id="fin-edit-index">
                        <div class="stats-grid" style="gap: 12px;">
                            <div><label>Date</label><input type="date" id="fin-date" required></div>
                            <div><label>Category</label>
                                <select id="fin-category" required>
                                    <option value="">Select</option>
                                    <option value="Income">Income</option>
                                    <option value="Expense">Expense</option>
                                </select>
                            </div>
                            <div><label>Type</label>
                                <select id="fin-type" required>
                                    <option value="">Select</option>
                                    <option value="Cash">Cash</option>
                                    <option value="Bank">Bank</option>
                                </select>
                            </div>
                            <div><label>Amount</label><input type="number" id="fin-amount" required min="0.01"
                                    step="0.01"></div>
                            <div><label>Description</label><input type="text" id="fin-desc" required></div>
                            <div><label>Ref #</label><input type="text" id="fin-ref"></div>
                            <div style="align-self:end;">
                                <button class="btn-primary" type="submit" id="fin-submit-btn">Add</button>
                                <button class="btn-secondary" type="button" onclick="resetFinForm()" id="fin-cancel-btn"
                                    style="display:none;">Cancel</button>
                            </div>
                        </div>
                    </form>

                    <div class="content-section" style="overflow-x:auto;">
                        <table class="summary-table" id="fin-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Category</th>
                                    <th>Description</th>
                                    <th>Type</th>
                                    <th>Amount</th>
                                    <th>Ref</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <!-- Stats Grid Wrapper -->
                    <div class="stats-grid"
                        style="display: flex; justify-content: space-between; gap: 20px; flex-wrap: wrap; margin-top: 30px;">

                        <!-- Income vs Expense Chart -->
                        <div class="content-section"
                            style="flex: 1; min-width: 400px; max-width: 600px; height: 400px; background: #fff; border-radius: 12px; padding: 20px; box-sizing: border-box; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05); display: flex; flex-direction: column; justify-content: space-between;">
                            <h3 style="text-align:center; font-weight: bold; margin: 0;">Income vs Expense</h3>
                            <div
                                style="flex: 1; width: 100%; display: flex; align-items: center; justify-content: center;">
                                <canvas id="fin-bar-chart"
                                    style="width: 100% !important; height: 100% !important;"></canvas>
                            </div>
                        </div>

                        <!-- Expense Breakdown Chart -->
                        <div class="content-section"
                            style="flex: 1; min-width: 400px; max-width: 600px; height: 400px; background: #fff; border-radius: 12px; padding: 20px; box-sizing: border-box; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05); display: flex; flex-direction: column; justify-content: space-between;">
                            <h3 style="text-align:center; font-weight: bold; margin: 0;">Expense Breakdown</h3>
                            <div
                                style="flex: 1; width: 100%; display: flex; align-items: center; justify-content: center;">
                                <canvas id="fin-pie-chart"
                                    style="width: 100% !important; height: 100% !important;"></canvas>
                            </div>
                        </div>

                    </div>
                </div>
            </div>


            <!-- User Management Section -->
            <div id="user-management-section" class="child-section">
                <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;
         border: 1px solid #ddd; padding: 16px; border-radius: 8px; background: #fff;
         margin-bottom: 24px; box-shadow: 0 2px 6px rgba(0,0,0,0.04); gap: 10px;">

                    <span class="section-title" style="font-size: 22px; font-weight: 600;">
                        <i class="fa fa-users" style="margin-right: 8px;"></i> User Management
                    </span>

                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <input type="text" id="userSearch" placeholder="Search users..." class="hdr-search"
                            style="min-width: 140px;" />
                        <select id="roleFilter" class="hdr-search" style="min-width: 140px;">
                            <option value="">All Roles</option>
                            <option value="admin">Admin</option>
                            <option value="manager">Manager</option>
                            <option value="auditor">Auditor</option>
                            <option value="user">User</option>
                        </select>
                        <button id="open-add-user-form-btn" class="btn-primary">
                            <i class="fa fa-user-plus"></i> Add User
                        </button>
                    </div>
                </div>


                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-title">Total Users</div>
                        <div class="stat-value" id="total-users">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Admins</div>
                        <div class="stat-value" id="total-admins">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Managers</div>
                        <div class="stat-value" id="total-managers">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Auditors</div>
                        <div class="stat-value" id="total-auditors">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Users</div>
                        <div class="stat-value" id="total-users-role">0</div>
                    </div>
                </div>

                <!-- Add User Modal -->
                <div id="add-user-modal" style="display:none;" class="modal-overlay">
                    <div class="modal-box">
                        <button class="back-btn" id="close-add-user-form-btn" style="float: right;">
                            <i class="fa fa-trash"></i> Close
                        </button>

                        <h3>Add New User</h3>
                        <form id="add-user-form">
                            <label>Name</label>
                            <input type="text" name="name" required />
                            <label>Email</label>
                            <input type="email" name="email" required />
                            <label>Phone</label>
                            <input type="tel" name="phone" required />
                            <label>Role</label>
                            <select name="role" id="role-select" required>
                                <option value="admin">Admin</option>
                                <option value="manager">Manager</option>
                                <option value="auditor">Auditor</option>
                                <option value="user">User</option>
                            </select>
                            <div id="permission-preview" class="permissions-preview">
                                <strong>Permissions:</strong>
                                <ul id="permissions-list"></ul>
                            </div>
                            <button class="btn-success" type="submit">Add User</button>
                        </form>
                    </div>
                </div>

                <!-- User Table -->
                <div class="content-section">
                    <h3 class="section-title"><i class="fa fa-users"></i> Users List</h3>
                    <table class="summary-table" id="users-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Role</th>
                                <th>Permissions</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div id="system-settings-section" class="child-section">

                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fa fa-sliders-h"></i> General Settings</h2>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">Site/Application Name</label>
                        <input type="text" id="siteName" placeholder="Enter application name">
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">Logo Upload</label>
                        <input type="file" id="siteLogo" onchange="previewLogo(event)">
                        <div id="logoPreviewContainer" style="margin-top: 10px;"></div>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">Default Language</label>
                        <select id="defaultLanguage">
                            <option value="en">English</option>
                            <option value="hi">Hindi</option>
                            <option value="te">Telugu</option>
                            <option value="de">German</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">Timezone</label>
                        <select id="timezone">
                            <option value="Asia/Kolkata">Asia/Kolkata</option>
                            <option value="UTC">UTC</option>
                            <option value="America/New_York">America/New_York</option>
                            <option value="Europe/Berlin">Europe/Berlin</option>
                        </select>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fa fa-user-cog"></i> User Preferences</h2>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">Enable Dark Mode</label>
                        <label class="switch">
                            <input type="checkbox" id="darkModeToggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">Date/Time Format</label>
                        <select id="datetimeFormat">
                            <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                            <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                            <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">Enable Notifications</label>
                        <label class="switch">
                            <input type="checkbox" id="notificationsToggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fa fa-shield-alt"></i> Security Settings</h2>
                    </div>
                    <div class="setting-item">
                        <button class="btn-primary" onclick="forcePasswordReset()">Force Password Reset</button>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">Enable 2-Factor Authentication</label>
                        <label class="switch">
                            <input type="checkbox" id="twoFactorAuth">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">Session Timeout</label>
                        <select id="sessionTimeout">
                            <option value="15">15 Minutes</option>
                            <option value="30">30 Minutes</option>
                            <option value="60">1 Hour</option>
                        </select>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fa fa-database"></i> Backup & Restore</h2>
                    </div>
                    <div class="setting-item">
                        <button class="btn-primary" onclick="downloadBackup()">Download Full Backup</button>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">Upload Backup File</label>
                        <input type="file" id="uploadBackupFile">
                    </div>
                    <div class="setting-item" style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap;">
                        <label class="setting-label" style="min-width: 150px;">Enable Auto Backup</label>

                        <label class="switch">
                            <input type="checkbox" id="autoBackupToggle">
                            <span class="slider"></span>
                        </label>

                        <select id="backupFrequency" style="padding: 10px 10px; font-size: 13px;">
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                        </select>
                    </div>

                </div>

                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fa fa-eye"></i> System Logs & Monitoring</h2>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">Filter Logs</label>
                        <input type="date" id="logDateFilter">
                        <select id="logTypeFilter">
                            <option value="all">All</option>
                            <option value="error">Error</option>
                            <option value="info">Info</option>
                            <option value="warning">Warning</option>
                        </select>
                        <button class="btn-primary" onclick="viewLogs()">View Logs</button>
                    </div>
                    <div class="setting-item">
                        <button class="btn-success" onclick="exportLogs('csv')">Export Logs as CSV</button>
                        <button class="btn-success" onclick="exportLogs('pdf')">Export Logs as PDF</button>
                    </div>
                    <div class="setting-item">
                        <button class="btn-primary" onclick="confirmClearLogs()">Clear Log History</button>
                    </div>
                </div>
            </div>


            <script>
                const darkModeToggle = document.getElementById("darkModeToggle");
                darkModeToggle.addEventListener("change", () => {
                    document.body.classList.toggle("dark-mode", darkModeToggle.checked);
                    localStorage.setItem("darkMode", darkModeToggle.checked);
                });

                window.addEventListener("DOMContentLoaded", () => {
                    if (localStorage.getItem("darkMode") === "true") {
                        document.body.classList.add("dark-mode");
                        darkModeToggle.checked = true;
                    }
                });

                function forcePasswordReset() {
                    alert("All users will be prompted to reset passwords.");
                }

                function downloadBackup() {
                    alert("Backup is being prepared for download.");
                }

                function exportLogs(type) {
                    alert(`Exporting logs as ${type.toUpperCase()}`);
                }

                function confirmClearLogs() {
                    if (confirm("Clear all log history?")) {
                        alert("Logs have been cleared.");
                    }
                }

                function viewLogs() {
                    const date = document.getElementById("logDateFilter").value;
                    const type = document.getElementById("logTypeFilter").value;
                    alert(`Logs filtered by ${type} on ${date}`);
                }

                function previewLogo(event) {
                    const container = document.getElementById("logoPreviewContainer");
                    container.innerHTML = "";
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            const img = document.createElement("img");
                            img.src = e.target.result;
                            img.style.maxWidth = "150px";
                            img.style.marginTop = "10px";
                            container.appendChild(img);
                        };
                        reader.readAsDataURL(file);
                    }
                }
            </script>
            <script>
                document.addEventListener("DOMContentLoaded", () => {
                    // Hamburger menu
                    const menuToggle = document.getElementById("menuToggle");
                    const sidebar = document.getElementById("sidebar");
                    if (menuToggle && sidebar) {
                        menuToggle.addEventListener("click", () => {
                            sidebar.classList.toggle("collapsed");
                            document.querySelector(".content-area").classList.toggle("expanded");
                        });
                    }


                });
            </script>

            <script>
                document.addEventListener("DOMContentLoaded", () => {
                    // Toggle dropdown visibility
                    function toggleDropdown(wrapperId) {
                        document.querySelectorAll(".dropdown").forEach(d => {
                            if (d.id === wrapperId) {
                                d.classList.toggle("show");
                            } else {
                                d.classList.remove("show");
                            }
                        });
                    }

                    // Close all dropdowns when clicking outside
                    document.addEventListener("click", () => {
                        document.querySelectorAll(".dropdown").forEach(d => d.classList.remove("show"));
                    });

                    // Prevent close on button click
                    document.getElementById("languageButton").addEventListener("click", e => {
                        e.stopPropagation();
                        toggleDropdown("languageDropdownWrapper");
                    });

                    document.getElementById("statusButton").addEventListener("click", e => {
                        e.stopPropagation();
                        toggleDropdown("statusDropdownWrapper");
                    });




                    // Handle status selection
                    document.querySelectorAll("#statusDropdown .dropdown-item").forEach(item => {
                        item.addEventListener("click", e => {
                            e.stopPropagation();
                            const status = item.dataset.status;
                            const label = item.textContent.trim();
                            const dot = document.getElementById("statusDot");

                            document.getElementById("statusLabel").textContent = label;

                            dot.className = `dot ${status === "active" ? "green" : status === "busy" ? "red" : "gray"}`;
                            document.getElementById("statusDropdownWrapper").classList.remove("show");
                        });
                    });
                });
            </script>

            <script>
                document.addEventListener("DOMContentLoaded", () => {
                    const flagMap = {
                        en: "https://flagcdn.com/w20/gb.png",
                        es: "https://flagcdn.com/w20/es.png",
                        fr: "https://flagcdn.com/w20/fr.png",
                        de: "https://flagcdn.com/w20/de.png"
                    };

                    const dropdownWrapper = document.getElementById("languageDropdownWrapper");
                    const dropdownContent = document.getElementById("languageDropdown");
                    const languageButton = document.getElementById("languageButton");
                    const flagImg = document.getElementById("languageFlag");
                    const labelSpan = document.getElementById("languageLabel");

                    // Toggle dropdown on button click
                    languageButton.addEventListener("click", (e) => {
                        e.stopPropagation();
                        dropdownContent.style.display = dropdownContent.style.display === "block" ? "none" : "block";
                    });

                    // Handle dropdown item clicks
                    document.querySelectorAll("#languageDropdown .dropdown-item").forEach(item => {
                        item.addEventListener("click", (e) => {
                            e.stopPropagation();
                            const lang = item.dataset.lang;
                            flagImg.src = flagMap[lang];
                            labelSpan.textContent = lang.toUpperCase();
                            dropdownContent.style.display = "none";
                        });
                    });

                    // Close dropdown when clicking outside
                    document.addEventListener("click", () => {
                        dropdownContent.style.display = "none";
                    });
                });
            </script>



            <script>
                // Feedback Complaints Section - Full Working JS with Initial Data

                let feedbackComplaintsData = JSON.parse(localStorage.getItem('feedbackComplaintsData')) || [];
                let feedbackComplaintsEditingIndex = null;
                let feedbackComplaintsChartObj = null;

                // ✅ Load Initial Sample Data Only If LocalStorage is Empty
                if (feedbackComplaintsData.length === 0) {
                    feedbackComplaintsData = [
                        {
                            customer: 'John Doe',
                            date: '2025-06-20',
                            type: 'Feedback',
                            details: 'Milk quality was excellent!',
                            status: 'Resolved'
                        },
                        {
                            customer: 'Anita Sharma',
                            date: '2025-06-21',
                            type: 'Complaint',
                            details: 'Late delivery issue.',
                            status: 'Pending'
                        },
                        {
                            customer: 'Rajesh Kumar',
                            date: '2025-06-22',
                            type: 'Feedback',
                            details: 'Customer support was very helpful.',
                            status: 'Closed'
                        }
                    ];
                    localStorage.setItem('feedbackComplaintsData', JSON.stringify(feedbackComplaintsData));
                }

                // Render Table
                function feedbackComplaintsRenderTable() {
                    const tbody = document.getElementById('feedbackComplaintsTableBody');
                    tbody.innerHTML = '';
                    const search = document.getElementById('feedbackComplaintsSearchInput').value.toLowerCase();

                    feedbackComplaintsData.forEach((item, index) => {
                        if (
                            item.customer.toLowerCase().includes(search) ||
                            item.status.toLowerCase().includes(search)
                        ) {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                <td>${index + 1}</td>
                <td>${item.customer}</td>
                <td>${item.date}</td>
                <td>${item.type}</td>
                <td>${item.status}</td>
                <td>
                    <button class="btn-primary" onclick="feedbackComplaintsEdit(${index})">Edit</button>
                    <button class="delete-btn" onclick="feedbackComplaintsDelete(${index})">Delete</button>
                </td>
            `;
                            tbody.appendChild(row);
                        }
                    });

                    feedbackComplaintsUpdateChart();
                }

                // Open Modal
                function feedbackComplaintsOpenModal(isEdit = false) {
                    document.getElementById('feedbackComplaintsModal').style.display = 'flex';
                    document.getElementById('feedbackComplaintsModalTitle').innerText = isEdit ? 'Edit Feedback/Complaint' : 'Add Feedback/Complaint';
                }

                // Close Modal
                function feedbackComplaintsCloseModal() {
                    document.getElementById('feedbackComplaintsModal').style.display = 'none';
                    document.getElementById('feedbackComplaintsCustomer').value = '';
                    document.getElementById('feedbackComplaintsDate').value = '';
                    document.getElementById('feedbackComplaintsType').value = 'Feedback';
                    document.getElementById('feedbackComplaintsDetails').value = '';
                    document.getElementById('feedbackComplaintsStatus').value = 'Pending';
                    feedbackComplaintsEditingIndex = null;
                }

                // Save Add/Edit
                function feedbackComplaintsSave() {
                    const customer = document.getElementById('feedbackComplaintsCustomer').value.trim();
                    const date = document.getElementById('feedbackComplaintsDate').value;
                    const type = document.getElementById('feedbackComplaintsType').value;
                    const details = document.getElementById('feedbackComplaintsDetails').value.trim();
                    const status = document.getElementById('feedbackComplaintsStatus').value;

                    if (!customer || !date || !type || !details || !status) {
                        alert('Please fill all fields');
                        return;
                    }

                    const data = { customer, date, type, details, status };

                    if (feedbackComplaintsEditingIndex !== null) {
                        feedbackComplaintsData[feedbackComplaintsEditingIndex] = data;
                    } else {
                        feedbackComplaintsData.push(data);
                    }

                    localStorage.setItem('feedbackComplaintsData', JSON.stringify(feedbackComplaintsData));
                    feedbackComplaintsCloseModal();
                    feedbackComplaintsRenderTable();
                }

                // Edit Record
                function feedbackComplaintsEdit(index) {
                    const item = feedbackComplaintsData[index];
                    document.getElementById('feedbackComplaintsCustomer').value = item.customer;
                    document.getElementById('feedbackComplaintsDate').value = item.date;
                    document.getElementById('feedbackComplaintsType').value = item.type;
                    document.getElementById('feedbackComplaintsDetails').value = item.details;
                    document.getElementById('feedbackComplaintsStatus').value = item.status;
                    feedbackComplaintsEditingIndex = index;
                    feedbackComplaintsOpenModal(true);
                }

                // Delete Record
                function feedbackComplaintsDelete(index) {
                    if (confirm('Are you sure you want to delete this record?')) {
                        feedbackComplaintsData.splice(index, 1);
                        localStorage.setItem('feedbackComplaintsData', JSON.stringify(feedbackComplaintsData));
                        feedbackComplaintsRenderTable();
                    }
                }

                // Export to PDF
                function feedbackComplaintsExportPDF() {
                    html2canvas(document.getElementById('feedbackComplaintsTable')).then(canvas => {
                        const imgData = canvas.toDataURL('image/png');
                        const pdf = new jspdf.jsPDF();
                        pdf.addImage(imgData, 'PNG', 10, 10, 180, 0);
                        pdf.save('FeedbackComplaints.pdf');
                    });
                }

                // Export to Excel (CSV)
                function feedbackComplaintsExportExcel() {
                    let csv = 'ID,Customer,Date,Type,Status\n';
                    feedbackComplaintsData.forEach((item, index) => {
                        csv += `${index + 1},${item.customer},${item.date},${item.type},${item.status}\n`;
                    });

                    const blob = new Blob([csv], { type: 'text/csv' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'FeedbackComplaints.csv';
                    a.click();
                    URL.revokeObjectURL(url);
                }

                function feedbackComplaintsUpdateChart() {
                    const ctx = document.getElementById('feedbackComplaintsChart').getContext('2d');

                    // ✅ Always load FULL data from localStorage
                    const storedData = JSON.parse(localStorage.getItem('feedbackComplaintsData')) || [];

                    const statusCounts = { Pending: 0, Resolved: 0, Closed: 0 };

                    storedData.forEach(item => {
                        statusCounts[item.status] = (statusCounts[item.status] || 0) + 1;
                    });

                    if (feedbackComplaintsChartObj) {
                        feedbackComplaintsChartObj.destroy();
                    }

                    feedbackComplaintsChartObj = new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: ['Pending', 'Resolved', 'Closed'],
                            datasets: [{
                                data: [statusCounts.Pending, statusCounts.Resolved, statusCounts.Closed],
                                backgroundColor: ['#f39c12', '#27ae60', '#c0392b']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top'
                                }
                            }
                        }
                    });
                }


                document.addEventListener('DOMContentLoaded', function () {
                    feedbackComplaintsData = JSON.parse(localStorage.getItem('feedbackComplaintsData')) || [];
                    feedbackComplaintsRenderTable();
                    feedbackComplaintsUpdateChart();
                });

            </script>



            <script>
                document.addEventListener("DOMContentLoaded", () => {
                    let fleetData = JSON.parse(localStorage.getItem("fleetData") || "[]");
                    let fleetChart1, fleetChart2;

                    function $(id) { return document.getElementById(id); }

                    function renderFleetTable() {
                        $("fleetTableBody").innerHTML = "";
                        fleetData.forEach((v, i) => {
                            $("fleetTableBody").innerHTML += `
        <tr>
          <td>${v.id}</td><td>${v.type}</td><td>${v.driver}</td>
          <td><span class="status ${v.status.toLowerCase().replace(' ', '-')}">${v.status}</span></td>
          <td>${v.capacity}</td><td>${v.lastMaint}</td>
          <td>
            <button class="edit-btn" onclick="editFleet(${i})">Edit</button>
            <button class="btn-primary" onclick="deleteFleet(${i})">Delete</button>
          </td>
        </tr>
      `;
                        });
                        updateFleetStats();
                        updateFleetCharts();
                    }

                    function updateFleetStats() {
                        $("fleet-total").innerText = fleetData.length;
                        $("fleet-drivers").innerText = fleetData.filter(f => f.driver).length;
                        $("fleet-deliveries").innerText = fleetData.length * 2;
                        $("fleet-breakdowns").innerText = fleetData.filter(f => f.status === "Under Maintenance").length;
                    }

                    function updateFleetCharts() {
                        const statusCount = { Active: 0, "Under Maintenance": 0, Retired: 0 };
                        fleetData.forEach(v => statusCount[v.status] = (statusCount[v.status] || 0) + 1);

                        if (fleetChart1) fleetChart1.destroy();
                        if (fleetChart2) fleetChart2.destroy();

                        fleetChart1 = new Chart($("fleetUtilChart"), {
                            type: "doughnut",
                            data: {
                                labels: Object.keys(statusCount),
                                datasets: [{
                                    data: Object.values(statusCount),
                                    backgroundColor: ["#2a9d8f", "#e76f51", "#6c757d"]
                                }]
                            }
                        });

                        fleetChart2 = new Chart($("fleetBreakChart"), {
                            type: "bar",
                            data: {
                                labels: fleetData.map(v => v.id),
                                datasets: [{
                                    label: "Days since last maintenance",
                                    data: fleetData.map(v => {
                                        const days = Math.floor((Date.now() - new Date(v.lastMaint)) / (1000 * 60 * 60 * 24));
                                        return days;
                                    }),
                                    backgroundColor: "#00b4d8"
                                }]
                            }
                        });
                    }

                    window.showFleetModal = function () {
                        $("fleetModal").style.display = "block";
                        $("fleetModalTitle").innerText = "Add Vehicle";
                        $("fleetModal").querySelector("form").reset();
                        $("fleetIndex").value = "";
                    }

                    window.hideFleetModal = function () {
                        $("fleetModal").style.display = "none";
                    }

                    window.saveFleetVehicle = function (e) {
                        e.preventDefault();
                        const v = {
                            id: $("fleetId").value,
                            type: $("fleetType").value,
                            driver: $("fleetDriver").value,
                            status: $("fleetStatus").value,
                            capacity: $("fleetCapacity").value,
                            lastMaint: $("fleetLastMaint").value
                        };
                        const index = $("fleetIndex").value;
                        if (index) fleetData[index] = v;
                        else fleetData.push(v);
                        localStorage.setItem("fleetData", JSON.stringify(fleetData));
                        hideFleetModal();
                        renderFleetTable();
                    }

                    window.editFleet = function (index) {
                        const v = fleetData[index];
                        $("fleetModalTitle").innerText = "Edit Vehicle";
                        $("fleetModal").style.display = "block";
                        $("fleetIndex").value = index;
                        $("fleetId").value = v.id;
                        $("fleetType").value = v.type;
                        $("fleetDriver").value = v.driver;
                        $("fleetStatus").value = v.status;
                        $("fleetCapacity").value = v.capacity;
                        $("fleetLastMaint").value = v.lastMaint;
                    }

                    window.deleteFleet = function (index) {
                        if (confirm("Delete this vehicle?")) {
                            fleetData.splice(index, 1);
                            localStorage.setItem("fleetData", JSON.stringify(fleetData));
                            renderFleetTable();
                        }
                    }

                    window.exportFleetToCSV = function () {
                        let csv = "ID,Type,Driver,Status,Capacity,Last Maint.\n";
                        fleetData.forEach(v => {
                            csv += `${v.id},${v.type},${v.driver},${v.status},${v.capacity},${v.lastMaint}\n`;
                        });
                        const blob = new Blob([csv], { type: 'text/csv' });
                        const a = document.createElement("a");
                        a.href = URL.createObjectURL(blob);
                        a.download = "Fleet_Report.csv";
                        a.click();
                    }

                    renderFleetTable();
                });
            </script>

            <script>
                let distributionData = JSON.parse(localStorage.getItem('distributionRecords') || '[]');
                let distributionEditId = null;
                let distributionStatusChart, distributionProductChart;

                if (distributionData.length === 0) {
                    distributionData = [
                        { id: 1, date: '2025-06-20', product: 'Milk', quantity: 50, destination: 'Hyderabad', driver: 'Ravi', vehicle: 'AP01AB1234', status: 'Pending' },
                        { id: 2, date: '2025-06-21', product: 'Butter', quantity: 20, destination: 'Secunderabad', driver: 'Anil', vehicle: 'AP01AC5678', status: 'Dispatched' },
                        { id: 3, date: '2025-06-22', product: 'Curd', quantity: 30, destination: 'Guntur', driver: 'Suresh', vehicle: 'TS09DE4321', status: 'Delivered' },
                        { id: 4, date: '2025-06-23', product: 'Milk', quantity: 40, destination: 'Vijayawada', driver: 'Kiran', vehicle: 'AP16BC9087', status: 'Pending' },
                        { id: 5, date: '2025-06-24', product: 'Cheese', quantity: 15, destination: 'Warangal', driver: 'Praveen', vehicle: 'AP28GH6543', status: 'Delivered' },
                        { id: 6, date: '2025-06-25', product: 'Milk', quantity: 60, destination: 'Nellore', driver: 'Venkat', vehicle: 'TS08JK3210', status: 'Dispatched' }
                    ];
                    localStorage.setItem('distributionRecords', JSON.stringify(distributionData));
                }

                function distributionRenderTable() {
                    const tbody = document.getElementById('distribution-tbody');
                    tbody.innerHTML = '';
                    const search = document.getElementById('distribution-search').value.toLowerCase();
                    const statusFilter = document.getElementById('distribution-status-filter').value;

                    let totalQty = 0, totalCount = 0, pending = 0, completed = 0;
                    distributionData.forEach(rec => {
                        if ((search && !(`${rec.product} ${rec.destination}`.toLowerCase().includes(search))) || (statusFilter && rec.status !== statusFilter)) return;
                        totalQty += rec.quantity;
                        totalCount++;
                        if (rec.status === 'Pending') pending++;
                        if (rec.status === 'Delivered') completed++;

                        const tr = document.createElement('tr');
                        tr.innerHTML = `
            <td>${rec.date}</td>
            <td>${rec.product}</td>
            <td>${rec.quantity}</td>
            <td>${rec.destination}</td>
            <td>${rec.driver}</td>
            <td>${rec.vehicle}</td>
            <td>${rec.status}</td>
            <td style="text-align:center;">
                <button class="btn-success" onclick="distributionEdit(${rec.id})"><i class="fa fa-edit"></i></button>
                <button class="edit-btn" onclick="distributionDelete(${rec.id})"><i class="fa fa-trash"></i></button>
            </td>`;
                        tbody.appendChild(tr);
                    });

                    document.getElementById('distribution-total').innerText = totalCount;
                    document.getElementById('distribution-quantity').innerText = totalQty;
                    document.getElementById('distribution-pending').innerText = pending;
                    document.getElementById('distribution-completed').innerText = completed;

                    distributionUpdateCharts();
                }

                function distributionShowForm(editId = null) {
                    distributionEditId = editId;
                    document.getElementById('distribution-form').reset();
                    if (editId) {
                        document.getElementById('distribution-form-title').innerText = 'Edit Distribution';
                        const rec = distributionData.find(r => r.id === editId);
                        if (rec) {
                            document.getElementById('distribution-id').value = rec.id;
                            document.getElementById('distribution-date').value = rec.date;
                            document.getElementById('distribution-product').value = rec.product;
                            document.getElementById('distribution-quantity-input').value = rec.quantity;
                            document.getElementById('distribution-destination').value = rec.destination;
                            document.getElementById('distribution-driver').value = rec.driver;
                            document.getElementById('distribution-vehicle').value = rec.vehicle;
                            document.getElementById('distribution-status').value = rec.status;
                        }
                    } else {
                        document.getElementById('distribution-form-title').innerText = 'Add Distribution';
                    }
                    document.getElementById('distribution-form-modal').style.display = 'flex';
                }

                function distributionCloseForm() {
                    document.getElementById('distribution-form-modal').style.display = 'none';
                }

                function distributionSave(e) {
                    e.preventDefault();
                    const id = distributionEditId || (distributionData.length ? Math.max(...distributionData.map(r => r.id)) + 1 : 1);
                    const rec = {
                        id,
                        date: document.getElementById('distribution-date').value,
                        product: document.getElementById('distribution-product').value.trim(),
                        quantity: Number(document.getElementById('distribution-quantity-input').value),
                        destination: document.getElementById('distribution-destination').value.trim(),
                        driver: document.getElementById('distribution-driver').value.trim(),
                        vehicle: document.getElementById('distribution-vehicle').value.trim(),
                        status: document.getElementById('distribution-status').value
                    };
                    if (distributionEditId) {
                        const idx = distributionData.findIndex(r => r.id == distributionEditId);
                        if (idx > -1) distributionData[idx] = rec;
                    } else {
                        distributionData.push(rec);
                    }
                    localStorage.setItem('distributionRecords', JSON.stringify(distributionData));
                    distributionCloseForm();
                    distributionRenderTable();
                }

                function distributionEdit(id) {
                    distributionShowForm(id);
                }

                function distributionDelete(id) {
                    if (confirm('Are you sure you want to delete this record?')) {
                        distributionData = distributionData.filter(r => r.id !== id);
                        localStorage.setItem('distributionRecords', JSON.stringify(distributionData));
                        distributionRenderTable();
                    }
                }

                function distributionExportCSV() {
                    let csv = 'Date,Product,Quantity,Destination,Driver,Vehicle,Status\n';
                    distributionData.forEach(r => {
                        csv += `${r.date},${r.product},${r.quantity},${r.destination},${r.driver},${r.vehicle},${r.status}\n`;
                    });
                    const blob = new Blob([csv], { type: 'text/csv' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = 'distribution_data.csv';
                    link.click();
                }

                function distributionExportPDF() {
                    html2canvas(document.querySelector("#distribution-section")).then(canvas => {
                        const pdf = new jspdf.jsPDF();
                        pdf.addImage(canvas.toDataURL("image/png"), "PNG", 10, 10, 190, 0);
                        pdf.save("distribution_data.pdf");
                    });
                }

                function distributionUpdateCharts() {
                    const statusCount = {};
                    const productQty = {};

                    distributionData.forEach(r => {
                        statusCount[r.status] = (statusCount[r.status] || 0) + 1;
                        productQty[r.product] = (productQty[r.product] || 0) + r.quantity;
                    });

                    if (distributionStatusChart) distributionStatusChart.destroy();
                    distributionStatusChart = new Chart(document.getElementById('distributionStatusChart').getContext('2d'), {
                        type: 'pie',
                        data: {
                            labels: Object.keys(statusCount),
                            datasets: [{
                                data: Object.values(statusCount),
                                backgroundColor: ['#e76f51', '#e9c46a', '#2a9d8f']
                            }]
                        },
                        options: { responsive: true }
                    });

                    if (distributionProductChart) distributionProductChart.destroy();
                    distributionProductChart = new Chart(document.getElementById('distributionProductChart').getContext('2d'), {
                        type: 'bar',
                        data: {
                            labels: Object.keys(productQty),
                            datasets: [{
                                label: 'Quantity',
                                data: Object.values(productQty),
                                backgroundColor: '#00b4d8'
                            }]
                        },
                        options: { responsive: true, scales: { y: { beginAtZero: true } } }
                    });
                }

                document.addEventListener('DOMContentLoaded', distributionRenderTable);
            </script>




            <script>
                // Quality Control Section JavaScript
                document.addEventListener('DOMContentLoaded', function () {
                    // Initialize quality control section if it exists
                    if (document.getElementById('quality-control-section')) {
                        initializeQualityControl();
                    }
                });

                function initializeQualityControl() {
                    // Load initial data
                    loadQualityTests();
                    loadQualityStandards();

                    // Set up event listeners
                    document.getElementById('addQualityTestBtn').addEventListener('click', showAddTestForm);
                    document.getElementById('closeTestForm').addEventListener('click', hideAddTestForm);
                    document.getElementById('cancelTestForm').addEventListener('click', hideAddTestForm);
                    document.getElementById('testForm').addEventListener('submit', saveQualityTest);

                    document.getElementById('editStandardsBtn').addEventListener('click', showEditStandardsForm);
                    document.getElementById('closeStandardsForm').addEventListener('click', hideEditStandardsForm);
                    document.getElementById('cancelStandardsForm').addEventListener('click', hideEditStandardsForm);
                    document.getElementById('standardsForm').addEventListener('submit', saveQualityStandards);

                    document.getElementById('qualitySearch').addEventListener('input', filterQualityTests);
                    document.getElementById('qualityFilter').addEventListener('change', filterQualityTests);
                    document.getElementById('qualityPrevPage').addEventListener('click', goToPrevPage);
                    document.getElementById('qualityNextPage').addEventListener('click', goToNextPage);

                    document.getElementById('qualityTimeRange').addEventListener('change', updateQualityTrends);

                    // Initialize charts
                    initializeQualityCharts();
                }

                // Quality Test Data Management
                function loadQualityTests() {
                    let tests = JSON.parse(localStorage.getItem('qualityTests')) || [];

                    // If no tests exist, create some sample data
                    if (tests.length === 0) {
                        tests = [
                            {
                                id: 'QT-1001',
                                batchNo: 'B-230615',
                                product: 'standard_milk',
                                testType: 'routine',
                                fatContent: 4.2,
                                snfContent: 8.5,
                                bacteriaCount: 50000,
                                temperature: 4.1,
                                status: 'passed',
                                notes: 'Within all standard limits',
                                date: '2023-06-15T10:30:00'
                            },
                            {
                                id: 'QT-1002',
                                batchNo: 'B-230614',
                                product: 'toned_milk',
                                testType: 'routine',
                                fatContent: 3.8,
                                snfContent: 8.3,
                                bacteriaCount: 75000,
                                temperature: 4.3,
                                status: 'passed',
                                notes: 'Slightly high bacteria count but within limit',
                                date: '2023-06-14T09:15:00'
                            },
                            {
                                id: 'QT-1003',
                                batchNo: 'B-230613',
                                product: 'flavored_milk',
                                testType: 'random',
                                fatContent: 2.5,
                                snfContent: 7.8,
                                bacteriaCount: 120000,
                                temperature: 5.2,
                                status: 'failed',
                                notes: 'High temperature and bacteria count',
                                date: '2023-06-13T14:20:00'
                            },
                            {
                                id: 'QT-1004',
                                batchNo: 'B-230612',
                                product: 'yogurt',
                                testType: 'batch',
                                fatContent: 3.5,
                                snfContent: 8.2,
                                bacteriaCount: 100000,
                                temperature: 4.0,
                                status: 'passed',
                                notes: 'Good quality batch',
                                date: '2023-06-12T11:45:00'
                            },
                            {
                                id: 'QT-1005',
                                batchNo: 'B-230611',
                                product: 'paneer',
                                testType: 'complaint',
                                fatContent: 22.5,
                                snfContent: 8.8,
                                bacteriaCount: 150000,
                                temperature: 6.1,
                                status: 'failed',
                                notes: 'Customer complaint verified - high bacteria count',
                                date: '2023-06-11T16:30:00'
                            }
                        ];
                        localStorage.setItem('qualityTests', JSON.stringify(tests));
                    }

                    // Sort by date (newest first)
                    tests.sort((a, b) => new Date(b.date) - new Date(a.date));

                    // Store in memory for filtering/pagination
                    window.currentQualityTests = tests;
                    window.filteredQualityTests = [...tests];
                    window.currentQualityPage = 1;
                    window.qualityTestsPerPage = 5;

                    renderQualityTests();
                    updateQualityPagination();
                }

                function renderQualityTests() {
                    const tableBody = document.getElementById('qualityTestsTableBody');
                    tableBody.innerHTML = '';

                    const startIndex = (window.currentQualityPage - 1) * window.qualityTestsPerPage;
                    const endIndex = Math.min(startIndex + window.qualityTestsPerPage, window.filteredQualityTests.length);

                    const productNames = {
                        'standard_milk': 'Standard Milk',
                        'toned_milk': 'Toned Milk',
                        'flavored_milk': 'Flavored Milk',
                        'yogurt': 'Yogurt',
                        'paneer': 'Paneer',
                        'ghee': 'Ghee'
                    };

                    const testTypes = {
                        'routine': 'Routine',
                        'random': 'Random',
                        'complaint': 'Complaint',
                        'batch': 'Batch'
                    };

                    for (let i = startIndex; i < endIndex; i++) {
                        const test = window.filteredQualityTests[i];
                        const row = document.createElement('tr');

                        const testDate = new Date(test.date);
                        const formattedDate = testDate.toLocaleDateString() + ' ' + testDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                        row.innerHTML = `
            <td>${test.id}</td>
            <td>${test.batchNo}</td>
            <td>${productNames[test.product] || test.product}</td>
            <td>${testTypes[test.testType] || test.testType}</td>
            <td>${test.fatContent}%</td>
            <td>${test.snfContent}%</td>
            <td>${formattedDate}</td>
            <td><span class="status ${test.status === 'passed' ? 'completed' : test.status === 'failed' ? 'pending' : 'scheduled'}">
                ${test.status.charAt(0).toUpperCase() + test.status.slice(1)}
            </span></td>
            <td>
                <button class="btn-primary" onclick="viewQualityTest('${test.id}')"><i class="fas fa-eye"></i></button>
                <button class="btn-success" onclick="editQualityTest('${test.id}')"><i class="fas fa-edit"></i></button>
                <button class="btn-danger" onclick="deleteQualityTest('${test.id}')"><i class="fas fa-trash"></i></button>
            </td>
        `;

                        tableBody.appendChild(row);
                    }
                }

                function viewQualityTest(testId) {
                    const test = window.currentQualityTests.find(t => t.id === testId);
                    if (!test) return;

                    const productNames = {
                        'standard_milk': 'Standard Milk',
                        'toned_milk': 'Toned Milk',
                        'flavored_milk': 'Flavored Milk',
                        'yogurt': 'Yogurt',
                        'paneer': 'Paneer',
                        'ghee': 'Ghee'
                    };

                    const testTypes = {
                        'routine': 'Routine',
                        'random': 'Random',
                        'complaint': 'Complaint Investigation',
                        'batch': 'Batch Release'
                    };

                    const testDate = new Date(test.date);
                    const formattedDate = testDate.toLocaleDateString() + ' ' + testDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                    // Create a modal or use a notification to display the details
                    alert(`
        Quality Test Details\n
        ID: ${test.id}\n
        Batch: ${test.batchNo}\n
        Product: ${productNames[test.product] || test.product}\n
        Test Type: ${testTypes[test.testType] || test.testType}\n
        Fat Content: ${test.fatContent}%\n
        SNF Content: ${test.snfContent}%\n
        Bacteria Count: ${test.bacteriaCount} CFU/ml\n
        Temperature: ${test.temperature}°C\n
        Status: ${test.status.charAt(0).toUpperCase() + test.status.slice(1)}\n
        Date: ${formattedDate}\n
        Notes: ${test.notes}
    `);
                }

                function editQualityTest(testId) {
                    const test = window.currentQualityTests.find(t => t.id === testId);
                    if (!test) return;

                    document.getElementById('testBatchNo').value = test.batchNo;
                    document.getElementById('testProduct').value = test.product;
                    document.getElementById('testType').value = test.testType;
                    document.getElementById('testFat').value = test.fatContent;
                    document.getElementById('testSnf').value = test.snfContent;
                    document.getElementById('testBacteria').value = test.bacteriaCount;
                    document.getElementById('testTemp').value = test.temperature;
                    document.getElementById('testStatus').value = test.status;
                    document.getElementById('testNotes').value = test.notes;

                    // Store the test ID for updating
                    document.getElementById('testForm').dataset.editingId = testId;

                    showAddTestForm();
                }

                function deleteQualityTest(testId) {
                    if (confirm('Are you sure you want to delete this quality test?')) {
                        const tests = JSON.parse(localStorage.getItem('qualityTests')) || [];
                        const updatedTests = tests.filter(test => test.id !== testId);

                        localStorage.setItem('qualityTests', JSON.stringify(updatedTests));
                        loadQualityTests(); // Refresh the table
                    }
                }

                function showAddTestForm() {
                    document.getElementById('addTestForm').style.display = 'block';
                    window.scrollTo(0, document.getElementById('addTestForm').offsetTop);
                }

                function hideAddTestForm() {
                    document.getElementById('addTestForm').style.display = 'none';
                    document.getElementById('testForm').reset();
                    delete document.getElementById('testForm').dataset.editingId;
                }

                function saveQualityTest(e) {
                    e.preventDefault();

                    const testId = document.getElementById('testForm').dataset.editingId || 'QT-' + Date.now().toString().slice(-4);
                    const isEditing = !!document.getElementById('testForm').dataset.editingId;

                    const test = {
                        id: testId,
                        batchNo: document.getElementById('testBatchNo').value,
                        product: document.getElementById('testProduct').value,
                        testType: document.getElementById('testType').value,
                        fatContent: parseFloat(document.getElementById('testFat').value),
                        snfContent: parseFloat(document.getElementById('testSnf').value),
                        bacteriaCount: parseInt(document.getElementById('testBacteria').value),
                        temperature: parseFloat(document.getElementById('testTemp').value),
                        status: document.getElementById('testStatus').value,
                        notes: document.getElementById('testNotes').value,
                        date: new Date().toISOString()
                    };

                    let tests = JSON.parse(localStorage.getItem('qualityTests')) || [];

                    if (isEditing) {
                        // Update existing test
                        tests = tests.map(t => t.id === testId ? test : t);
                    } else {
                        // Add new test
                        tests.unshift(test);
                    }

                    localStorage.setItem('qualityTests', JSON.stringify(tests));
                    loadQualityTests(); // Refresh the table
                    hideAddTestForm();
                    updateQualityCharts();
                }

                function filterQualityTests() {
                    const searchTerm = document.getElementById('qualitySearch').value.toLowerCase();
                    const filterValue = document.getElementById('qualityFilter').value;

                    window.filteredQualityTests = window.currentQualityTests.filter(test => {
                        const matchesSearch =
                            test.id.toLowerCase().includes(searchTerm) ||
                            test.batchNo.toLowerCase().includes(searchTerm) ||
                            test.product.toLowerCase().includes(searchTerm);

                        const matchesFilter =
                            filterValue === 'all' ||
                            (filterValue === 'passed' && test.status === 'passed') ||
                            (filterValue === 'failed' && test.status === 'failed') ||
                            (filterValue === 'pending' && test.status === 'pending');

                        return matchesSearch && matchesFilter;
                    });

                    window.currentQualityPage = 1;
                    renderQualityTests();
                    updateQualityPagination();
                }

                function updateQualityPagination() {
                    const totalTests = window.filteredQualityTests.length;
                    const totalPages = Math.ceil(totalTests / window.qualityTestsPerPage);

                    const startIndex = (window.currentQualityPage - 1) * window.qualityTestsPerPage + 1;
                    const endIndex = Math.min(startIndex + window.qualityTestsPerPage - 1, totalTests);

                    document.getElementById('qualityShowingFrom').textContent = startIndex;
                    document.getElementById('qualityShowingTo').textContent = endIndex;
                    document.getElementById('qualityTotalTests').textContent = totalTests;

                    document.getElementById('qualityPrevPage').disabled = window.currentQualityPage <= 1;
                    document.getElementById('qualityNextPage').disabled = window.currentQualityPage >= totalPages;
                }

                function goToPrevPage() {
                    if (window.currentQualityPage > 1) {
                        window.currentQualityPage--;
                        renderQualityTests();
                        updateQualityPagination();
                    }
                }

                function goToNextPage() {
                    const totalPages = Math.ceil(window.filteredQualityTests.length / window.qualityTestsPerPage);
                    if (window.currentQualityPage < totalPages) {
                        window.currentQualityPage++;
                        renderQualityTests();
                        updateQualityPagination();
                    }
                }


                // Toggle sidebar on mobile
                document.getElementById('menuToggle').addEventListener('click', function () {
                    document.getElementById('sidebar').classList.toggle('show');
                });

                // Toggle status dropdown
                document.getElementById('userProfile').addEventListener('click', function (e) {
                    e.stopPropagation();
                    document.getElementById('statusDropdown').classList.toggle('show');
                });

                // Toggle language dropdown
                document.getElementById('languageButton').addEventListener('click', function (e) {
                    e.stopPropagation();
                    document.getElementById('languageDropdown').classList.toggle('show');
                });

                // Close dropdowns when clicking outside
                document.addEventListener('click', function () {
                    document.getElementById('statusDropdown').classList.remove('show');
                    document.getElementById('languageDropdown').classList.remove('show');
                });

                // Status selection
                document.querySelectorAll('.status-option').forEach(option => {
                    option.addEventListener('click', function () {
                        const status = this.getAttribute('data-status');
                        const indicator = document.querySelector('.user-profile .status-indicator');

                        // Remove all status classes
                        indicator.classList.remove('status-active', 'status-away', 'status-busy', 'status-offline');

                        // Add selected status class
                        indicator.classList.add(`status-${status}`);
                    });
                });

                // Language selection
                document.querySelectorAll('.language-option').forEach(option => {
                    option.addEventListener('click', function () {
                        const lang = this.getAttribute('data-lang');
                        const flag = this.querySelector('img').src;
                        const text = this.querySelector('span').textContent;

                        // Update language button
                        const button = document.getElementById('languageButton');
                        button.querySelector('img').src = flag;
                        button.querySelector('span').textContent = lang.toUpperCase();

                        // Close dropdown
                        document.getElementById('languageDropdown').classList.remove('show');

                        // Here you would typically reload content in the selected language
                        console.log(`Language changed to ${text}`);
                    });
                });

                // Submenu toggle functionality
                document.querySelectorAll('.has-submenu > a').forEach(link => {
                    link.addEventListener('click', function (e) {
                        if (window.innerWidth > 768) {
                            e.preventDefault();
                            const submenu = this.nextElementSibling;
                            this.classList.toggle('expanded');
                            submenu.classList.toggle('show');
                        }
                    });
                });

                // Function to show specific sections
                function showSection(sectionId) {
                    // Hide all child sections
                    document.querySelectorAll('.child-section').forEach(section => {
                        section.classList.remove('active');
                    });

                    // Show the requested section
                    document.getElementById(sectionId).classList.add('active');

                    // Update active state in sidebar
                    document.querySelectorAll('.sidebar-menu a').forEach(link => {
                        link.classList.remove('active');
                        if (link.getAttribute('data-section') === sectionId) {
                            link.classList.add('active');
                        }
                    });

                    // Close mobile sidebar if open
                    if (window.innerWidth <= 992) {
                        document.getElementById('sidebar').classList.remove('show');
                    }
                }

                // Set up click handlers for all sidebar links
                document.querySelectorAll('.sidebar-menu a').forEach(link => {
                    if (link.getAttribute('data-section')) {
                        link.addEventListener('click', function (e) {
                            e.preventDefault();
                            showSection(this.getAttribute('data-section'));
                        });
                    }
                });

                // Highlight current page in sidebar
                document.addEventListener('DOMContentLoaded', function () {
                    // Initialize charts
                    initializeCharts();

                    // Set dashboard as default active section
                    showSection('dashboard-section');
                });

                // Initialize dashboard charts




                // Profile Section JavaScript
                document.addEventListener('DOMContentLoaded', function () {
                    // Only initialize if profile section exists
                    if (document.getElementById('profile-section')) {
                        loadProfileData();

                        // Set up event listeners
                        document.getElementById('editProfileBtn').addEventListener('click', enableEditing);
                        document.getElementById('saveProfileBtn').addEventListener('click', saveProfile);
                        document.getElementById('cancelEditBtn').addEventListener('click', cancelEditing);
                        document.getElementById('changeAvatarBtn').addEventListener('click', function (e) {
                            e.preventDefault();
                            document.getElementById('avatarInput').click();
                        });
                        document.getElementById('avatarInput').addEventListener('change', handleAvatarUpload);
                    }
                });

                function loadProfileData() {
                    const profileData = JSON.parse(localStorage.getItem('userProfile')) || {};

                    if (profileData.fullName) {
                        document.getElementById('fullName').value = profileData.fullName;
                        document.getElementById('phone').value = profileData.phone;
                        document.getElementById('email').value = profileData.email;
                        document.getElementById('address').value = profileData.address;

                        // Update avatar initials
                        const names = profileData.fullName.split(' ');
                        const initials = names[0].charAt(0) + (names.length > 1 ? names[names.length - 1].charAt(0) : '');
                        document.getElementById('avatarDisplay').textContent = initials;

                        // Update avatar image if exists
                        if (profileData.avatar) {
                            document.getElementById('avatarDisplay').style.backgroundImage = `url(${profileData.avatar})`;
                            document.getElementById('avatarDisplay').style.backgroundSize = 'cover';
                            document.getElementById('avatarDisplay').textContent = '';
                        }
                    }
                }

                function enableEditing() {
                    const inputs = document.querySelectorAll('#profileForm input, #profileForm textarea');
                    inputs.forEach(input => {
                        input.readOnly = false;
                        input.style.backgroundColor = 'white';
                        input.style.border = '1px solid var(--primary)';
                    });

                    document.getElementById('formActions').style.display = 'block';
                    document.getElementById('editProfileBtn').style.display = 'none';
                }

                function cancelEditing() {
                    const inputs = document.querySelectorAll('#profileForm input, #profileForm textarea');
                    inputs.forEach(input => {
                        input.readOnly = true;
                        input.style.backgroundColor = '';
                        input.style.border = '1px solid var(--dark)';
                    });

                    document.getElementById('formActions').style.display = 'none';
                    document.getElementById('editProfileBtn').style.display = 'block';

                    // Reload original data
                    loadProfileData();
                }

                function saveProfile() {
                    const profileData = {
                        fullName: document.getElementById('fullName').value,
                        phone: document.getElementById('phone').value,
                        email: document.getElementById('email').value,
                        address: document.getElementById('address').value,
                        avatar: localStorage.getItem('userAvatar') || ''
                    };

                    localStorage.setItem('userProfile', JSON.stringify(profileData));

                    // Update avatar initials
                    const names = profileData.fullName.split(' ');
                    const initials = names[0].charAt(0) + (names.length > 1 ? names[names.length - 1].charAt(0) : '');
                    document.getElementById('avatarDisplay').textContent = initials;

                    // Disable editing
                    cancelEditing();

                    alert('Profile saved successfully!');
                }

                function handleAvatarUpload(event) {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            const avatarDisplay = document.getElementById('avatarDisplay');
                            avatarDisplay.style.backgroundImage = `url(${e.target.result})`;
                            avatarDisplay.style.backgroundSize = 'cover';
                            avatarDisplay.textContent = '';

                            // Save to localStorage
                            localStorage.setItem('userAvatar', e.target.result);

                            // Update profile data
                            const profileData = JSON.parse(localStorage.getItem('userProfile')) || {};
                            profileData.avatar = e.target.result;
                            localStorage.setItem('userProfile', JSON.stringify(profileData));
                        };
                        reader.readAsDataURL(file);
                    }
                }
                document.getElementById('editProfileBtn').addEventListener('click', function () {
                    const inputs = document.querySelectorAll('#profileForm input, #profileForm textarea');
                    inputs.forEach(input => input.removeAttribute('readonly'));

                    document.getElementById('formActions').style.display = 'flex';
                });

                document.getElementById('cancelEditBtn').addEventListener('click', function () {
                    const inputs = document.querySelectorAll('#profileForm input, #profileForm textarea');
                    inputs.forEach(input => input.setAttribute('readonly', true));

                    document.getElementById('formActions').style.display = 'none';
                });
                document.getElementById('saveProfileBtn').addEventListener('click', function () {
                    alert('Profile saved!');
                    const inputs = document.querySelectorAll('#profileForm input, #profileForm textarea');
                    inputs.forEach(input => input.setAttribute('readonly', true));

                    document.getElementById('formActions').style.display = 'none';
                });
                document.getElementById('changeAvatarBtn').addEventListener('click', function () {
                    document.getElementById('avatarInput').click();
                });

                document.getElementById('avatarInput').addEventListener('change', function () {
                    const file = this.files[0];
                    if (file && file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            const avatarDisplay = document.getElementById('avatarDisplay');
                            avatarDisplay.style.backgroundImage = `url('${e.target.result}')`;
                            avatarDisplay.textContent = ''; // Remove initials when image is added
                            avatarDisplay.style.backgroundSize = 'cover';
                            avatarDisplay.style.backgroundPosition = 'center';
                        };
                        reader.readAsDataURL(file);
                    }
                });
                document.getElementById('exportPdfBtn').addEventListener('click', function () {
                    // Select only the Delivery Schedule table
                    const deliveryTable = document.querySelector('#profile-section .content-section table');

                    html2canvas(deliveryTable).then(canvas => {
                        const imgData = canvas.toDataURL('image/png');
                        const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
                        const pageWidth = pdf.internal.pageSize.getWidth();
                        const imgProps = pdf.getImageProperties(imgData);
                        const pdfWidth = pageWidth;
                        const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

                        pdf.addImage(imgData, 'PNG', 0, 10, pdfWidth, pdfHeight);
                        pdf.save('delivery-schedule.pdf');
                    });
                });

                document.getElementById('addDeliveryBtn').addEventListener('click', function () {
                    document.getElementById('addDeliveryForm').style.display = 'block';
                });

                document.getElementById('saveDeliveryBtn').addEventListener('click', function () {
                    const delivery = {
                        id: document.getElementById('deliveryID').value,
                        date: document.getElementById('deliveryDate').value,
                        customer: document.getElementById('customer').value,
                        products: document.getElementById('products').value,
                        quantity: document.getElementById('quantity').value,
                        status: document.getElementById('status').value
                    };

                    // Get current deliveries from local storage
                    const deliveries = JSON.parse(localStorage.getItem('deliveries') || '[]');
                    deliveries.push(delivery);
                    localStorage.setItem('deliveries', JSON.stringify(deliveries));

                    insertDeliveryRow(delivery); // Adds row to table
                    document.getElementById('addDeliveryForm').reset();
                    document.getElementById('addDeliveryForm').style.display = 'none';
                });
                function insertDeliveryRow(delivery) {
                    const table = document.querySelector('#profile-section table tbody');
                    const row = document.createElement('tr');

                    row.innerHTML = `
                <td>${delivery.id}</td>
                <td>${new Date(delivery.date).toLocaleDateString()}<br>${new Date(delivery.date).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</td>
                <td>${delivery.customer.replace('\n', '<br>')}</td>
                <td>${delivery.products}</td>
                <td>${delivery.quantity}</td>
                <td><span class="status ${delivery.status}">${delivery.status.charAt(0).toUpperCase() + delivery.status.slice(1)}</span></td>
                <td><button>View Details</button></td>
            `;

                    table.appendChild(row);
                }

                document.addEventListener('DOMContentLoaded', function () {
                    const savedDeliveries = JSON.parse(localStorage.getItem('deliveries') || '[]');
                    savedDeliveries.forEach(delivery => insertDeliveryRow(delivery));
                });

                document.getElementById('exportPaymentPdfBtn').addEventListener('click', function () {
                    const paymentTable = document.querySelector('#profile-section .content-section:nth-of-type(3) table'); // Adjust if needed

                    html2canvas(paymentTable).then(canvas => {
                        const imgData = canvas.toDataURL('image/png');
                        const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
                        const pageWidth = pdf.internal.pageSize.getWidth();
                        const imgProps = pdf.getImageProperties(imgData);
                        const pdfWidth = pageWidth;
                        const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

                        pdf.setFontSize(14);
                        pdf.text("Payment Methods", 10, 10);
                        pdf.addImage(imgData, 'PNG', 0, 20, pdfWidth, pdfHeight);
                        pdf.save('payment-methods.pdf');
                    });
                });



                // Show child sections
                function showSection(sectionId) {
                    const sections = document.querySelectorAll('.child-section');
                    sections.forEach(section => section.classList.remove('active'));
                    const target = document.getElementById(sectionId);
                    if (target) target.classList.add('active');
                }




                // Feedback & Complaint Management functionality
                document.addEventListener('DOMContentLoaded', function () {
                    // Only initialize if section exists
                    if (document.getElementById('feedback-complaints-section')) {
                        // Toggle feedback form
                        document.getElementById('addFeedbackBtn').addEventListener('click', function () {
                            document.getElementById('addFeedbackForm').style.display = 'block';
                        });

                        document.getElementById('closeFeedbackForm').addEventListener('click', function () {
                            document.getElementById('addFeedbackForm').style.display = 'none';
                        });

                        document.getElementById('cancelFeedbackForm').addEventListener('click', function () {
                            document.getElementById('addFeedbackForm').style.display = 'none';
                        });



                        // Initialize charts
                        initializeFeedbackCharts();
                    }
                });

            </script>

            <script>
                const movements = [
                    {
                        date: "2025-06-28 10:30 AM",
                        product: "Milk",
                        quantity: 500,
                        type: "Inbound",
                        source: "Farmer A",
                        destination: "Chilling Center 1",
                        remarks: "Morning collection"
                    },
                    {
                        date: "2025-06-28 12:00 PM",
                        product: "Paneer",
                        quantity: 100,
                        type: "Outbound",
                        source: "Chilling Center 1",
                        destination: "Retail Outlet 3",
                        remarks: "Dispatch"
                    },
                    {
                        date: "2025-06-29 9:45 AM",
                        product: "Ghee",
                        quantity: 50,
                        type: "Transfer",
                        source: "Plant A",
                        destination: "Plant B",
                        remarks: "Stock transfer"
                    }
                ];

                function renderMovements() {
                    const tbody = document.getElementById("movementTableBody");
                    tbody.innerHTML = "";
                    movements.forEach((m, i) => {
                        const row = document.createElement("tr");
                        row.innerHTML = `
        <td>${m.date}</td>
        <td>${m.product}</td>
        <td>${m.quantity}</td>
        <td>${m.type}</td>
        <td>${m.source}</td>
        <td>${m.destination}</td>
        <td>${m.remarks}</td>
        <td>
          <button class="edit-btn" onclick="openMovementModal(${i})">Edit</button>
          <button class="delete-btn" onclick="deleteMovement(${i})"><i class="fas fa-trash"></i> Delete</button>
        </td>
      `;
                        tbody.appendChild(row);
                    });
                    updateCharts();
                }

                function openMovementModal(index = null) {
                    document.getElementById("movementModal").style.display = "flex";
                    document.getElementById("modalTitle").textContent = index === null ? "Add Inventory Movement" : "Edit Inventory Movement";
                    if (index !== null) {
                        const m = movements[index];
                        document.getElementById("editIndex").value = index;
                        document.getElementById("product").value = m.product;
                        document.getElementById("quantity").value = m.quantity;
                        document.getElementById("type").value = m.type;
                        document.getElementById("source").value = m.source;
                        document.getElementById("destination").value = m.destination;
                        document.getElementById("remarks").value = m.remarks;
                    } else {
                        document.getElementById("editIndex").value = "";
                        document.querySelectorAll("#movementModal input, #movementModal select").forEach(e => e.value = "");
                    }
                }

                function closeMovementModal() {
                    document.getElementById("movementModal").style.display = "none";
                }

                function saveMovement() {
                    const index = document.getElementById("editIndex").value;
                    const now = new Date().toLocaleString();
                    const data = {
                        date: now,
                        product: document.getElementById("product").value,
                        quantity: Number(document.getElementById("quantity").value),
                        type: document.getElementById("type").value,
                        source: document.getElementById("source").value,
                        destination: document.getElementById("destination").value,
                        remarks: document.getElementById("remarks").value
                    };
                    if (index === "") {
                        movements.push(data);
                    } else {
                        movements[index] = data;
                    }
                    closeMovementModal();
                    renderMovements();
                }

                function deleteMovement(index) {
                    if (confirm("Are you sure you want to delete this movement?")) {
                        movements.splice(index, 1);
                        renderMovements();
                    }
                }

                let typeChart, qtyChart;
                function updateCharts() {
                    const typeCount = { Inbound: 0, Outbound: 0, Transfer: 0 };
                    const qtyMap = {};

                    movements.forEach(m => {
                        typeCount[m.type] += 1;
                        const key = m.date.split(" ")[0]; // use date only
                        qtyMap[key] = (qtyMap[key] || 0) + m.quantity;
                    });

                    const ctx1 = document.getElementById("movementTypeChart").getContext("2d");
                    const ctx2 = document.getElementById("movementQuantityChart").getContext("2d");

                    if (typeChart) typeChart.destroy();
                    if (qtyChart) qtyChart.destroy();

                    typeChart = new Chart(ctx1, {
                        type: "doughnut",
                        data: {
                            labels: ["Inbound", "Outbound", "Transfer"],
                            datasets: [{
                                label: "Type",
                                data: [typeCount.Inbound, typeCount.Outbound, typeCount.Transfer],
                                backgroundColor: ["#00bbf9", "#e63946", "#f1c40f"]
                            }]
                        }
                    });

                    qtyChart = new Chart(ctx2, {
                        type: "bar",
                        data: {
                            labels: Object.keys(qtyMap),
                            datasets: [{
                                label: "Quantity",
                                data: Object.values(qtyMap),
                                backgroundColor: "#9b5de5"
                            }]
                        }
                    });
                }

                // Initialize
                renderMovements();
            </script>


            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    // User Management functionality
                    document.getElementById('addUserBtn').addEventListener('click', function () {
                        document.getElementById('addUserForm').style.display = 'block';
                    });

                    document.getElementById('closeUserForm').addEventListener('click', function () {
                        document.getElementById('addUserForm').style.display = 'none';
                    });

                    document.getElementById('cancelUserForm').addEventListener('click', function () {
                        document.getElementById('addUserForm').style.display = 'none';
                    });

                    document.getElementById('userForm').addEventListener('submit', function (e) {
                        e.preventDefault();
                        alert('User added successfully!');
                        document.getElementById('userForm').reset();
                        document.getElementById('addUserForm').style.display = 'none';
                    });

                    // Role permissions change
                    document.getElementById('roleSelect').addEventListener('change', function () {
                        // Here you would typically load permissions for the selected role
                        console.log('Loading permissions for role: ' + this.value);
                    });
                });


                // Add this to your existing JavaScript
                document.addEventListener('DOMContentLoaded', function () {
                    // Initialize charts for Access Control section
                    if (document.getElementById('access-control-section')) {
                        // Total Users Chart
                        new Chart(document.getElementById('totalUsersChart').getContext('2d'), {
                            type: 'line',
                            data: {
                                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                                datasets: [{
                                    data: [100, 105, 110, 115, 120, 124],
                                    borderColor: '#0077b6',
                                    borderWidth: 2,
                                    fill: false,
                                    tension: 0.4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { display: false } },
                                scales: { y: { display: false }, x: { display: false } }
                            }
                        });

                        // Security Events Chart
                        new Chart(document.getElementById('securityEventsChart').getContext('2d'), {
                            type: 'line',
                            data: {
                                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                                datasets: [{
                                    data: [20, 18, 16, 15, 16, 14],
                                    borderColor: '#e76f51',
                                    borderWidth: 2,
                                    fill: false,
                                    tension: 0.4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { display: false } },
                                scales: { y: { display: false }, x: { display: false } }
                            }
                        });

                        // Failed Logins Chart
                        new Chart(document.getElementById('failedLoginsChart').getContext('2d'), {
                            type: 'bar',
                            data: {
                                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                                datasets: [{
                                    data: [12, 10, 9, 8, 9, 8],
                                    backgroundColor: '#e9c46a'
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { display: false } },
                                scales: { y: { display: false }, x: { display: false } }
                            }
                        });

                        // Audit Status Chart
                        new Chart(document.getElementById('auditStatusChart').getContext('2d'), {
                            type: 'doughnut',
                            data: {
                                labels: ['Passed', 'Failed', 'Warning'],
                                datasets: [{
                                    data: [85, 10, 5],
                                    backgroundColor: ['#2a9d8f', '#e76f51', '#e9c46a']
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { display: false } },
                                cutout: '70%'
                            }
                        });

                        // Role Distribution Chart
                        new Chart(document.getElementById('roleDistributionChart').getContext('2d'), {
                            type: 'pie',
                            data: {
                                labels: ['Admin', 'Manager', 'Sales', 'Support', 'Delivery'],
                                datasets: [{
                                    data: [8, 12, 45, 22, 37],
                                    backgroundColor: [
                                        '#0077b6',
                                        '#00b4d8',
                                        '#2a9d8f',
                                        '#e9c46a',
                                        '#e76f51'
                                    ]
                                }]
                            },
                            options: {
                                responsive: true,
                                plugins: {
                                    legend: {
                                        position: 'right'
                                    },
                                    title: {
                                        display: true,
                                        text: 'User Role Distribution',
                                        font: { size: 16 }
                                    }
                                }
                            }
                        });

                        // Export Activity button
                        document.getElementById('exportActivityBtn').addEventListener('click', function () {
                            // In a real app, this would generate a CSV or PDF
                            alert('Exporting activity data...');
                        });

                        // Edit Permissions button
                        document.getElementById('editPermissionsBtn').addEventListener('click', function () {
                            showSection('role-permissions-section');
                        });

                        // Activity filter
                        document.getElementById('activityFilter').addEventListener('change', function () {
                            // In a real app, this would filter the timeline
                            console.log('Filtering by:', this.value);
                        });
                    }
                });

            </script>
            <script>
                document.querySelectorAll('.sidebar .nav-link').forEach(link => {
                    link.addEventListener('click', function (e) {
                        e.preventDefault(); // prevent page jump

                        // Remove 'active' from all links
                        document.querySelectorAll('.sidebar .nav-link').forEach(l => l.classList.remove('active'));

                        // Add 'active' to the clicked one
                        this.classList.add('active');

                        // Show the corresponding section
                        const sectionId = this.getAttribute('data-section');
                        if (sectionId) {
                            document.querySelectorAll('.child-section').forEach(sec => sec.classList.remove('active'));
                            const target = document.getElementById(sectionId);
                            if (target) target.classList.add('active');
                        }
                    });
                });
            </script>
            <script>
                document.getElementById("fullName").addEventListener("input", function (e) {
                    this.value = this.value.replace(/[^A-Za-z. ]/g, '');
                });

                document.getElementById("phone").addEventListener("input", function (e) {
                    let cleaned = this.value.replace(/[^0-9]/g, '');
                    this.value = '+91' + cleaned.slice(0, 10);
                });

                document.getElementById("email").addEventListener("input", function (e) {
                    let base = this.value.split('@')[0].replace(/[^a-zA-Z0-9+]/g, '');
                    this.value = base + "@gmail.com";
                });
            </script>


            <script>
                // Chart for Today's Collection
                new Chart(document.getElementById('todayCollectionChart').getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
                        datasets: [{
                            label: 'Collection (L)',
                            data: [11400, 11900, 12200, 12450, 12300, 12600],
                            borderColor: 'rgba(75, 192, 192, 1)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            fill: true,
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { display: false } },
                        scales: { y: { beginAtZero: true } }
                    }
                });

                // Chart for Avg. Fat %
                new Chart(document.getElementById('fatContentChart').getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
                        datasets: [{
                            label: 'Avg. Fat %',
                            data: [4.0, 4.2, 4.3, 4.1, 4.0, 4.1],
                            borderColor: 'rgba(255, 99, 132, 1)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            fill: true,
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { display: false } },
                        scales: { y: { beginAtZero: true } }
                    }
                });

                // Chart for Avg. SNF %
                new Chart(document.getElementById('snfContentChart').getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
                        datasets: [{
                            label: 'Avg. SNF %',
                            data: [8.3, 8.4, 8.5, 8.5, 8.6, 8.5],
                            borderColor: 'rgba(153, 102, 255, 1)',
                            backgroundColor: 'rgba(153, 102, 255, 0.2)',
                            fill: true,
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { display: false } },
                        scales: { y: { beginAtZero: true } }
                    }
                });
            </script>

            <script>
                document.addEventListener("DOMContentLoaded", () => {
                    const $ = id => document.getElementById(id);
                    const storageKey = 'deliveryRoutes';
                    let editingId = null;
                    let statusChart, driverChart;

                    function loadRoutes() {
                        return JSON.parse(localStorage.getItem(storageKey) || "[]");
                    }

                    function saveRoutes(data) {
                        localStorage.setItem(storageKey, JSON.stringify(data));
                    }

                    function renderRoutes() {
                        const tbody = $("routesTable");
                        const search = $("searchInput").value.toLowerCase();
                        const status = $("statusFilter").value;
                        const routes = loadRoutes().filter(route =>
                            (route.driver.toLowerCase().includes(search) || route.vehicle.toLowerCase().includes(search)) &&
                            (status === "" || route.status === status)
                        );

                        tbody.innerHTML = "";
                        routes.forEach((route, index) => {
                            const row = document.createElement("tr");
                            row.innerHTML = `
          <td>${route.id}</td>
          <td>${route.driver}</td>
          <td>${route.vehicle}</td>
          <td>${route.start}</td>
          <td>${route.end}</td>
          <td>${route.date}</td>
          <td>${route.status}</td>
          <td>
            <button class="edit-btn" onclick="editRoute(${index})">Edit</button>
            <button class="btn-primary" onclick="deleteRoute(${index})">Delete</button>
          </td>`;
                            tbody.appendChild(row);
                        });

                        updateCharts(routes);
                    }

                    window.openRouteForm = function () {
                        $("routeForm").reset();
                        $("routeId").value = "";
                        $("routeFormContainer").style.display = "block";
                        $("formTitle").textContent = "Add New Route";
                        editingId = null;
                    };

                    window.closeRouteForm = function () {
                        $("routeFormContainer").style.display = "none";
                    };

                    window.editRoute = function (index) {
                        const route = loadRoutes()[index];
                        editingId = index;
                        $("routeId").value = route.id;
                        $("driver").value = route.driver;
                        $("vehicle").value = route.vehicle;
                        $("start").value = route.start;
                        $("end").value = route.end;
                        $("date").value = route.date;
                        $("status").value = route.status;
                        $("formTitle").textContent = "Edit Route";
                        $("routeFormContainer").style.display = "block";
                    };

                    window.deleteRoute = function (index) {
                        if (confirm("Are you sure you want to delete this route?")) {
                            const routes = loadRoutes();
                            routes.splice(index, 1);
                            saveRoutes(routes);
                            renderRoutes();
                        }
                    };

                    $("routeForm").onsubmit = e => {
                        e.preventDefault();
                        const newRoute = {
                            id: $("routeId").value || "R" + Date.now(),
                            driver: $("driver").value,
                            vehicle: $("vehicle").value,
                            start: $("start").value,
                            end: $("end").value,
                            date: $("date").value,
                            status: $("status").value
                        };

                        const routes = loadRoutes();
                        if (editingId !== null) {
                            routes[editingId] = newRoute;
                        } else {
                            routes.push(newRoute);
                        }

                        saveRoutes(routes);
                        closeRouteForm();
                        renderRoutes();
                    };

                    function updateCharts(data) {
                        const statusCount = {}, driverCount = {};
                        data.forEach(r => {
                            statusCount[r.status] = (statusCount[r.status] || 0) + 1;
                            driverCount[r.driver] = (driverCount[r.driver] || 0) + 1;
                        });

                        if (statusChart) statusChart.destroy();
                        if (driverChart) driverChart.destroy();

                        const statusCtx = $("statusChart").getContext("2d");
                        const driverCtx = $("driverChart").getContext("2d");

                        statusChart = new Chart(statusCtx, {
                            type: "pie",
                            data: {
                                labels: Object.keys(statusCount),
                                datasets: [{
                                    data: Object.values(statusCount),
                                    backgroundColor: ["#2a9d8f", "#f4a261", "#e76f51", "#00b4d8"]
                                }]
                            },
                            options: { responsive: true }
                        });

                        driverChart = new Chart(driverCtx, {
                            type: "bar",
                            data: {
                                labels: Object.keys(driverCount),
                                datasets: [{
                                    label: "Deliveries",
                                    data: Object.values(driverCount),
                                    backgroundColor: "#0077b6"
                                }]
                            },
                            options: {
                                responsive: true,
                                indexAxis: 'y'
                            }
                        });
                    }

                    window.exportToPDF = function () {
                        html2canvas($("routesTableContainer")).then(canvas => {
                            const { jsPDF } = window.jspdf;
                            const pdf = new jsPDF();
                            pdf.addImage(canvas.toDataURL("image/png"), "PNG", 10, 10, 190, 0);
                            pdf.save("delivery_routes.pdf");
                        });
                    };



                    $("searchInput").addEventListener("input", renderRoutes);
                    $("statusFilter").addEventListener("change", renderRoutes);

                    if (!localStorage.getItem(storageKey)) {
                        saveRoutes([
                            { id: 'R101', driver: 'Ravi', vehicle: 'V123', start: 'Depot A', end: 'Zone X', date: '2025-06-20', status: 'Scheduled' },
                            { id: 'R102', driver: 'Anita', vehicle: 'V456', start: 'Depot B', end: 'Zone Y', date: '2025-06-21', status: 'In Transit' },
                            { id: 'R103', driver: 'Ravi', vehicle: 'V123', start: 'Depot C', end: 'Zone Z', date: '2025-06-22', status: 'Delivered' }
                        ]);
                    }

                    renderRoutes();
                });
            </script>

            <script>
                let reportsData = JSON.parse(localStorage.getItem('reportsData') || '[]');
                let reportsEditId = null;

                if (reportsData.length === 0) {
                    reportsData = [
                        { id: 1, title: "Monthly Sales", type: "Sales", date: "2025-06-01", createdBy: "Admin", description: "Sales summary for June." },
                        { id: 2, title: "Milk Inventory", type: "Inventory", date: "2025-06-05", createdBy: "Manager", description: "Current stock levels." },
                        { id: 3, title: "Distribution Route", type: "Distribution", date: "2025-06-10", createdBy: "Admin", description: "New delivery route plan." },
                        { id: 4, title: "Quality Inspection", type: "Quality", date: "2025-06-12", createdBy: "QC Team", description: "Test results summary." },
                        { id: 5, title: "Payment Summary", type: "Payments", date: "2025-06-15", createdBy: "Finance", description: "Farmer payment details." }
                    ];
                    localStorage.setItem('reportsData', JSON.stringify(reportsData));
                }

                function reportsRenderTable() {
                    const tbody = document.getElementById('reports-table-body');
                    tbody.innerHTML = '';
                    const search = document.getElementById('reports-search-input').value.toLowerCase();
                    const filter = document.getElementById('reports-filter-type').value;

                    let total = 0, sales = 0, inventory = 0;

                    reportsData.forEach(report => {
                        if ((filter && report.type !== filter) ||
                            (search && !report.title.toLowerCase().includes(search) && !report.type.toLowerCase().includes(search)))
                            return;

                        total++;
                        if (report.type === "Sales") sales++;
                        if (report.type === "Inventory") inventory++;

                        tbody.innerHTML += `
                <tr>
                    <td>${report.title}</td>
                    <td>${report.type}</td>
                    <td>${report.date}</td>
                    <td>${report.createdBy}</td>
                    <td>${report.description}</td>
                    <td>
                        <button class="btn-primary" onclick="reportsEdit(${report.id})">Edit</button>
                        <button class="delete-btn" onclick="reportsDelete(${report.id})">Delete</button>
                    </td>
                </tr>`;
                    });

                    document.getElementById('reports-total-count').innerText = total;
                    document.getElementById('reports-sales-count').innerText = sales;
                    document.getElementById('reports-inventory-count').innerText = inventory;
                    reportsUpdateChart();
                }

                function reportsOpenForm() {
                    document.getElementById('reports-form-container').style.display = 'block';
                    document.getElementById('reports-form-title').innerText = 'Add New Report';
                    reportsEditId = null;
                    document.getElementById('reports-title').value = '';
                    document.getElementById('reports-type').value = '';
                    document.getElementById('reports-date').value = '';
                    document.getElementById('reports-createdby').value = '';
                    document.getElementById('reports-description').value = '';
                }

                function reportsCloseForm() {
                    document.getElementById('reports-form-container').style.display = 'none';
                }

                function reportsSave() {
                    const title = document.getElementById('reports-title').value.trim();
                    const type = document.getElementById('reports-type').value;
                    const date = document.getElementById('reports-date').value;
                    const createdBy = document.getElementById('reports-createdby').value.trim();
                    const description = document.getElementById('reports-description').value.trim();

                    if (!title || !type || !date || !createdBy || !description) {
                        alert('Please fill all fields.');
                        return;
                    }

                    if (reportsEditId) {
                        reportsData = reportsData.map(r => r.id === reportsEditId ? { id: reportsEditId, title, type, date, createdBy, description } : r);
                    } else {
                        const newId = reportsData.length ? Math.max(...reportsData.map(r => r.id)) + 1 : 1;
                        reportsData.push({ id: newId, title, type, date, createdBy, description });
                    }

                    localStorage.setItem('reportsData', JSON.stringify(reportsData));
                    reportsCloseForm();
                    reportsRenderTable();
                }

                function reportsEdit(id) {
                    const report = reportsData.find(r => r.id === id);
                    if (!report) return;
                    reportsEditId = id;
                    document.getElementById('reports-form-title').innerText = 'Edit Report';
                    document.getElementById('reports-title').value = report.title;
                    document.getElementById('reports-type').value = report.type;
                    document.getElementById('reports-date').value = report.date;
                    document.getElementById('reports-createdby').value = report.createdBy;
                    document.getElementById('reports-description').value = report.description;
                    document.getElementById('reports-form-container').style.display = 'block';
                }

                function reportsDelete(id) {
                    if (confirm('Are you sure to delete this report?')) {
                        reportsData = reportsData.filter(r => r.id !== id);
                        localStorage.setItem('reportsData', JSON.stringify(reportsData));
                        reportsRenderTable();
                    }
                }

                function reportsExportCSV() {
                    let csv = "Title,Type,Date,Created By,Description\n";
                    reportsData.forEach(r => {
                        csv += `"${r.title}","${r.type}","${r.date}","${r.createdBy}","${r.description}"\n`;
                    });
                    const blob = new Blob([csv], { type: 'text/csv' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'reports.csv';
                    a.click();
                    URL.revokeObjectURL(url);
                }

                let reportsChart;
                function reportsUpdateChart() {
                    const typeCounts = {};
                    reportsData.forEach(r => {
                        typeCounts[r.type] = (typeCounts[r.type] || 0) + 1;
                    });

                    const ctx = document.getElementById('reports-chart').getContext('2d');
                    if (reportsChart) reportsChart.destroy();

                    reportsChart = new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: Object.keys(typeCounts),
                            datasets: [{
                                data: Object.values(typeCounts),
                                backgroundColor: ['#3498db', '#2ecc71', '#f1c40f', '#e67e22', '#9b59b6']
                            }]
                        }
                    });
                }

                reportsRenderTable();
            </script>

            
            <!-- Chart.js and JS functions -->
            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    const milkCtx = document.getElementById('milkChart').getContext('2d');
                    new Chart(milkCtx, {
                        type: 'line',
                        data: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                            datasets: [{
                                label: 'Milk Collected (Litres)',
                                data: [10800, 11200, 11700, 12100, 12450, 12300],
                                backgroundColor: 'rgba(155, 19, 82, 0.2)',
                                borderColor: '#9B1352',
                                fill: true,
                                tension: 0.3
                            }]
                        },
                        options: { responsive: true }
                    });

                    const incomeCtx = document.getElementById('incomeBarChart').getContext('2d');
                    new Chart(incomeCtx, {
                        type: 'bar',
                        data: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                            datasets: [{
                                label: 'Income (Lakhs)',
                                data: [2.8, 3.1, 3.5, 4.0, 4.2, 4.8],
                                backgroundColor: '#C23373'
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: {
                                    ticks: { callback: val => `₹${val}L` },
                                    beginAtZero: true
                                }
                            }
                        }
                    });



                    document.getElementById('exportIncomeChart').addEventListener('click', () => {
                        html2canvas(document.getElementById('incomeBarChart')).then(canvas => {
                            const imgData = canvas.toDataURL('image/png');
                            const pdf = new jspdf.jsPDF();
                            pdf.addImage(imgData, 'PNG', 10, 10, 180, 100);
                            pdf.save('income_chart.pdf');
                        });
                    });
                });

                function simulateLiveData() {
                    const values = [
                        Math.floor(5000 + Math.random() * 500),
                        Math.floor(12000 + Math.random() * 500),
                        (3.8 + Math.random() * 0.4).toFixed(1) + '%',
                        '₹' + (1700000 + Math.floor(Math.random() * 200000)).toLocaleString(),
                        '₹' + (300000 + Math.floor(Math.random() * 100000)).toLocaleString(),
                        Math.floor(Math.random() * 20)
                    ];
                    const cards = document.querySelectorAll(".stat-card .stat-value");
                    cards.forEach((card, i) => {
                        card.textContent = values[i];
                    });
                }
            </script>


            <script>
                // Initialize charts for Chilling Centers section
                document.addEventListener('DOMContentLoaded', function () {
                    if (document.getElementById('chilling-centers-section')) {
                        // Total Centers Chart
                        new Chart(document.getElementById('totalCentersChart').getContext('2d'), {
                            type: 'line',
                            data: {
                                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                                datasets: [{
                                    data: [8, 9, 10, 11, 11, 12],
                                    borderColor: '#0077b6',
                                    borderWidth: 2,
                                    fill: false,
                                    tension: 0.4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { display: false } },
                                scales: { y: { display: false }, x: { display: false } }
                            }
                        });

                        // Total Capacity Chart
                        new Chart(document.getElementById('totalCapacityChart').getContext('2d'), {
                            type: 'bar',
                            data: {
                                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                                datasets: [{
                                    data: [100000, 110000, 120000, 130000, 140000, 150000],
                                    backgroundColor: '#00b4d8',
                                    borderWidth: 0
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { display: false } },
                                scales: { y: { display: false }, x: { display: false } }
                            }
                        });

                        // Current Storage Chart
                        new Chart(document.getElementById('currentStorageChart').getContext('2d'), {
                            type: 'line',
                            data: {
                                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                                datasets: [{
                                    data: [75000, 80000, 85000, 90000, 100000, 112500],
                                    borderColor: '#2a9d8f',
                                    borderWidth: 2,
                                    fill: false,
                                    tension: 0.4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { display: false } },
                                scales: { y: { display: false }, x: { display: false } }
                            }
                        });

                        // Avg Temp Chart
                        new Chart(document.getElementById('avgTempChart').getContext('2d'), {
                            type: 'line',
                            data: {
                                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                                datasets: [{
                                    data: [4.5, 4.4, 4.3, 4.3, 4.2, 4.2],
                                    borderColor: '#e76f51',
                                    borderWidth: 2,
                                    fill: false,
                                    tension: 0.4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { display: false } },
                                scales: { y: { display: false }, x: { display: false } }
                            }
                        });

                        // Temperature Monitoring Chart
                        new Chart(document.getElementById('tempMonitoringChart').getContext('2d'), {
                            type: 'line',
                            data: {
                                labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', '24:00'],
                                datasets: [{
                                    label: 'Temperature (°C)',
                                    data: [4.2, 4.1, 4.3, 4.5, 4.4, 4.2, 4.1],
                                    borderColor: '#0077b6',
                                    backgroundColor: 'rgba(0, 119, 182, 0.1)',
                                    fill: true,
                                    tension: 0.3
                                }]
                            },
                            options: {
                                responsive: true,
                                plugins: {
                                    title: {
                                        display: true,
                                        text: 'Temperature Trend (Last 24 Hours)'
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function (context) {
                                                return context.dataset.label + ': ' + context.parsed.y + '°C';
                                            }
                                        }
                                    }
                                },
                                scales: {
                                    y: {
                                        min: 3,
                                        max: 5,
                                        title: {
                                            display: true,
                                            text: 'Temperature (°C)'
                                        }
                                    }
                                }
                            }
                        });

                        // Inventory Movement Chart
                        new Chart(document.getElementById('inventoryMovementChart').getContext('2d'), {
                            type: 'bar',
                            data: {
                                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
                                datasets: [
                                    {
                                        label: 'Milk In (L)',
                                        data: [12000, 11500, 12500, 13000, 11800, 11000],
                                        backgroundColor: '#2a9d8f'
                                    },
                                    {
                                        label: 'Milk Out (L)',
                                        data: [10000, 9500, 10500, 11000, 9800, 9000],
                                        backgroundColor: '#e76f51'
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                plugins: {
                                    title: {
                                        display: true,
                                        text: 'Weekly Inventory Movement'
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function (context) {
                                                return context.dataset.label + ': ' + context.parsed.y + 'L';
                                            }
                                        }
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        title: {
                                            display: true,
                                            text: 'Liters'
                                        }
                                    }
                                }
                            }
                        });

                        // Add Center button functionality
                        document.getElementById('addCenterBtn').addEventListener('click', function () {
                            document.getElementById('addCenterForm').style.display = 'block';
                        });

                        document.getElementById('closeCenterForm').addEventListener('click', function () {
                            document.getElementById('addCenterForm').style.display = 'none';
                        });

                        document.getElementById('cancelCenterForm').addEventListener('click', function () {
                            document.getElementById('addCenterForm').style.display = 'none';
                        });

                        document.getElementById('centerForm').addEventListener('submit', function (e) {
                            e.preventDefault();
                            alert('Chilling center added successfully!');
                            document.getElementById('centerForm').reset();
                            document.getElementById('addCenterForm').style.display = 'none';
                        });

                        // Time range selector for temperature chart
                        document.getElementById('tempTimeRange').addEventListener('change', function () {
                            // In a real app, this would reload the chart data
                            console.log('Loading temperature data for: ' + this.value);
                        });

                        // Export inventory data
                        document.getElementById('exportInventoryBtn').addEventListener('click', function () {
                            alert('Exporting inventory data...');
                        });

                        // Add maintenance log
                        document.getElementById('addMaintenanceBtn').addEventListener('click', function () {
                            // In a real app, this would open a form
                            alert('Add maintenance log form would open here');
                        });
                    }
                });

                // Initialize Processing Plants Charts
                document.addEventListener('DOMContentLoaded', function () {
                    if (document.getElementById('processing-plants-section')) {
                        // Total Plants Chart
                        new Chart(document.getElementById('totalPlantsChart').getContext('2d'), {
                            type: 'line',
                            data: {
                                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                                datasets: [{
                                    data: [6, 6, 7, 7, 7, 8],
                                    borderColor: '#0077b6',
                                    borderWidth: 2,
                                    fill: false,
                                    tension: 0.4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { display: false } },
                                scales: { y: { display: false }, x: { display: false } }
                            }
                        });

                        // Daily Capacity Chart
                        new Chart(document.getElementById('dailyCapacityChart').getContext('2d'), {
                            type: 'bar',
                            data: {
                                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                                datasets: [{
                                    data: [200000, 210000, 220000, 230000, 240000, 250000],
                                    backgroundColor: '#00b4d8'
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { display: false } },
                                scales: { y: { display: false }, x: { display: false } }
                            }
                        });

                        // Utilization Chart
                        new Chart(document.getElementById('utilizationChart').getContext('2d'), {
                            type: 'line',
                            data: {
                                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                                datasets: [{
                                    data: [83, 82, 80, 79, 78, 78],
                                    borderColor: '#e76f51',
                                    borderWidth: 2,
                                    fill: false,
                                    tension: 0.4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { display: false } },
                                scales: { y: { display: false }, x: { display: false } }
                            }
                        });

                        // Efficiency Chart
                        new Chart(document.getElementById('efficiencyChart').getContext('2d'), {
                            type: 'line',
                            data: {
                                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                                datasets: [{
                                    data: [80, 80, 81, 81, 82, 82],
                                    borderColor: '#2a9d8f',
                                    borderWidth: 2,
                                    fill: false,
                                    tension: 0.4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { display: false } },
                                scales: { y: { display: false }, x: { display: false } }
                            }
                        });

                        // Production Trend Chart
                        new Chart(document.getElementById('productionTrendChart').getContext('2d'), {
                            type: 'line',
                            data: {
                                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                                datasets: [{
                                    label: 'Milk Production (L)',
                                    data: [180000, 185000, 190000, 195000],
                                    borderColor: '#0077b6',
                                    backgroundColor: 'rgba(0, 119, 182, 0.1)',
                                    fill: true,
                                    tension: 0.3
                                }, {
                                    label: 'Cheese Production (kg)',
                                    data: [12000, 12500, 13000, 13500],
                                    borderColor: '#2a9d8f',
                                    backgroundColor: 'rgba(42, 157, 143, 0.1)',
                                    fill: true,
                                    tension: 0.3
                                }]
                            },
                            options: {
                                responsive: true,
                                plugins: {
                                    title: {
                                        display: true,
                                        text: 'Weekly Production Trends'
                                    }
                                }
                            }
                        });

                        // Critical Alerts Chart
                        new Chart(document.getElementById('criticalAlertsChart').getContext('2d'), {
                            type: 'bar',
                            data: {
                                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                                datasets: [{
                                    data: [5, 4, 4, 3, 3, 3],
                                    backgroundColor: '#e76f51'
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { display: false } },
                                scales: { y: { display: false }, x: { display: false } }
                            }
                        });

                        // Preventive Maintenance Chart
                        new Chart(document.getElementById('preventiveMaintenanceChart').getContext('2d'), {
                            type: 'line',
                            data: {
                                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                                datasets: [{
                                    data: [10, 11, 11, 12, 12, 12],
                                    borderColor: '#e9c46a',
                                    borderWidth: 2,
                                    fill: false,
                                    tension: 0.4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { display: false } },
                                scales: { y: { display: false }, x: { display: false } }
                            }
                        });

                        // Energy Usage Chart
                        new Chart(document.getElementById('energyUsageChart').getContext('2d'), {
                            type: 'line',
                            data: {
                                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                                datasets: [{
                                    data: [1200, 1210, 1220, 1230, 1240, 1250],
                                    borderColor: '#00b4d8',
                                    borderWidth: 2,
                                    fill: false,
                                    tension: 0.4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { display: false } },
                                scales: { y: { display: false }, x: { display: false } }
                            }
                        });

                        // Add Plant Form Toggle
                        document.getElementById('addPlantBtn').addEventListener('click', function () {
                            document.getElementById('addPlantForm').style.display = 'block';
                        });

                        document.getElementById('closePlantForm').addEventListener('click', function () {
                            document.getElementById('addPlantForm').style.display = 'none';
                        });

                        document.getElementById('cancelPlantForm').addEventListener('click', function () {
                            document.getElementById('addPlantForm').style.display = 'none';
                        });

                        // Form submission
                        document.getElementById('plantForm').addEventListener('submit', function (e) {
                            e.preventDefault();
                            alert('Plant added successfully!');
                            document.getElementById('plantForm').reset();
                            document.getElementById('addPlantForm').style.display = 'none';
                        });

                        // Add Production Line Button
                        document.getElementById('addProductionLineBtn').addEventListener('click', function () {
                            alert('Add production line functionality would go here');
                        });

                        // Add Maintenance Log Button
                        document.getElementById('addMaintenanceLogBtn').addEventListener('click', function () {
                            alert('Add maintenance log functionality would go here');
                        });

                        // Export Equipment Data Button
                        document.getElementById('exportEquipmentDataBtn').addEventListener('click', function () {
                            alert('Exporting equipment data...');
                        });
                    }
                });
            </script>

            <script>
                // Data store for tests
                let qcTests = [
                    {
                        id: 'T1001',
                        batchId: 'B001',
                        type: 'Fat',
                        result: 'Pass',
                        date: '2025-06-15',
                        technician: 'Amit Kumar',
                        remarks: 'Normal levels'
                    },
                    {
                        id: 'T1002',
                        batchId: 'B002',
                        type: 'Protein',
                        result: 'Fail',
                        date: '2025-06-16',
                        technician: 'Reena Shah',
                        remarks: 'Below standard'
                    },
                    {
                        id: 'T1003',
                        batchId: 'B003',
                        type: 'SNF',
                        result: 'Pass',
                        date: '2025-06-17',
                        technician: 'Vikram Rao',
                        remarks: 'All parameters OK'
                    }
                ];

                let qcEditIndex = -1;

                function qcOpenAddModal(editIndex = -1) {
                    qcEditIndex = editIndex;
                    document.getElementById('qc-modal-title').innerText = editIndex === -1 ? 'Add New Test' : 'Edit Test';

                    if (editIndex >= 0) {
                        const test = qcTests[editIndex];
                        document.getElementById('qc-batch-id').value = test.batchId;
                        document.getElementById('qc-test-type').value = test.type;
                        document.getElementById('qc-test-result').value = test.result;
                        document.getElementById('qc-test-date').value = test.date;
                        document.getElementById('qc-technician').value = test.technician;
                        document.getElementById('qc-remarks').value = test.remarks;
                    } else {
                        document.querySelectorAll('#qc-modal input, #qc-modal select').forEach(el => el.value = '');
                    }

                    document.getElementById('qc-modal').style.display = 'flex';
                }

                function qcCloseModal() {
                    document.getElementById('qc-modal').style.display = 'none';
                }

                function qcSaveTest() {
                    const test = {
                        id: 'T' + (qcEditIndex >= 0 ? qcTests[qcEditIndex].id : Date.now()),
                        batchId: document.getElementById('qc-batch-id').value.trim(),
                        type: document.getElementById('qc-test-type').value,
                        result: document.getElementById('qc-test-result').value,
                        date: document.getElementById('qc-test-date').value,
                        technician: document.getElementById('qc-technician').value.trim(),
                        remarks: document.getElementById('qc-remarks').value.trim()
                    };

                    if (qcEditIndex >= 0) {
                        qcTests[qcEditIndex] = test;
                    } else {
                        qcTests.push(test);
                    }

                    qcCloseModal();
                    qcRenderTable();
                    qcRenderCharts();
                    qcUpdateStats();
                }

                function qcRenderTable() {
                    const tbody = document.getElementById('qc-tests-body');
                    const search = document.getElementById('qc-search-input').value.toLowerCase();

                    tbody.innerHTML = '';
                    qcTests.filter(t =>
                        t.batchId.toLowerCase().includes(search) ||
                        t.type.toLowerCase().includes(search) ||
                        t.result.toLowerCase().includes(search) ||
                        t.technician.toLowerCase().includes(search)
                    ).forEach((test, index) => {
                        const row = `<tr>
            <td>${test.id}</td>
            <td>${test.batchId}</td>
            <td>${test.type}</td>
            <td>${test.result}</td>
            <td>${test.date}</td>
            <td>${test.technician}</td>
            <td>
                <button class='btn-primary' onclick='qcOpenAddModal(${index})'>Edit</button>
                <button class='delete-btn' onclick='qcDeleteTest(${index})'>Delete</button>
            </td>
        </tr>`;
                        tbody.innerHTML += row;
                    });
                }

                function qcDeleteTest(index) {
                    if (confirm('Are you sure you want to delete this test?')) {
                        qcTests.splice(index, 1);
                        qcRenderTable();
                        qcRenderCharts();
                        qcUpdateStats();
                    }
                }

                function qcUpdateStats() {
                    document.getElementById('qc-total-tests').innerText = qcTests.length;
                    document.getElementById('qc-total-pass').innerText = qcTests.filter(t => t.result === 'Pass').length;
                    document.getElementById('qc-total-fail').innerText = qcTests.filter(t => t.result === 'Fail').length;
                }

                function qcRenderCharts() {
                    const typeCounts = {};
                    const resultCounts = { Pass: 0, Fail: 0 };

                    qcTests.forEach(t => {
                        typeCounts[t.type] = (typeCounts[t.type] || 0) + 1;
                        resultCounts[t.result]++;
                    });

                    // Type Chart
                    const typeCtx = document.getElementById('qc-type-chart').getContext('2d');
                    if (window.qcTypeChart) window.qcTypeChart.destroy();
                    window.qcTypeChart = new Chart(typeCtx, {
                        type: 'pie',
                        data: {
                            labels: Object.keys(typeCounts),
                            datasets: [{
                                data: Object.values(typeCounts),
                                backgroundColor: ['#0077b6', '#00b4d8', '#90e0ef', '#caf0f8']
                            }]
                        }
                    });

                    // Pass/Fail Chart
                    const resultCtx = document.getElementById('qc-passfail-chart').getContext('2d');
                    if (window.qcResultChart) window.qcResultChart.destroy();
                    window.qcResultChart = new Chart(resultCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Pass', 'Fail'],
                            datasets: [{
                                data: [resultCounts.Pass, resultCounts.Fail],
                                backgroundColor: ['#2a9d8f', '#e76f51']
                            }]
                        }
                    });
                }

                function qcExportToExcel() {
                    let csv = 'Test ID,Batch ID,Type,Result,Date,Technician,Remarks\n';
                    qcTests.forEach(t => {
                        csv += `${t.id},${t.batchId},${t.type},${t.result},${t.date},${t.technician},${t.remarks}\n`;
                    });
                    const blob = new Blob([csv], { type: 'text/csv' });
                    const a = document.createElement('a');
                    a.href = URL.createObjectURL(blob);
                    a.download = 'quality_tests.csv';
                    a.click();
                }

                function qcExportToPDF() {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    doc.text('Quality Control Tests', 14, 15);
                    const rows = qcTests.map(t => [t.id, t.batchId, t.type, t.result, t.date, t.technician, t.remarks]);
                    doc.autoTable({
                        head: [['Test ID', 'Batch ID', 'Type', 'Result', 'Date', 'Technician', 'Remarks']],
                        body: rows
                    });
                    doc.save('quality_tests.pdf');
                }

                // Initial rendering when section is loaded or visible
                document.addEventListener('DOMContentLoaded', () => {
                    qcRenderTable();
                    qcRenderCharts();
                    qcUpdateStats();
                });
            </script>

            <script>
                document.querySelectorAll('.has-submenu > a.nav-link').forEach(link => {
                    link.addEventListener('click', function (e) {
                        e.preventDefault();
                        const submenu = this.nextElementSibling;

                        // Collapse any other open submenu (optional)
                        document.querySelectorAll('.submenu').forEach(sm => {
                            if (sm !== submenu) sm.classList.remove('open');
                        });

                        // Toggle this one
                        submenu.classList.toggle('open');
                    });
                });
            </script>






            <script>
                const rolePermissions = {
                    admin: ['Manage Users', 'View Reports', 'Edit Settings', 'Full Access'],
                    manager: ['View Reports', 'Manage Users'],
                    auditor: ['Access Audit Logs', 'View Reports'],
                    user: ['View Own Data']
                };

                let users = [
                    { name: 'Alice', email: 'alice@admin.com', phone: '1234567890', role: 'admin' },
                    { name: 'Bob', email: 'bob@user.com', phone: '9876543210', role: 'user' }
                ];

                // Modal Handling
                document.getElementById('open-add-user-form-btn').onclick = () => {
                    document.getElementById('add-user-modal').style.display = 'flex';
                };
                document.getElementById('close-add-user-form-btn').onclick = () => {
                    document.getElementById('add-user-modal').style.display = 'none';
                };

                // Permission Preview
                function updatePermissionPreview() {
                    const role = document.getElementById('role-select').value;
                    const list = document.getElementById('permissions-list');
                    list.innerHTML = '';
                    rolePermissions[role].forEach(p => {
                        const li = document.createElement('li');
                        li.textContent = p;
                        list.appendChild(li);
                    });
                }
                document.getElementById('role-select').addEventListener('change', updatePermissionPreview);
                updatePermissionPreview();

                // Add User Form
                document.getElementById('add-user-form').onsubmit = function (e) {
                    e.preventDefault();
                    const form = e.target;
                    const user = {
                        name: form.name.value.trim(),
                        email: form.email.value.trim(),
                        phone: form.phone.value.trim(),
                        role: form.role.value
                    };
                    users.push(user);
                    form.reset();
                    updatePermissionPreview();
                    document.getElementById('add-user-modal').style.display = 'none';
                    renderUsers();
                };

                // Delete Function (make global)
                function deleteUser(index) {
                    if (confirm('Are you sure to delete this user?')) {
                        users.splice(index, 1);
                        renderUsers();
                    }
                }
                window.deleteUser = deleteUser; // 🔧 Required for onclick to work

                function renderUsers() {
                    const tbody = document.querySelector('#users-table tbody');
                    tbody.innerHTML = '';
                    const search = document.getElementById('userSearch').value.toLowerCase();
                    const roleFilter = document.getElementById('roleFilter').value;
                    let counts = { admin: 0, manager: 0, auditor: 0, user: 0 };

                    users.forEach((user, index) => {
                        if (
                            (user.name.toLowerCase().includes(search) || user.email.toLowerCase().includes(search)) &&
                            (roleFilter === '' || user.role === roleFilter)
                        ) {
                            const tr = document.createElement('tr');

                            // Create permission list HTML
                            const permissionsHTML = rolePermissions[user.role]
                                .map(p => `<li>${p}</li>`)
                                .join('');

                            // Create row content
                            tr.innerHTML = `
        <td>${user.name}</td>
        <td>${user.email}</td>
        <td>${user.phone}</td>
        <td>${user.role}</td>
        <td><ul>${permissionsHTML}</ul></td>
        <td><button class="delete-btn"><i class="fa fa-trash"></i> Delete</button></td>
      `;

                            // Append row to table
                            tbody.appendChild(tr);

                            // Add event listener to Delete button
                            const deleteBtn = tr.querySelector('.delete-btn');
                            deleteBtn.addEventListener('click', () => {
                                if (confirm(`Delete ${user.name}?`)) {
                                    users.splice(index, 1);
                                    renderUsers(); // re-render the table
                                }
                            });
                        }

                        // Update role counts
                        if (user.role in counts) {
                            counts[user.role]++;
                        }
                    });

                    // Update stats
                    document.getElementById('total-users').textContent = users.length;
                    document.getElementById('total-admins').textContent = counts.admin;
                    document.getElementById('total-managers').textContent = counts.manager;
                    document.getElementById('total-auditors').textContent = counts.auditor;
                    document.getElementById('total-users-role').textContent = counts.user;
                }


                // Bind Filters
                document.getElementById('userSearch').oninput = renderUsers;
                document.getElementById('roleFilter').onchange = renderUsers;

                // Initial Load
                renderUsers();
            </script>




            <!-- Quality Testing Section ... (your HTML content as before) ... -->
            <script>
document.addEventListener('DOMContentLoaded', loadQualityTests);

function getQualityTests() {
    return JSON.parse(localStorage.getItem('qualityTests') || '[]');
}

function saveQualityTests(tests) {
    localStorage.setItem('qualityTests', JSON.stringify(tests));
}

function loadQualityTests() {
    const tests = getQualityTests();
    const tbody = document.querySelector('#quality-test-table tbody');
    tbody.innerHTML = '';

    let total = tests.length;
    let passCount = tests.filter(t => t.result === 'Pass').length;
    let failCount = tests.filter(t => t.result === 'Fail').length;

    tests.forEach((t, index) => {
        tbody.innerHTML += `
            <tr>
                <td>${t.date}</td>
                <td>${t.batch}</td>
                <td>${t.type}</td>
                <td>${t.result}</td>
                <td>${t.remarks}</td>
                <td>
                    <button class="btn-success" onclick="editQualityTest(${index})"><i class="fa fa-edit"></i></button>
                    <button class="delete-btn" onclick="deleteQualityTest(${index})"><i class="fa fa-trash"></i></button>
                </td>
            </tr>
        `;
    });

    document.getElementById('qt-total-tests').innerText = total;
    document.getElementById('qt-pass-rate').innerText = total ? Math.round((passCount / total) * 100) + '%' : '0%';
    document.getElementById('qt-failed-tests').innerText = failCount;

    renderQualityCharts(tests);
}

function showQualityTestForm() {
    document.getElementById('quality-test-form').style.display = 'block';
    document.getElementById('qtForm').reset();
    document.getElementById('qtIndex').value = '';
}

function hideQualityTestForm() {
    document.getElementById('quality-test-form').style.display = 'none';
}

document.getElementById('qtForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const index = document.getElementById('qtIndex').value;
    const newTest = {
        date: document.getElementById('qtDate').value,
        batch: document.getElementById('qtBatch').value,
        type: document.getElementById('qtType').value,
        result: document.getElementById('qtResult').value,
        remarks: document.getElementById('qtRemarks').value
    };

    let tests = getQualityTests();

    if (index) {
        tests[index] = newTest;
    } else {
        tests.push(newTest);
    }

    saveQualityTests(tests);
    loadQualityTests();
    hideQualityTestForm();
});

function editQualityTest(index) {
    const test = getQualityTests()[index];
    document.getElementById('qtDate').value = test.date;
    document.getElementById('qtBatch').value = test.batch;
    document.getElementById('qtType').value = test.type;
    document.getElementById('qtResult').value = test.result;
    document.getElementById('qtRemarks').value = test.remarks;
    document.getElementById('qtIndex').value = index;
    document.getElementById('quality-test-form').style.display = 'block';
}

function deleteQualityTest(index) {
    if (confirm('Are you sure to delete this test?')) {
        let tests = getQualityTests();
        tests.splice(index, 1);
        saveQualityTests(tests);
        loadQualityTests();
    }
}

function exportQualityTests() {
    const tests = getQualityTests();
    let csv = "Date,Batch,Type,Result,Remarks\n";
    tests.forEach(t => {
        csv += `${t.date},${t.batch},${t.type},${t.result},${t.remarks}\n`;
    });

    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'QualityTests.csv';
    link.click();
}

let qtPieChart, qtBarChart;
function renderQualityCharts(tests) {
    const resultCounts = { Pass: 0, Fail: 0, Pending: 0 };
    const typeCounts = {};

    tests.forEach(t => {
        resultCounts[t.result] = (resultCounts[t.result] || 0) + 1;
        typeCounts[t.type] = (typeCounts[t.type] || 0) + 1;
    });

    const pieCtx = document.getElementById('qtResultPie').getContext('2d');
    if (qtPieChart) qtPieChart.destroy();
    qtPieChart = new Chart(pieCtx, {
        type: 'pie',
        data: {
            labels: Object.keys(resultCounts),
            datasets: [{
                data: Object.values(resultCounts),
                backgroundColor: ['#2ecc71', '#e74c3c', '#f1c40f']
            }]
        }
    });

    const barCtx = document.getElementById('qtTypeBar').getContext('2d');
    if (qtBarChart) qtBarChart.destroy();
    qtBarChart = new Chart(barCtx, {
        type: 'bar',
        data: {
            labels: Object.keys(typeCounts),
            datasets: [{
                label: 'Test Count',
                data: Object.values(typeCounts),
                backgroundColor: '#3498db'
            }]
        },
        options: {
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
}
</script>







            <script>
                function showSection(sectionId) {
                    document.querySelectorAll('.child-section').forEach(sec => sec.style.display = 'none');
                    const target = document.getElementById(sectionId);
                    if (target) target.style.display = 'block';
                }

                // Top Farmers Data
                const farmers = [
                    { name: "Ramesh Kumar", village: "Gundlapalli", milk: 62.5, cattle: 18, phone: "9876543210" },
                    { name: "Meena Devi", village: "Kollapur", milk: 58.2, cattle: 12, phone: "9845012312" },
                    { name: "Kiran Reddy", village: "Pedda Kothapalli", milk: 55.1, cattle: 15, phone: "9911223344" },
                    { name: "Lakshmi Bai", village: "Tandur", milk: 51.8, cattle: 10, phone: "9001234567" },
                    { name: "Mohd. Azhar", village: "Nizamabad", milk: 49.9, cattle: 9, phone: "9988776655" }
                ];

                function renderFarmerTable() {
                    const tbody = document.getElementById('farmerTableBody');
                    tbody.innerHTML = farmers.map(f =>
                        `<tr>
      <td>${f.name}</td>
      <td>${f.village}</td>
      <td>${f.milk}</td>
      <td>${f.cattle}</td>
      <td>${f.phone}</td>
    </tr>`).join('');
                }

                // Timeline Data
                const activities = [
                    { type: 'success', title: 'New Farmer Registered', time: 'Today 10:12 AM', details: 'M. Ravi from Nalgonda joined the cooperative' },
                    { type: 'warning', title: 'Address Updated', time: 'Yesterday 4:45 PM', details: 'S. Lakshmi updated her contact details' },
                    { type: 'danger', title: 'Payment Dispute Raised', time: '2 days ago', details: 'Farmer ID 2435 reported March payment issue' }
                ];

                function renderFarmerTimeline() {
                    const list = document.getElementById('farmerTimeline');
                    list.innerHTML = activities.map(act => `
    <li style="margin-bottom: 20px;">
      <div style="font-weight: bold; color: ${act.type === 'success' ? 'green' : act.type === 'warning' ? 'orange' : 'red'};">
        ${act.title} <span style="float: right; font-weight: normal; color: gray;">${act.time}</span>
      </div>
      <div style="margin-left: 10px; color: #555;">${act.details}</div>
    </li>
  `).join('');
                }

                // Charts
                function renderFarmerCharts() {
                    const chartOptions = (data) => ({
                        type: 'line',
                        data: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May'],
                            datasets: [{
                                label: '',
                                data,
                                borderColor: '#6a1b9a',
                                backgroundColor: 'rgba(106, 27, 154, 0.1)',
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            plugins: { legend: { display: false } },
                            scales: { x: { display: false }, y: { display: false } },
                            responsive: true
                        }
                    });

                    new Chart(document.getElementById('farmerCountChart'), chartOptions([4200, 4320, 4450, 5000, 5247]));
                    new Chart(document.getElementById('avgMilkChart'), chartOptions([30, 32, 35, 37, 38.5]));
                    new Chart(document.getElementById('cattleChart'), chartOptions([12000, 12600, 13200, 14000, 14902]));
                }

                document.addEventListener('DOMContentLoaded', () => {
                    renderFarmerCharts();
                    renderFarmerTable();
                    renderFarmerTimeline();
                });
            </script>

            <!-- ✅ Inventory JavaScript -->
            <script>
                let inventory = [
                    { name: "Milk Cans", category: "Storage", quantity: 120, price: 450 },
                    { name: "Paneer Packaging", category: "Packaging", quantity: 300, price: 12 },
                    { name: "Glass Jars", category: "Containers", quantity: 200, price: 18 },
                    { name: "Lab Testing Kit", category: "Quality Tools", quantity: 10, price: 3200 }
                ];
                let editingIndex = -1;

                function renderInventoryTable() {
                    const tbody = document.getElementById("inventoryBody");
                    const categoryFilter = document.getElementById("categoryFilter").value;
                    const searchTerm = document.getElementById("inventorySearch").value.toLowerCase();
                    tbody.innerHTML = "";

                    let totalValue = 0;
                    const categories = new Set();

                    inventory.forEach((item, index) => {
                        categories.add(item.category);
                        const matchesCategory = categoryFilter === "all" || item.category === categoryFilter;
                        const matchesSearch = item.name.toLowerCase().includes(searchTerm);

                        if (matchesCategory && matchesSearch) {
                            const total = item.quantity * item.price;
                            totalValue += total;
                            const quantityStyle = item.quantity < 20 ? 'color:red;font-weight:bold;' : '';

                            tbody.innerHTML += `
          <tr>
            <td>${item.name}</td>
            <td>${item.category}</td>
            <td style="${quantityStyle}">${item.quantity}</td>
            <td>₹${item.price.toFixed(2)}</td>
            <td>₹${total.toFixed(2)}</td>
            <td>
              <button class="edit-btn" onclick="openInventoryForm(${index})">Edit</button>
              <button class="delete-btn" onclick="deleteInventoryItem(${index})">Delete</button>
            </td>
          </tr>`;
                        }
                    });

                    document.getElementById("totalItems").innerText = inventory.length;
                    document.getElementById("totalValue").innerText = "₹" + totalValue.toFixed(2);
                    document.getElementById("totalCategories").innerText = categories.size;

                    const catSelect = document.getElementById("categoryFilter");
                    const currentVal = catSelect.value;
                    catSelect.innerHTML = `<option value="all">All Categories</option>`;
                    categories.forEach(cat => {
                        const opt = document.createElement("option");
                        opt.value = cat;
                        opt.innerText = cat;
                        if (cat === currentVal) opt.selected = true;
                        catSelect.appendChild(opt);
                    });
                }

                function openInventoryForm(index = -1) {
                    editingIndex = index;
                    const modal = document.getElementById("inventoryModal");
                    modal.style.display = "flex";

                    if (index >= 0) {
                        const item = inventory[index];
                        document.getElementById("inventoryFormTitle").innerText = "Edit Inventory Item";
                        document.getElementById("itemName").value = item.name;
                        document.getElementById("itemCategory").value = item.category;
                        document.getElementById("itemQuantity").value = item.quantity;
                        document.getElementById("itemPrice").value = item.price;
                    } else {
                        document.getElementById("inventoryFormTitle").innerText = "Add Inventory Item";
                        document.getElementById("itemName").value = "";
                        document.getElementById("itemCategory").value = "";
                        document.getElementById("itemQuantity").value = "";
                        document.getElementById("itemPrice").value = "";
                    }
                }

                function closeInventoryForm() {
                    document.getElementById("inventoryModal").style.display = "none";
                }

                function saveInventoryItem() {
                    const name = document.getElementById("itemName").value.trim();
                    const category = document.getElementById("itemCategory").value.trim();
                    const quantity = parseInt(document.getElementById("itemQuantity").value);
                    const price = parseFloat(document.getElementById("itemPrice").value);

                    if (!name || !category || isNaN(quantity) || isNaN(price)) {
                        alert("Please fill all fields correctly.");
                        return;
                    }

                    const item = { name, category, quantity, price };
                    if (editingIndex >= 0) {
                        inventory[editingIndex] = item;
                    } else {
                        inventory.push(item);
                    }

                    closeInventoryForm();
                    renderInventoryTable();
                }

                function deleteInventoryItem(index) {
                    if (confirm("Are you sure you want to delete this item?")) {
                        inventory.splice(index, 1);
                        renderInventoryTable();
                    }
                }

                function exportInventoryToCSV() {
                    let csv = "Item Name,Category,Quantity,Unit Price,Total Value\n";
                    inventory.forEach(item => {
                        const total = item.quantity * item.price;
                        csv += `${item.name},${item.category},${item.quantity},${item.price},${total}\n`;
                    });

                    const blob = new Blob([csv], { type: "text/csv" });
                    const a = document.createElement("a");
                    a.href = URL.createObjectURL(blob);
                    a.download = "inventory_data.csv";
                    a.click();
                }

                window.addEventListener("load", () => {
                    renderInventoryTable();
                    document.getElementById("inventorySearch").addEventListener("input", renderInventoryTable);
                    document.getElementById("categoryFilter").addEventListener("change", renderInventoryTable);
                });
            </script>


            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    let farmers = JSON.parse(localStorage.getItem('farmers')) || [];
                    let currentFarmerId = null;
                    let currentPage = 1;
                    const farmersPerPage = 5;

                    // DOM elements
                    const farmerForm = document.getElementById('farmerForm');
                    const farmersTableBody = document.getElementById('farmersTableBody');
                    const farmerSearch = document.getElementById('farmerSearch');
                    const prevFarmersPage = document.getElementById('prevFarmersPage');
                    const nextFarmersPage = document.getElementById('nextFarmersPage');
                    const farmersPaginationInfo = document.getElementById('farmersPaginationInfo');
                    const addFarmerBtn = document.getElementById('addFarmerBtn');
                    const farmerFormContainer = document.getElementById('farmerFormContainer');
                    const closeFarmerForm = document.getElementById('closeFarmerForm');
                    const cancelFarmerForm = document.getElementById('cancelFarmerForm');
                    const farmerFormTitle = document.getElementById('farmerFormTitle');
                    const exportFarmersBtn = document.getElementById('exportFarmersBtn');

                    function generateFarmerId() {
                        return 'FARM-' + Date.now().toString().slice(-6);
                    }

                    function showAlert(message, type = 'success') {
                        const alert = document.createElement('div');
                        alert.textContent = message;
                        alert.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 4px;
            color: white;
            background-color: ${type === 'success' ? '#2a9d8f' : '#e76f51'};
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        `;
                        document.body.appendChild(alert);
                        setTimeout(() => {
                            alert.style.opacity = '0';
                            setTimeout(() => document.body.removeChild(alert), 300);
                        }, 3000);
                    }

                    function validateFarmerData(data) {
                        if (!data.name || data.name.length < 3) throw new Error('Name must be at least 3 characters');
                        if (!/^\d{10}$/.test(data.phone)) throw new Error('Phone must be 10 digits');
                        if (!/^\d{12}$/.test(data.aadhar)) throw new Error('Aadhar must be 12 digits');
                        return true;
                    }

                    function displayFarmers(page = 1) {
                        currentPage = page;
                        const searchTerm = farmerSearch.value.toLowerCase();

                        const filtered = farmers.filter(farmer =>
                            (farmer.name?.toLowerCase() || '').includes(searchTerm) ||
                            (farmer.phone || '').includes(searchTerm) ||
                            (farmer.village?.toLowerCase() || '').includes(searchTerm) ||
                            (farmer.id?.toLowerCase() || '').includes(searchTerm)
                        );

                        const start = (page - 1) * farmersPerPage;
                        const end = Math.min(start + farmersPerPage, filtered.length);
                        const paginated = filtered.slice(start, end);

                        farmersTableBody.innerHTML = paginated.length
                            ? paginated.map(f => `
                <tr>
                    <td>${f.id}</td>
                    <td>${f.name}</td>
                    <td>${f.phone}</td>
                    <td>${f.village}</td>
                    <td>${f.cattle}</td>
                    <td>${f.milkProduction}</td>
                    <td>${new Date(f.joinDate).toLocaleDateString()}</td>
                    <td><span class="status completed">Active</span></td>
                    <td>
                        <button class="btn-success edit-farmer" data-id="${f.id}"><i class="fas fa-edit"></i></button>
                        <button class="edit-btn delete-farmer" data-id="${f.id}"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `).join('')
                            : '<tr><td colspan="9" style="text-align: center;">No farmers found</td></tr>';

                        farmersPaginationInfo.textContent = `Showing ${start + 1} to ${end} of ${filtered.length} farmers`;
                        prevFarmersPage.disabled = page === 1;
                        nextFarmersPage.disabled = end >= filtered.length;

                        document.querySelectorAll('.edit-farmer').forEach(btn =>
                            btn.addEventListener('click', () => editFarmer(btn.dataset.id))
                        );
                        document.querySelectorAll('.delete-farmer').forEach(btn =>
                            btn.addEventListener('click', () => deleteFarmer(btn.dataset.id))
                        );
                    }

                    function editFarmer(id) {
                        const f = farmers.find(f => f.id === id);
                        if (!f) return;
                        currentFarmerId = id;
                        farmerFormTitle.textContent = 'Edit Farmer Details';
                        farmerFormContainer.style.display = 'block';

                        Object.entries(f).forEach(([key, value]) => {
                            const el = document.getElementById(`farmer${key.charAt(0).toUpperCase() + key.slice(1)}`);
                            if (el) el.value = value;
                        });
                    }

                    function deleteFarmer(id) {
                        if (confirm('Are you sure you want to delete this farmer?')) {
                            farmers = farmers.filter(f => f.id !== id);
                            localStorage.setItem('farmers', JSON.stringify(farmers));
                            displayFarmers(currentPage);
                            showAlert('Farmer deleted successfully');
                        }
                    }

                    farmerForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        const data = {
                            id: currentFarmerId || generateFarmerId(),
                            name: document.getElementById('farmerName').value,
                            age: document.getElementById('farmerAge').value,
                            gender: document.getElementById('farmerGender').value,
                            address: document.getElementById('farmerAddress').value,
                            village: document.getElementById('farmerVillage').value,
                            district: document.getElementById('farmerDistrict').value,
                            state: document.getElementById('farmerState').value,
                            pincode: document.getElementById('farmerPincode').value,
                            phone: document.getElementById('farmerPhone').value,
                            aadhar: document.getElementById('farmerAadhar').value,
                            bankAccount: document.getElementById('farmerBank').value,
                            ifsc: document.getElementById('farmerIfsc').value,
                            cattle: document.getElementById('farmerCattle').value,
                            milkProduction: document.getElementById('farmerMilkProd').value,
                            joinDate: document.getElementById('farmerJoinDate').value
                        };

                        try {
                            validateFarmerData(data);
                            if (currentFarmerId) {
                                const idx = farmers.findIndex(f => f.id === currentFarmerId);
                                farmers[idx] = data;
                                showAlert('Farmer updated successfully');
                            } else {
                                farmers.push(data);
                                showAlert('Farmer registered successfully');
                            }
                            localStorage.setItem('farmers', JSON.stringify(farmers));
                            farmerFormContainer.style.display = 'none';
                            displayFarmers(currentPage);
                        } catch (err) {
                            showAlert(err.message, 'error');
                        }
                    });

                    exportFarmersBtn.addEventListener('click', () => {
                        if (farmers.length === 0) return showAlert('No farmers to export', 'error');

                        const headers = Object.keys(farmers[0]).join(',');
                        const rows = farmers.map(f => Object.values(f).map(val =>
                            typeof val === 'string' ? `"${val.replace(/"/g, '""')}"` : val
                        ).join(',')).join('\n');

                        const blob = new Blob([`${headers}\n${rows}`], { type: 'text/csv;charset=utf-8;' });
                        const url = URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = `farmers_${new Date().toISOString().split('T')[0]}.csv`;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        showAlert('Farmers exported to CSV');
                    });

                    addFarmerBtn.addEventListener('click', () => {
                        currentFarmerId = null;
                        farmerForm.reset();
                        farmerFormTitle.textContent = 'Register New Farmer';
                        document.getElementById('farmerJoinDate').valueAsDate = new Date();
                        farmerFormContainer.style.display = 'block';
                    });

                    closeFarmerForm.addEventListener('click', () => farmerFormContainer.style.display = 'none');
                    cancelFarmerForm.addEventListener('click', () => farmerFormContainer.style.display = 'none');
                    farmerSearch.addEventListener('input', () => displayFarmers(1));
                    prevFarmersPage.addEventListener('click', () => displayFarmers(currentPage - 1));
                    nextFarmersPage.addEventListener('click', () => displayFarmers(currentPage + 1));

                    // Optional: Sample farmers
                    if (farmers.length === 0) {
                        farmers = [
                            {
                                id: generateFarmerId(),
                                name: "Rajesh Patel",
                                age: 42,
                                gender: "Male",
                                address: "123 Dairy Lane, Anand",
                                village: "Anand",
                                district: "Anand",
                                state: "Gujarat",
                                pincode: "388001",
                                phone: "9876543210",
                                aadhar: "123456789012",
                                bankAccount: "12345678901234",
                                ifsc: "ANDB0001234",
                                cattle: 12,
                                milkProduction: 25.5,
                                joinDate: new Date().toISOString().split('T')[0]
                            }
                        ];
                        localStorage.setItem('farmers', JSON.stringify(farmers));
                    }

                    displayFarmers();
                });

            </script>




            <script>
                let salesData = [
                    { id: 1, date: '2025-06-01', product: 'Milk', customer: 'Srinivas', quantity: 20, amount: 600 },
                    { id: 2, date: '2025-06-06', product: 'Butter', customer: 'Lakshmi', quantity: 5, amount: 500 },
                    { id: 3, date: '2025-05-23', product: 'Curd', customer: 'Rakesh', quantity: 15, amount: 375 },
                    { id: 4, date: '2025-06-09', product: 'Milk', customer: 'Ramesh', quantity: 10, amount: 300 },
                    { id: 5, date: '2025-05-12', product: 'Paneer', customer: 'Priya', quantity: 9, amount: 900 },
                    { id: 6, date: '2025-06-14', product: 'Butter', customer: 'Srinivas', quantity: 8, amount: 800 }
                ];
                let editingSaleId = null;

                function renderSalesTable() {
                    const tbody = document.getElementById('sales-tbody');
                    tbody.innerHTML = '';
                    if (salesData.length === 0) {
                        const tr = document.createElement('tr');
                        tr.innerHTML = '<td colspan="6" style="text-align:center;color:#adb5bd;">No sales data found.</td>';
                        tbody.appendChild(tr);
                    } else {
                        salesData.forEach(sale => {
                            const tr = document.createElement('tr');
                            tr.innerHTML = `
                <td>${sale.date}</td>
                <td>${sale.product}</td>
                <td>${sale.customer}</td>
                <td>${sale.quantity}</td>
                <td>₹${sale.amount}</td>
                <td>
                    <button class="btn-success" style="font-size:1rem;" title="Edit" onclick="editSale(${sale.id})"><i class="fa fa-edit"></i></button>
                    <button class="edit-btn" style="font-size:1rem;" title="Delete" onclick="deleteSale(${sale.id})"><i class="fa fa-trash"></i></button>
                </td>
            `;
                            tbody.appendChild(tr);
                        });
                    }
                    updateSalesInfo();
                    updateSalesCharts();
                }

                function updateSalesInfo() {
                    // Total sales amount
                    let total = salesData.reduce((sum, s) => sum + s.amount, 0);
                    document.getElementById('sales-total').textContent = "₹" + total;

                    // Top product (by total sales amount)
                    let productTotals = {};
                    salesData.forEach(s => productTotals[s.product] = (productTotals[s.product] || 0) + s.amount);
                    let topProduct = "-";
                    if (salesData.length) {
                        let maxVal = Math.max(...Object.values(productTotals));
                        let maxProds = Object.entries(productTotals)
                            .filter(([k, v]) => v === maxVal)
                            .map(([k]) => k);
                        topProduct = maxProds.join(', ');
                    }
                    document.getElementById('top-product').textContent = topProduct;

                    // Unique customers
                    let customers = new Set(salesData.map(s => s.customer));
                    document.getElementById('unique-customers').textContent = customers.size;
                }

                // CRUD
                function showAddSaleModal() {
                    editingSaleId = null;
                    document.getElementById('sale-form-title').innerText = 'Add Sale';
                    document.getElementById('sale-form').reset();
                    document.getElementById('sale-id').value = '';
                    document.getElementById('sale-modal').style.display = 'flex';
                }
                function closeSaleModal() {
                    document.getElementById('sale-modal').style.display = 'none';
                }
                function saveSale() {
                    const id = document.getElementById('sale-id').value;
                    const date = document.getElementById('sale-date').value;
                    const product = document.getElementById('sale-product').value.trim();
                    const customer = document.getElementById('sale-customer').value.trim();
                    const quantity = parseInt(document.getElementById('sale-quantity').value, 10);
                    const amount = parseInt(document.getElementById('sale-amount').value, 10);

                    if (!date || !product || !customer || !quantity || !amount) return;

                    if (id) {
                        // Update
                        const idx = salesData.findIndex(m => m.id == id);
                        if (idx > -1) {
                            salesData[idx] = { id: Number(id), date, product, customer, quantity, amount };
                        }
                    } else {
                        // Add
                        const newId = salesData.length ? Math.max(...salesData.map(m => m.id)) + 1 : 1;
                        salesData.push({ id: newId, date, product, customer, quantity, amount });
                    }
                    closeSaleModal();
                    renderSalesTable();
                }
                function editSale(id) {
                    const sale = salesData.find(m => m.id === id);
                    if (sale) {
                        document.getElementById('sale-form-title').innerText = 'Edit Sale';
                        document.getElementById('sale-id').value = sale.id;
                        document.getElementById('sale-date').value = sale.date;
                        document.getElementById('sale-product').value = sale.product;
                        document.getElementById('sale-customer').value = sale.customer;
                        document.getElementById('sale-quantity').value = sale.quantity;
                        document.getElementById('sale-amount').value = sale.amount;
                        document.getElementById('sale-modal').style.display = 'flex';
                    }
                }
                function deleteSale(id) {
                    if (confirm('Are you sure you want to delete this sale?')) {
                        salesData = salesData.filter(m => m.id !== id);
                        renderSalesTable();
                    }
                }

                // Charts
                let salesBarChart, salesPieChart;
                function updateSalesCharts() {
                    // Bar: Monthly sales trend for current year
                    const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                    let monthTotals = Array(12).fill(0);
                    salesData.forEach(s => {
                        let d = new Date(s.date);
                        if (!isNaN(d)) monthTotals[d.getMonth()] += s.amount;
                    });
                    // Pie: Product share
                    let productTotals = {};
                    salesData.forEach(s => productTotals[s.product] = (productTotals[s.product] || 0) + s.amount);

                    // Bar Chart
                    const barCtx = document.getElementById('salesBarChart').getContext('2d');
                    if (salesBarChart) salesBarChart.destroy();
                    salesBarChart = new Chart(barCtx, {
                        type: 'bar',
                        data: {
                            labels: months,
                            datasets: [{
                                label: 'Total Sales (₹)',
                                data: monthTotals,
                                backgroundColor: '#2a9d8f'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } },
                            scales: {
                                y: { beginAtZero: true, ticks: { callback: v => '₹' + v } },
                                x: { ticks: { color: '#2a9d8f' } }
                            }
                        }
                    });

                    // Pie Chart
                    const pieCtx = document.getElementById('salesPieChart').getContext('2d');
                    if (salesPieChart) salesPieChart.destroy();
                    salesPieChart = new Chart(pieCtx, {
                        type: 'pie',
                        data: {
                            labels: Object.keys(productTotals),
                            datasets: [{
                                data: Object.values(productTotals),
                                backgroundColor: ['#0077b6', '#e76f51', '#e9c46a', '#2a9d8f', '#caf0f8', '#adb5bd']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: true, position: 'bottom' } }
                        }
                    });
                }

                // Modal close on background click
                document.addEventListener('DOMContentLoaded', function () {
                    renderSalesTable();
                    document.getElementById('sale-modal').addEventListener('click', function (e) {
                        if (e.target === this) closeSaleModal();
                    });
                });
            </script>

            <script>
                const $F = id => document.getElementById(id);
                let finBarChart, finPieChart;

                function getFinData() {
                    const stored = localStorage.getItem("financialReports");
                    let data;
                    try {
                        data = JSON.parse(stored);
                    } catch (e) {
                        data = [];
                    }
                    return Array.isArray(data) ? data : [];
                }
                function setFinData(data) {
                    localStorage.setItem("financialReports", JSON.stringify(data));
                }

                function handleFinancialSubmit(e) {
                    e.preventDefault();
                    const entry = {
                        date: $F("fin-date").value,
                        category: $F("fin-category").value,
                        type: $F("fin-type").value,
                        amount: parseFloat($F("fin-amount").value),
                        desc: $F("fin-desc").value.trim(),
                        ref: $F("fin-ref").value.trim()
                    };
                    let data = getFinData();
                    const idx = $F("fin-edit-index").value;
                    if (idx === "") data.push(entry);
                    else data[parseInt(idx)] = entry;
                    setFinData(data);
                    resetFinForm();
                    renderFinTable();
                    renderFinSummary();
                    renderFinCharts();
                }

                function resetFinForm() {
                    $F("fin-form").reset();
                    $F("fin-edit-index").value = "";
                    $F("fin-submit-btn").textContent = "Add";
                    $F("fin-cancel-btn").style.display = "none";
                }

                function editFinEntry(i) {
                    const e = getFinData()[i];
                    $F("fin-edit-index").value = i;
                    $F("fin-date").value = e.date;
                    $F("fin-category").value = e.category;
                    $F("fin-type").value = e.type;
                    $F("fin-amount").value = e.amount;
                    $F("fin-desc").value = e.desc;
                    $F("fin-ref").value = e.ref;
                    $F("fin-submit-btn").textContent = "Update";
                    $F("fin-cancel-btn").style.display = "inline-block";
                }

                function deleteFinEntry(i) {
                    if (confirm("Delete this entry?")) {
                        const data = getFinData();
                        data.splice(i, 1);
                        setFinData(data);
                        renderFinTable();
                        renderFinSummary();
                        renderFinCharts();
                    }
                }

                function renderFinTable() {
                    const data = getFinData();
                    const tbody = $F("fin-table").querySelector("tbody");
                    tbody.innerHTML = "";
                    data.forEach((e, i) => {
                        const tr = document.createElement("tr");
                        tr.innerHTML = `
      <td>${e.date}</td><td>${e.category}</td><td>${e.desc}</td>
      <td>${e.type}</td><td>₹${e.amount.toFixed(2)}</td><td>${e.ref}</td>
      <td>
        <button class='edit-btn' onclick='editFinEntry(${i})'>Edit</button>
        <button class='btn-primary' onclick='deleteFinEntry(${i})'>Delete</button>
      </td>`;
                        tbody.appendChild(tr);
                    });
                }

                function renderFinSummary() {
                    const data = getFinData();
                    const income = data.filter(e => e.category === "Income").reduce((sum, e) => sum + e.amount, 0);
                    const expense = data.filter(e => e.category === "Expense").reduce((sum, e) => sum + e.amount, 0);
                    $F("fin-total-income").textContent = `₹${income.toFixed(2)}`;
                    $F("fin-total-expense").textContent = `₹${expense.toFixed(2)}`;
                    $F("fin-net-profit").textContent = `₹${(income - expense).toFixed(2)}`;
                }

                function renderFinCharts() {
                    const canvasBar = $F("fin-bar-chart");
                    const canvasPie = $F("fin-pie-chart");

                    // Fix 1: Clear chart container size artifacts
                    canvasBar.width = canvasBar.offsetWidth;
                    canvasBar.height = canvasBar.offsetHeight;
                    canvasPie.width = canvasPie.offsetWidth;
                    canvasPie.height = canvasPie.offsetHeight;

                    const ctxBar = canvasBar.getContext("2d");
                    const ctxPie = canvasPie.getContext("2d");
                    const data = getFinData();
                    const labels = [], incomeData = [], expenseData = [];

                    for (let i = 11; i >= 0; i--) {
                        const d = new Date();
                        d.setMonth(d.getMonth() - i);
                        const label = d.toLocaleString('default', { month: 'short', year: '2-digit' });
                        const ym = d.toISOString().slice(0, 7);
                        labels.push(label);
                        incomeData.push(data.filter(e => e.category === "Income" && e.date.startsWith(ym)).reduce((a, e) => a + e.amount, 0));
                        expenseData.push(data.filter(e => e.category === "Expense" && e.date.startsWith(ym)).reduce((a, e) => a + e.amount, 0));
                    }

                    if (finBarChart) finBarChart.destroy();
                    finBarChart = new Chart(ctxBar, {
                        type: 'bar',
                        data: {
                            labels,
                            datasets: [
                                { label: 'Income', data: incomeData, backgroundColor: '#4caf50' },
                                { label: 'Expense', data: expenseData, backgroundColor: '#f44336' }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            animation: false
                        }
                    });

                    const pieMap = {};
                    data.filter(e => e.category === "Expense").forEach(e => {
                        const key = e.desc.split(' ')[0];
                        pieMap[key] = (pieMap[key] || 0) + e.amount;
                    });

                    const pieLabels = Object.keys(pieMap);
                    const pieValues = Object.values(pieMap);

                    if (finPieChart) finPieChart.destroy();
                    finPieChart = new Chart(ctxPie, {
                        type: 'pie',
                        data: {
                            labels: pieLabels.length ? pieLabels : ["No Data"],
                            datasets: [{
                                data: pieValues.length ? pieValues : [1],
                                backgroundColor: ["#2196f3", "#ff9800", "#9c27b0", "#3f51b5", "#00bcd4"]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            animation: false
                        }
                    });

                    // Extra: Trigger one more forced resize
                    requestAnimationFrame(() => {
                        finBarChart.resize();
                        finPieChart.resize();
                    });
                }


                function exportFinancialPDF() {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    const data = getFinData();
                    const rows = data.map(e => [e.date, e.category, e.desc, e.type, e.amount.toFixed(2), e.ref]);
                    doc.autoTable({ head: [['Date', 'Category', 'Description', 'Type', 'Amount', 'Ref']], body: rows });
                    doc.save("Financial_Report.pdf");
                }

                function exportFinancialCSV() {
                    const data = getFinData();
                    let csv = "Date,Category,Description,Type,Amount,Ref\n";
                    data.forEach(e => {
                        csv += `${e.date},${e.category},"${e.desc}",${e.type},${e.amount},${e.ref}\n`;
                    });
                    const blob = new Blob([csv], { type: "text/csv" });
                    const a = document.createElement("a");
                    a.href = URL.createObjectURL(blob);
                    a.download = "Financial_Report.csv";
                    a.click();
                    URL.revokeObjectURL(a.href);
                }

                // Initialize with dummy data if empty
                if (!localStorage.getItem("financialReports")) {
                    setFinData([
                        { date: "2025-06-01", category: "Income", type: "Bank", amount: 12000, desc: "Milk Sales", ref: "INV001" },
                        { date: "2025-06-03", category: "Expense", type: "Cash", amount: 4000, desc: "Feed Purchase", ref: "EXP001" },
                        { date: "2025-06-05", category: "Income", type: "Cash", amount: 8000, desc: "Butter Sales", ref: "INV002" },
                        { date: "2025-06-07", category: "Expense", type: "Bank", amount: 2000, desc: "Veterinary Care", ref: "EXP002" },
                        { date: "2025-06-10", category: "Expense", type: "Cash", amount: 1500, desc: "Fuel Cost", ref: "EXP003" },
                        { date: "2025-06-12", category: "Income", type: "Bank", amount: 5000, desc: "Cheese Orders", ref: "INV003" }
                    ]);
                }

                window.addEventListener("DOMContentLoaded", () => {
                    renderFinTable();
                    renderFinSummary();
                    renderFinCharts();
                });
            </script>


            <script>
                // Full Retail Management Functionality

                let retailData = JSON.parse(localStorage.getItem('retailData')) || [
                    { id: "1", name: "Daily Mart", city: "Hyderabad", owner: "A. Kumar", contact: "9876543210", email: "dailymart@retail.com", category: "Supermarket", status: "active" },
                    { id: "2", name: "City Store", city: "Mumbai", owner: "P. Singh", contact: "9123456780", email: "citystore@retail.com", category: "Franchise", status: "inactive" },
                    { id: "3", name: "Fresh Pick", city: "Bangalore", owner: "R. Menon", contact: "9988776655", email: "freshpick@retail.com", category: "Convenience", status: "pending" },
                    { id: "4", name: "Value Bazaar", city: "Delhi", owner: "S. Kaur", contact: "9001122334", email: "valuebazaar@retail.com", category: "Department", status: "closed" }
                ];
                let editRetailId = null;
                const retailForm = document.getElementById('retailForm');
                const retailFormContainer = document.getElementById('retailFormContainer');
                const retailTableBody = document.getElementById('retailTableBody');
                const retailSummaryBody = document.getElementById('retailSummaryBody');
                const retailSearch = document.getElementById('retailSearch');
                const retailFilter = document.getElementById('retailFilter');

                function saveRetailData() {
                    localStorage.setItem('retailData', JSON.stringify(retailData));
                    renderRetailTable();
                    renderRetailSummary();
                    renderRetailCharts();
                }

                function renderRetailTable() {
                    const filter = retailFilter.value;
                    const search = retailSearch.value.toLowerCase();
                    const filtered = retailData.filter(entry => {
                        return (filter === 'all' || entry.status === filter) &&
                            (entry.name.toLowerCase().includes(search) ||
                                entry.city.toLowerCase().includes(search) ||
                                entry.owner.toLowerCase().includes(search));
                    });

                    retailTableBody.innerHTML = filtered.map(entry => `
            <tr>
                <td>${entry.name}</td>
                <td>${entry.city}</td>
                <td>${entry.owner}</td>
                <td>${entry.contact}</td>
                <td>${entry.email}</td>
                <td>${entry.category}</td>
                <td>${entry.status}</td>
                <td>
                    <button class="btn-success" onclick="editRetailEntry('${entry.id}')"><i class="fas fa-edit"></i></button>
                    <button class="btn-primary" onclick="deleteRetailEntry('${entry.id}')"><i class="fas fa-trash"></i></button>
                </td>
            </tr>`).join('');
                }

                function renderRetailSummary() {
                    const summary = {};
                    for (const entry of retailData) {
                        const cat = entry.category;
                        if (!summary[cat]) {
                            summary[cat] = { total: 0, active: 0, inactive: 0, pending: 0, closed: 0 };
                        }
                        summary[cat].total++;
                        summary[cat][entry.status]++;
                    }

                    retailSummaryBody.innerHTML = Object.entries(summary).map(([cat, counts]) => `
            <tr>
                <td>${cat}</td>
                <td>${counts.total}</td>
                <td>${counts.active || 0}</td>
                <td>${counts.inactive || 0}</td>
                <td>${counts.pending || 0}</td>
                <td>${counts.closed || 0}</td>
            </tr>`).join('');
                }

                function renderRetailCharts() {
                    const statusCanvas = document.getElementById('retailBarChart');
                    const typeCanvas = document.getElementById('retailPieChart');
                    const cityCanvas = document.getElementById('retailCityChart');

                    if (!statusCanvas || !typeCanvas || !cityCanvas) return;

                    const ctxStatus = statusCanvas.getContext('2d');
                    const ctxType = typeCanvas.getContext('2d');
                    const ctxCity = cityCanvas.getContext('2d');

                    const statuses = { active: 0, inactive: 0, pending: 0, closed: 0 };
                    const categories = {};
                    const cities = {};

                    for (const entry of retailData) {
                        statuses[entry.status]++;
                        categories[entry.category] = (categories[entry.category] || 0) + 1;
                        cities[entry.city] = (cities[entry.city] || 0) + 1;
                    }

                    if (window.statusChart) window.statusChart.destroy();
                    window.statusChart = new Chart(ctxStatus, {
                        type: 'bar',
                        data: {
                            labels: Object.keys(statuses),
                            datasets: [{
                                label: 'Outlets by Status',
                                data: Object.values(statuses),
                                backgroundColor: ['#28a745', '#6c757d', '#ffc107', '#dc3545']
                            }]
                        }
                    });

                    if (window.typeChart) window.typeChart.destroy();
                    window.typeChart = new Chart(ctxType, {
                        type: 'pie',
                        data: {
                            labels: Object.keys(categories),
                            datasets: [{
                                data: Object.values(categories),
                                backgroundColor: ['#007bff', '#6610f2', '#17a2b8', '#fd7e14', '#20c997']
                            }]
                        }
                    });

                    if (window.cityChart) window.cityChart.destroy();
                    window.cityChart = new Chart(ctxCity, {
                        type: 'bar',
                        data: {
                            labels: Object.keys(cities),
                            datasets: [{
                                label: 'Outlets by City',
                                data: Object.values(cities),
                                backgroundColor: '#6f42c1'
                            }]
                        }
                    });
                }

                function editRetailEntry(id) {
                    const entry = retailData.find(e => e.id === id);
                    if (!entry) return;
                    editRetailId = id;
                    document.getElementById('retailName').value = entry.name;
                    document.getElementById('retailCity').value = entry.city;
                    document.getElementById('retailOwner').value = entry.owner;
                    document.getElementById('retailPhone').value = entry.contact;
                    document.getElementById('retailEmail').value = entry.email;
                    document.getElementById('retailCategory').value = entry.category;
                    document.getElementById('retailStatus').value = entry.status;
                    retailFormContainer.style.display = 'block';
                }

                function deleteRetailEntry(id) {
                    if (confirm('Delete this retail entry?')) {
                        retailData = retailData.filter(e => e.id !== id);
                        saveRetailData();
                    }
                }

                retailForm.addEventListener('submit', e => {
                    e.preventDefault();
                    const newEntry = {
                        id: editRetailId || Date.now().toString(),
                        name: document.getElementById('retailName').value,
                        city: document.getElementById('retailCity').value,
                        owner: document.getElementById('retailOwner').value,
                        contact: document.getElementById('retailPhone').value,
                        email: document.getElementById('retailEmail').value,
                        category: document.getElementById('retailCategory').value,
                        status: document.getElementById('retailStatus').value
                    };

                    if (editRetailId) {
                        const index = retailData.findIndex(e => e.id === editRetailId);
                        if (index !== -1) retailData[index] = newEntry;
                    } else {
                        retailData.push(newEntry);
                    }
                    editRetailId = null;
                    retailForm.reset();
                    retailFormContainer.style.display = 'none';
                    saveRetailData();
                });

                document.getElementById('addRetailBtn').addEventListener('click', () => {
                    editRetailId = null;
                    retailForm.reset();
                    retailFormContainer.style.display = 'block';
                });
                document.getElementById('closeRetailForm').addEventListener('click', () => retailFormContainer.style.display = 'none');
                document.getElementById('cancelRetailForm').addEventListener('click', () => retailFormContainer.style.display = 'none');
                retailSearch.addEventListener('input', renderRetailTable);
                retailFilter.addEventListener('change', renderRetailTable);

                // CSV Export
                function exportRetailDataToCSV() {
                    const data = JSON.parse(localStorage.getItem('retailData')) || [];
                    if (data.length === 0) {
                        alert("No retail data to export.");
                        return;
                    }

                    const headers = ["Retail Name", "City", "Owner", "Contact", "Email", "Category", "Status"];
                    const csvRows = [headers.join(",")];

                    data.forEach(entry => {
                        const row = [
                            entry.name,
                            entry.city,
                            entry.owner,
                            entry.contact,
                            entry.email,
                            entry.category,
                            entry.status
                        ].map(val => `"${val}"`).join(",");
                        csvRows.push(row);
                    });

                    const csvString = csvRows.join("\n");
                    const blob = new Blob([csvString], { type: "text/csv;charset=utf-8;" });
                    const url = URL.createObjectURL(blob);

                    const link = document.createElement("a");
                    link.setAttribute("href", url);
                    link.setAttribute("download", `retail_data_${new Date().toISOString().slice(0, 10)}.csv`);
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }

                // Initialize everything AFTER DOM is fully loaded
                document.addEventListener('DOMContentLoaded', function () {
                    renderRetailTable();
                    renderRetailSummary();
                    renderRetailCharts();

                    const exportBtn = document.getElementById('exportRetailCSV');
                    if (exportBtn) {
                        exportBtn.addEventListener('click', exportRetailDataToCSV);
                    }
                });

                // Expose functions globally for inline onclicks
                window.editRetailEntry = editRetailEntry;
                window.deleteRetailEntry = deleteRetailEntry;
            </script>






            <script>
                // Payments Section JavaScript (with working Edit Payment, Cancel, Close, and Chart rendering)
                // This version ensures modal close, update, and cancel work by using IDs—not inline onclick—and attaches event listeners after DOMContentLoaded.

                function initializeSamplePayments() {
                    if (!localStorage.getItem('payments')) {
                        const samplePayments = [
                            {
                                id: 'PAY-1001',
                                date: '2023-06-15',
                                recipientType: 'farmer',
                                recipient: 'Rajesh Patel (F-10045)',
                                amount: 12500,
                                method: 'bank_transfer',
                                reference: 'INV-2023-06-15',
                                status: 'completed',
                                createdAt: '2023-06-15T10:30:00Z'
                            },
                            {
                                id: 'PAY-1002',
                                date: '2023-06-14',
                                recipientType: 'supplier',
                                recipient: 'Milk Packaging Inc.',
                                amount: 18500,
                                method: 'credit',
                                reference: 'INV-SUP-0614',
                                status: 'completed',
                                createdAt: '2023-06-14T14:15:00Z'
                            },
                            {
                                id: 'PAY-1003',
                                date: '2025-06-10',
                                recipientType: 'employee',
                                recipient: 'Sunil Sharma (EMP-1003)',
                                amount: 25000,
                                method: 'bank_transfer',
                                reference: 'SAL-JUN-1003',
                                status: 'completed',
                                createdAt: '2025-06-10T09:00:00Z'
                            },
                            {
                                id: 'PAY-1004',
                                date: '2023-06-08',
                                recipientType: 'farmer',
                                recipient: 'Priya Sharma (F-10044)',
                                amount: 9800,
                                method: 'upi',
                                reference: 'INV-2023-06-08',
                                status: 'completed',
                                createdAt: '2023-06-08T11:45:00Z'
                            },
                            {
                                id: 'PAY-1005',
                                date: '2023-06-05',
                                recipientType: 'supplier',
                                recipient: 'Dairy Equipment Co.',
                                amount: 42500,
                                method: 'bank_transfer',
                                reference: 'INV-EQP-0605',
                                status: 'completed',
                                createdAt: '2023-06-05T16:20:00Z'
                            },
                            {
                                id: 'PAY-1006',
                                date: '2023-06-16',
                                recipientType: 'farmer',
                                recipient: 'Vijay Singh (F-10043)',
                                amount: 15200,
                                method: 'cash',
                                reference: '',
                                status: 'pending',
                                createdAt: '2023-06-16T09:30:00Z'
                            },
                            {
                                id: 'PAY-1007',
                                date: '2023-06-12',
                                recipientType: 'other',
                                recipient: 'Office Maintenance',
                                amount: 7500,
                                method: 'cash',
                                reference: 'MAINT-JUN',
                                status: 'completed',
                                createdAt: '2023-06-12T13:10:00Z'
                            }
                        ];
                        localStorage.setItem('payments', JSON.stringify(samplePayments));
                    }
                }
                initializeSamplePayments();

                document.addEventListener('DOMContentLoaded', function () {
                    let payments = JSON.parse(localStorage.getItem('payments')) || [];
                    let currentPage = 1;
                    const itemsPerPage = 5;

                    // DOM elements
                    const paymentsTableBody = document.getElementById('paymentsTableBody');
                    const paymentForm = document.getElementById('paymentForm');
                    const addPaymentForm = document.getElementById('addPaymentForm');
                    const addPaymentBtn = document.getElementById('addPaymentBtn');
                    const closePaymentForm = document.getElementById('closePaymentForm');
                    const cancelPaymentForm = document.getElementById('cancelPaymentForm');
                    const editPaymentModal = document.getElementById('editPaymentModal');
                    const editPaymentForm = document.getElementById('editPaymentForm');
                    const paymentSearch = document.getElementById('paymentSearch');
                    const paymentFilter = document.getElementById('paymentFilter');
                    const paymentDateFilter = document.getElementById('paymentDateFilter');
                    const applyFiltersBtn = document.getElementById('applyFiltersBtn');
                    const resetFiltersBtn = document.getElementById('resetFiltersBtn');
                    const prevPaymentPage = document.getElementById('prevPaymentPage');
                    const nextPaymentPage = document.getElementById('nextPaymentPage');
                    const paymentPaginationInfo = document.getElementById('paymentPaginationInfo');
                    const totalPaymentsValue = document.getElementById('totalPaymentsValue');
                    const pendingPaymentsValue = document.getElementById('pendingPaymentsValue');
                    const avgPaymentValue = document.getElementById('avgPaymentValue');
                    const paymentChange = document.getElementById('paymentChange');
                    const pendingChange = document.getElementById('pendingChange');
                    const avgPaymentChange = document.getElementById('avgPaymentChange');

                    // Chart canvases
                    const totalPaymentsChartCanvas = document.getElementById('totalPaymentsChart');
                    const pendingPaymentsChartCanvas = document.getElementById('pendingPaymentsChart');
                    const avgPaymentChartCanvas = document.getElementById('avgPaymentChart');
                    const paymentTrendChartCanvas = document.getElementById('paymentTrendChart');

                    // Chart.js instances
                    let totalPaymentsChart, pendingPaymentsChart, avgPaymentChart, paymentTrendChart;

                    initPaymentCharts();

                    // Load initial data and stats
                    loadPayments();
                    updatePaymentStats();

                    // Event listeners
                    if (addPaymentBtn) addPaymentBtn.addEventListener('click', showAddPaymentForm);
                    if (closePaymentForm) closePaymentForm.addEventListener('click', hideAddPaymentForm);
                    if (cancelPaymentForm) cancelPaymentForm.addEventListener('click', hideAddPaymentForm);
                    if (paymentForm) paymentForm.addEventListener('submit', savePayment);
                    if (paymentSearch) paymentSearch.addEventListener('input', filterPayments);
                    if (paymentFilter) paymentFilter.addEventListener('change', filterPayments);
                    if (paymentDateFilter) paymentDateFilter.addEventListener('change', filterPayments);
                    if (applyFiltersBtn) applyFiltersBtn.addEventListener('click', filterPayments);
                    if (resetFiltersBtn) resetFiltersBtn.addEventListener('click', resetFilters);
                    if (prevPaymentPage) prevPaymentPage.addEventListener('click', goToPrevPage);
                    if (nextPaymentPage) nextPaymentPage.addEventListener('click', goToNextPage);

                    // Edit modal close (X) button
                    const closeEditBtn = document.getElementById('closeEditPaymentModal');
                    if (closeEditBtn) {
                        closeEditBtn.addEventListener('click', function () {
                            editPaymentModal.style.display = 'none';
                        });
                    }

                    // Edit modal cancel button
                    const cancelEditBtn = document.getElementById('cancelEditPaymentBtn');
                    if (cancelEditBtn) {
                        cancelEditBtn.addEventListener('click', function () {
                            editPaymentModal.style.display = 'none';
                        });
                    }



                    // Edit Payment Form Submit
                    if (editPaymentForm) {
                        editPaymentForm.addEventListener('submit', function (e) {
                            e.preventDefault();
                            const paymentId = document.getElementById('editPaymentId').value;
                            const paymentIndex = payments.findIndex(p => p.id === paymentId);
                            if (paymentIndex === -1) return;
                            payments[paymentIndex] = {
                                ...payments[paymentIndex],
                                date: document.getElementById('editPaymentDate').value,
                                recipientType: document.getElementById('editPaymentRecipient').value,
                                recipient: document.getElementById('editPaymentRecipientId').value,
                                amount: parseFloat(document.getElementById('editPaymentAmount').value),
                                method: document.getElementById('editPaymentMethod').value,
                                reference: document.getElementById('editPaymentReference').value,
                                status: document.getElementById('editPaymentStatus').value,
                                updatedAt: new Date().toISOString()
                            };
                            saveToLocalStorage();
                            loadPayments();
                            updatePaymentStats();
                            updatePaymentCharts(payments);
                            editPaymentModal.style.display = 'none';
                            alert('Payment updated successfully!');
                        });
                    }

                    // Actions (View/Edit/Delete) - event delegation
                    if (paymentsTableBody) {
                        paymentsTableBody.addEventListener('click', function (e) {
                            const row = e.target.closest('tr');
                            if (!row) return;
                            const paymentId = row.children[0].textContent;
                            if (e.target.classList.contains('btn-primary')) viewPaymentDetails(paymentId);
                            if (e.target.classList.contains('btn-success')) editPayment(paymentId);
                            if (e.target.classList.contains('btn-danger')) deletePayment(paymentId);
                        });
                    }

                    function loadPayments(filteredData = null) {
                        const dataToDisplay = filteredData || payments;
                        const startIndex = (currentPage - 1) * itemsPerPage;
                        const endIndex = startIndex + itemsPerPage;
                        const paginatedData = dataToDisplay.slice(startIndex, endIndex);

                        paymentsTableBody.innerHTML = '';
                        if (paginatedData.length === 0) {
                            paymentsTableBody.innerHTML = '<tr><td colspan="8" style="text-align: center;">No payments found</td></tr>';
                            return;
                        }

                        paginatedData.forEach(payment => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                <td>${payment.id}</td>
                <td>${payment.date}<br>${formatDate(payment.date)}</td>
                <td>${payment.recipient}</td>
                <td>₹${Number(payment.amount).toFixed(2)}</td>
                <td>${formatMethod(payment.method)}</td>
                <td>${payment.reference || '-'}</td>
                <td><span class="status ${getStatusClass(payment.status)}">${formatStatus(payment.status)}</span></td>
                <td class="actions-cell">
                    <button class="btn-primary">View</button>
                    <button class="btn-success" style="margin-left: 5px;">Edit</button>
                    <button class="delete-btn" style="margin-left: 5px;">Delete</button>
                </td>
            `;
                            paymentsTableBody.appendChild(row);
                        });

                        updatePaginationInfo(dataToDisplay.length);
                        updatePaymentCharts(dataToDisplay);
                    }

                    function formatDate(dateString) {
                        const options = { year: 'numeric', month: 'short', day: 'numeric' };
                        return new Date(dateString).toLocaleDateString('en-US', options);
                    }

                    function formatMethod(method) {
                        const methods = {
                            'cash': 'Cash',
                            'bank_transfer': 'Bank Transfer',
                            'credit': 'Credit Card',
                            'upi': 'UPI',
                            'other': 'Other'
                        };
                        return methods[method] || method;
                    }

                    function formatStatus(status) {
                        const statuses = {
                            'completed': 'Paid',
                            'pending': 'Pending',
                            'failed': 'Failed'
                        };
                        return statuses[status] || status;
                    }

                    function getStatusClass(status) {
                        const classes = {
                            'completed': 'completed',
                            'pending': 'pending',
                            'failed': 'pending'
                        };
                        return classes[status] || '';
                    }

                    function updatePaginationInfo(totalItems) {
                        const startItem = ((currentPage - 1) * itemsPerPage) + 1;
                        const endItem = Math.min(currentPage * itemsPerPage, totalItems);
                        paymentPaginationInfo.textContent = `Showing ${startItem} to ${endItem} of ${totalItems} payments`;
                        prevPaymentPage.disabled = currentPage === 1;
                        nextPaymentPage.disabled = currentPage * itemsPerPage >= totalItems;
                    }

                    function goToPrevPage() {
                        if (currentPage > 1) {
                            currentPage--;
                            loadPayments();
                        }
                    }

                    function goToNextPage() {
                        if (currentPage * itemsPerPage < payments.length) {
                            currentPage++;
                            loadPayments();
                        }
                    }

                    function showAddPaymentForm() {
                        addPaymentForm.style.display = 'block';
                        addPaymentBtn.style.display = 'none';
                        paymentForm.reset();
                        document.getElementById('paymentDate').valueAsDate = new Date();
                    }

                    function hideAddPaymentForm() {
                        addPaymentForm.style.display = 'none';
                        addPaymentBtn.style.display = 'inline-block';
                    }

                    function savePayment(e) {
                        e.preventDefault();
                        const paymentId = 'PAY-' + Date.now().toString().slice(-6);
                        const paymentDate = document.getElementById('paymentDate').value;
                        const paymentRecipient = document.getElementById('paymentRecipient').value;
                        const paymentRecipientId = document.getElementById('paymentRecipientId').value;
                        const paymentAmount = parseFloat(document.getElementById('paymentAmount').value);
                        const paymentMethod = document.getElementById('paymentMethod').value;
                        const paymentReference = document.getElementById('paymentReference').value;
                        const paymentStatus = document.getElementById('paymentStatus').value;

                        const newPayment = {
                            id: paymentId,
                            date: paymentDate,
                            recipientType: paymentRecipient,
                            recipient: paymentRecipientId,
                            amount: paymentAmount,
                            method: paymentMethod,
                            reference: paymentReference,
                            status: paymentStatus,
                            createdAt: new Date().toISOString()
                        };

                        payments.unshift(newPayment);
                        saveToLocalStorage();
                        loadPayments();
                        updatePaymentStats();
                        updatePaymentCharts(payments);
                        hideAddPaymentForm();
                        alert('Payment saved successfully!');
                    }

                    function editPayment(paymentId) {
                        const payment = payments.find(p => p.id === paymentId);
                        if (!payment) return;
                        document.getElementById('editPaymentId').value = payment.id;
                        document.getElementById('editPaymentDate').value = payment.date;
                        document.getElementById('editPaymentRecipient').value = payment.recipientType;
                        document.getElementById('editPaymentRecipientId').value = payment.recipient;
                        document.getElementById('editPaymentAmount').value = payment.amount;
                        document.getElementById('editPaymentMethod').value = payment.method;
                        document.getElementById('editPaymentReference').value = payment.reference;
                        document.getElementById('editPaymentStatus').value = payment.status;
                        editPaymentModal.style.display = 'flex';
                    }

                    function deletePayment(paymentId) {
                        if (confirm('Are you sure you want to delete this payment?')) {
                            payments = payments.filter(p => p.id !== paymentId);
                            saveToLocalStorage();
                            loadPayments();
                            updatePaymentStats();
                            updatePaymentCharts(payments);
                            alert('Payment deleted successfully!');
                        }
                    }

                    function viewPaymentDetails(paymentId) {
                        const payment = payments.find(p => p.id === paymentId);
                        if (!payment) return;
                        alert(`Payment Details:\n
ID: ${payment.id}
Date: ${formatDate(payment.date)}
Recipient: ${payment.recipient} (${payment.recipientType})
Amount: ₹${Number(payment.amount).toFixed(2)}
Method: ${formatMethod(payment.method)}
Status: ${formatStatus(payment.status)}
Reference: ${payment.reference || 'N/A'}`);
                    }

                    function filterPayments() {
                        const searchTerm = paymentSearch.value.toLowerCase();
                        const statusFilter = paymentFilter.value;
                        const dateFilter = paymentDateFilter.value;

                        let filtered = payments;

                        if (searchTerm) {
                            filtered = filtered.filter(payment =>
                                payment.id.toLowerCase().includes(searchTerm) ||
                                payment.recipient.toLowerCase().includes(searchTerm) ||
                                (payment.reference && payment.reference.toLowerCase().includes(searchTerm)) ||
                                payment.amount.toString().includes(searchTerm)
                            );
                        }

                        if (statusFilter !== 'all') {
                            filtered = filtered.filter(payment => payment.status === statusFilter);
                        }

                        if (dateFilter) {
                            filtered = filtered.filter(payment => payment.date === dateFilter);
                        }

                        currentPage = 1;
                        loadPayments(filtered);
                        updatePaymentCharts(filtered);
                    }

                    function resetFilters() {
                        paymentSearch.value = '';
                        paymentFilter.value = 'all';
                        paymentDateFilter.value = '';
                        currentPage = 1;
                        loadPayments();
                        updatePaymentCharts(payments);
                    }

                    function saveToLocalStorage() {
                        localStorage.setItem('payments', JSON.stringify(payments));
                    }

                    function updatePaymentStats() {
                        const totalAmount = payments.reduce((sum, payment) => sum + Number(payment.amount), 0);
                        totalPaymentsValue.textContent = `₹${totalAmount.toFixed(2)}`;

                        const pendingPayments = payments.filter(p => p.status === 'pending');
                        const pendingAmount = pendingPayments.reduce((sum, payment) => sum + Number(payment.amount), 0);
                        pendingPaymentsValue.textContent = `₹${pendingAmount.toFixed(2)}`;

                        const avgPayment = payments.length > 0 ? totalAmount / payments.length : 0;
                        avgPaymentValue.textContent = `₹${avgPayment.toFixed(2)}`;

                        paymentChange.textContent = payments.length > 0 ? '5.7%' : '0%';
                        pendingChange.textContent = pendingPayments.length > 0 ? pendingPayments.length : '0';
                        avgPaymentChange.textContent = payments.length > 0 ? '2.3%' : '0%';
                    }



                    // --- Chart Rendering ---
                    function initPaymentCharts() {
                        if (window.Chart && totalPaymentsChartCanvas && pendingPaymentsChartCanvas && avgPaymentChartCanvas && paymentTrendChartCanvas) {
                            totalPaymentsChart = new Chart(totalPaymentsChartCanvas.getContext('2d'), {
                                type: 'line',
                                data: {
                                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                                    datasets: [{
                                        label: 'Total Payments',
                                        data: [],
                                        borderColor: '#0077b6',
                                        tension: 0.1,
                                        fill: true,
                                        backgroundColor: 'rgba(0, 119, 182, 0.1)'
                                    }]
                                },
                                options: getChartOptions('Total Payments Trend')
                            });

                            pendingPaymentsChart = new Chart(pendingPaymentsChartCanvas.getContext('2d'), {
                                type: 'bar',
                                data: {
                                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                                    datasets: [{
                                        label: 'Pending Payments',
                                        data: [],
                                        backgroundColor: '#e76f51'
                                    }]
                                },
                                options: getChartOptions('Pending Payments')
                            });

                            avgPaymentChart = new Chart(avgPaymentChartCanvas.getContext('2d'), {
                                type: 'line',
                                data: {
                                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                                    datasets: [{
                                        label: 'Average Payment',
                                        data: [],
                                        borderColor: '#2a9d8f',
                                        tension: 0.1,
                                        fill: true,
                                        backgroundColor: 'rgba(42, 157, 143, 0.1)'
                                    }]
                                },
                                options: getChartOptions('Average Payment Amount')
                            });

                            paymentTrendChart = new Chart(paymentTrendChartCanvas.getContext('2d'), {
                                type: 'bar',
                                data: {
                                    labels: ['Completed', 'Pending', 'Failed'],
                                    datasets: [{
                                        label: 'Payment Status',
                                        data: [],
                                        backgroundColor: [
                                            'rgba(42, 157, 143, 0.7)',
                                            'rgba(231, 111, 81, 0.7)',
                                            'rgba(173, 181, 189, 0.7)'
                                        ]
                                    }]
                                },
                                options: getChartOptions('Payment Status Distribution')
                            });
                        }
                    }

                    function updatePaymentCharts(data) {
                        if (!totalPaymentsChart) return;
                        const baseValue = data.length > 0 ? data.length * 1000 : 1000;
                        totalPaymentsChart.data.datasets[0].data = [
                            baseValue * 0.8,
                            baseValue * 0.9,
                            baseValue * 1.1,
                            baseValue * 1.3,
                            baseValue * 1.2,
                            baseValue * 1.4
                        ];
                        totalPaymentsChart.update();

                        const pendingCount = data.filter(p => p.status === 'pending').length;
                        pendingPaymentsChart.data.datasets[0].data = [
                            pendingCount * 0.7,
                            pendingCount * 0.9,
                            pendingCount * 1.2,
                            pendingCount * 1.0,
                            pendingCount * 0.8,
                            pendingCount
                        ];
                        pendingPaymentsChart.update();

                        const avgPayment = data.length > 0 ?
                            data.reduce((sum, p) => sum + Number(p.amount), 0) / data.length : 0;
                        avgPaymentChart.data.datasets[0].data = [
                            avgPayment * 0.9,
                            avgPayment * 0.95,
                            avgPayment * 1.05,
                            avgPayment * 1.1,
                            avgPayment * 1.0,
                            avgPayment
                        ];
                        avgPaymentChart.update();

                        const completedCount = data.filter(p => p.status === 'completed').length;
                        const failedCount = data.filter(p => p.status === 'failed').length;
                        paymentTrendChart.data.datasets[0].data = [
                            completedCount,
                            pendingCount,
                            failedCount
                        ];
                        paymentTrendChart.update();
                    }

                    function getChartOptions(title) {
                        return {
                            responsive: true,
                            plugins: {
                                legend: { position: 'top' },
                                title: { display: true, text: title }
                            },
                            scales: {
                                y: { beginAtZero: true }
                            }
                        };
                    }
                });

                document.addEventListener('DOMContentLoaded', function () {
                    document.getElementById('closeEditPaymentModal').addEventListener('click', function () {
                        document.getElementById('editPaymentModal').style.display = 'none';
                    });
                    document.getElementById('cancelEditPaymentBtn').addEventListener('click', function () {
                        document.getElementById('editPaymentModal').style.display = 'none';
                    });
                });
            </script>
            <script>
                // --- LocalStorage Initialization for Demo/Test Data (10 lines) --- //
                (function () {
                    if (!localStorage.getItem('processingPlants')) {
                        localStorage.setItem('processingPlants', JSON.stringify([
                            { id: "PLANT-001", name: "Main Dairy Plant", location: "City Center" },
                            { id: "PLANT-002", name: "East Side Plant", location: "East District" }
                        ]));
                    }
                    // 10 demo lines
                    if (!localStorage.getItem('productionLines')) {
                        localStorage.setItem('productionLines', JSON.stringify([
                            {
                                id: "PL-100001", name: "Pasteurizer Line 1", plantId: "PLANT-001", productType: "pasteurized_milk", capacity: 5000,
                                currentRate: 4200, status: "active", lastMaintenance: "2025-06-01", nextMaintenance: "2025-07-01",
                                notes: "Running smoothly", createdAt: "2025-06-01T10:00:00.000Z"
                            },
                            {
                                id: "PL-100002", name: "Yogurt Line A", plantId: "PLANT-002", productType: "yogurt", capacity: 2500,
                                currentRate: 2250, status: "maintenance", lastMaintenance: "2025-05-15", nextMaintenance: "2025-06-15",
                                notes: "Needs filter replacement", createdAt: "2025-05-10T15:30:00.000Z"
                            },
                            {
                                id: "PL-100003", name: "Paneer Line 1", plantId: "PLANT-001", productType: "paneer", capacity: 1800,
                                currentRate: 1500, status: "active", lastMaintenance: "2025-05-20", nextMaintenance: "2025-06-20",
                                notes: "", createdAt: "2025-05-15T09:00:00.000Z"
                            },
                            {
                                id: "PL-100004", name: "Cheese Line 1", plantId: "PLANT-002", productType: "cheese", capacity: 1300,
                                currentRate: 1200, status: "inactive", lastMaintenance: "2025-04-10", nextMaintenance: "2025-07-10",
                                notes: "Shutdown for upgrade", createdAt: "2025-04-01T11:00:00.000Z"
                            },
                            {
                                id: "PL-100005", name: "Butter Line 2", plantId: "PLANT-001", productType: "butter", capacity: 900,
                                currentRate: 800, status: "active", lastMaintenance: "2025-05-28", nextMaintenance: "2025-06-28",
                                notes: "", createdAt: "2025-05-20T08:00:00.000Z"
                            },
                            {
                                id: "PL-100006", name: "Ghee Line 1", plantId: "PLANT-002", productType: "ghee", capacity: 1100,
                                currentRate: 950, status: "active", lastMaintenance: "2025-06-10", nextMaintenance: "2025-07-10",
                                notes: "Recently serviced", createdAt: "2025-06-11T10:30:00.000Z"
                            },
                            {
                                id: "PL-100007", name: "Flavored Milk Line", plantId: "PLANT-001", productType: "flavored_milk", capacity: 1600,
                                currentRate: 1400, status: "active", lastMaintenance: "2025-05-25", nextMaintenance: "2025-06-25",
                                notes: "", createdAt: "2025-05-25T14:00:00.000Z"
                            },
                            {
                                id: "PL-100008", name: "Toned Milk Line 1", plantId: "PLANT-002", productType: "toned_milk", capacity: 4000,
                                currentRate: 3500, status: "active", lastMaintenance: "2025-06-05", nextMaintenance: "2025-07-05",
                                notes: "", createdAt: "2025-06-05T13:25:00.000Z"
                            },
                            {
                                id: "PL-100009", name: "Paneer Line 2", plantId: "PLANT-001", productType: "paneer", capacity: 1900,
                                currentRate: 1600, status: "maintenance", lastMaintenance: "2025-05-01", nextMaintenance: "2025-06-16",
                                notes: "Maintenance due today", createdAt: "2025-05-01T12:00:00.000Z"
                            },
                            {
                                id: "PL-100010", name: "Cheese Line 2", plantId: "PLANT-002", productType: "cheese", capacity: 1350,
                                currentRate: 1250, status: "active", lastMaintenance: "2025-06-12", nextMaintenance: "2025-07-12",
                                notes: "", createdAt: "2025-06-12T09:45:00.000Z"
                            }
                        ]));
                    }
                })();
            </script>
            <script>
                let currentPage = 1;
                const linesPerPage = 10;

                document.addEventListener('DOMContentLoaded', function () {
                    initLineForm();
                    loadPlants();
                    loadProductionLines();
                    document.getElementById('addProductionLineBtn').addEventListener('click', showAddLineForm);
                    document.getElementById('closeLineForm').addEventListener('click', hideLineForm);
                    document.getElementById('cancelLineForm').addEventListener('click', hideLineForm);
                    document.getElementById('lineForm').addEventListener('submit', saveLine);
                    document.getElementById('lineSearch').addEventListener('input', loadProductionLines);
                    document.getElementById('lineFilter').addEventListener('change', loadProductionLines);
                    document.getElementById('prevLinePage').addEventListener('click', () => changePage(-1));
                    document.getElementById('nextLinePage').addEventListener('click', () => changePage(1));
                    document.getElementById('exportLinesBtn').addEventListener('click', exportLines);
                    updateStats();
                });

                function initLineForm() {
                    document.getElementById('lineForm').reset();
                    document.getElementById('lineId').value = '';
                    document.getElementById('lineFormTitle').textContent = 'Add New Production Line';
                }

                function loadPlants() {
                    const plants = JSON.parse(localStorage.getItem('processingPlants')) || [];
                    const plantSelect = document.getElementById('linePlant');
                    plantSelect.innerHTML = '<option value="">Select Plant</option>';
                    plants.forEach(plant => {
                        const option = document.createElement('option');
                        option.value = plant.id;
                        option.textContent = plant.name;
                        plantSelect.appendChild(option);
                    });
                }

                function loadProductionLines() {
                    const searchTerm = document.getElementById('lineSearch').value.toLowerCase();
                    const statusFilter = document.getElementById('lineFilter').value;
                    const productionLines = JSON.parse(localStorage.getItem('productionLines')) || [];
                    let filteredLines = productionLines.filter(line => {
                        const matchesSearch = line.name.toLowerCase().includes(searchTerm) ||
                            line.id.toLowerCase().includes(searchTerm) ||
                            (line.productType && line.productType.toLowerCase().includes(searchTerm));
                        const matchesStatus = statusFilter === 'all' || line.status === statusFilter;
                        return matchesSearch && matchesStatus;
                    });
                    const totalPages = Math.ceil(filteredLines.length / linesPerPage) || 1;
                    if (currentPage > totalPages) currentPage = totalPages;
                    const startIndex = (currentPage - 1) * linesPerPage;
                    const paginatedLines = filteredLines.slice(startIndex, startIndex + linesPerPage);
                    const tbody = document.getElementById('productionLinesBody');
                    tbody.innerHTML = '';
                    if (paginatedLines.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;">No production lines found</td></tr>';
                    } else {
                        paginatedLines.forEach(line => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                <td>${line.id}</td>
                <td>${line.name}</td>
                <td>${getPlantName(line.plantId)}</td>
                <td>${formatProductType(line.productType)}</td>
                <td>${line.capacity}</td>
                <td>${line.currentRate || '-'}</td>
                <td><span class="status ${getStatusClass(line.status)}">${formatStatus(line.status)}</span></td>
                <td>
                    <button class="btn-primary" onclick="editLine('${line.id}')">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-danger" onclick="deleteLine('${line.id}')" style="margin-left:5px;">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
                            tbody.appendChild(row);
                        });
                    }
                    document.getElementById('linesPaginationInfo').textContent =
                        `Showing ${filteredLines.length ? startIndex + 1 : 0} to ${Math.min(startIndex + linesPerPage, filteredLines.length)} of ${filteredLines.length} lines`;
                    document.getElementById('prevLinePage').disabled = currentPage === 1;
                    document.getElementById('nextLinePage').disabled = currentPage === totalPages || totalPages === 0;
                    updateStats();
                }

                function getPlantName(plantId) {
                    const plants = JSON.parse(localStorage.getItem('processingPlants')) || [];
                    const plant = plants.find(p => p.id === plantId);
                    return plant ? plant.name : 'Unknown';
                }

                function formatProductType(type) {
                    const types = {
                        'pasteurized_milk': 'Pasteurized Milk',
                        'toned_milk': 'Toned Milk',
                        'flavored_milk': 'Flavored Milk',
                        'yogurt': 'Yogurt',
                        'paneer': 'Paneer',
                        'cheese': 'Cheese',
                        'ghee': 'Ghee',
                        'butter': 'Butter',
                        'cream': 'Cream',
                        'lassi': 'Lassi'
                    };
                    return types[type] || type || '';
                }

                function formatStatus(status) {
                    if (!status) return '';
                    return status.charAt(0).toUpperCase() + status.slice(1);
                }

                function getStatusClass(status) {
                    const classes = {
                        'active': 'completed',
                        'inactive': 'pending',
                        'maintenance': 'scheduled'
                    };
                    return classes[status] || '';
                }

                function changePage(direction) {
                    const productionLines = JSON.parse(localStorage.getItem('productionLines')) || [];
                    const filteredLines = filterLines(productionLines);
                    const totalPages = Math.ceil(filteredLines.length / linesPerPage) || 1;
                    currentPage += direction;
                    if (currentPage < 1) currentPage = 1;
                    if (currentPage > totalPages) currentPage = totalPages;
                    loadProductionLines();
                }

                function filterLines(lines) {
                    const searchTerm = document.getElementById('lineSearch').value.toLowerCase();
                    const statusFilter = document.getElementById('lineFilter').value;
                    return lines.filter(line => {
                        const matchesSearch = line.name.toLowerCase().includes(searchTerm) ||
                            line.id.toLowerCase().includes(searchTerm) ||
                            (line.productType && line.productType.toLowerCase().includes(searchTerm));
                        const matchesStatus = statusFilter === 'all' || line.status === statusFilter;
                        return matchesSearch && matchesStatus;
                    });
                }

                function showAddLineForm() {
                    initLineForm();
                    loadPlants();
                    document.getElementById('productionLineForm').style.display = 'block';
                    document.getElementById('lineFormTitle').textContent = 'Add New Production Line';
                }

                function hideLineForm() {
                    document.getElementById('productionLineForm').style.display = 'none';
                }

                function editLine(lineId) {
                    const productionLines = JSON.parse(localStorage.getItem('productionLines')) || [];
                    const line = productionLines.find(l => l.id === lineId);
                    if (line) {
                        document.getElementById('lineId').value = line.id;
                        document.getElementById('lineName').value = line.name;
                        document.getElementById('linePlant').value = line.plantId;
                        document.getElementById('lineProductType').value = line.productType;
                        document.getElementById('lineCapacity').value = line.capacity;
                        document.getElementById('lineCurrentRate').value = line.currentRate || '';
                        document.getElementById('lineStatus').value = line.status;
                        document.getElementById('lineLastMaintenance').value = line.lastMaintenance || '';
                        document.getElementById('lineNextMaintenance').value = line.nextMaintenance || '';
                        document.getElementById('lineNotes').value = line.notes || '';
                        document.getElementById('lineFormTitle').textContent = 'Edit Production Line';
                        document.getElementById('productionLineForm').style.display = 'block';
                    }
                }

                function saveLine(e) {
                    e.preventDefault();
                    const lineId = document.getElementById('lineId').value;
                    const lineName = document.getElementById('lineName').value;
                    const plantId = document.getElementById('linePlant').value;
                    const productType = document.getElementById('lineProductType').value;
                    const capacity = document.getElementById('lineCapacity').value;
                    const currentRate = document.getElementById('lineCurrentRate').value;
                    const status = document.getElementById('lineStatus').value;
                    const lastMaintenance = document.getElementById('lineLastMaintenance').value;
                    const nextMaintenance = document.getElementById('lineNextMaintenance').value;
                    const notes = document.getElementById('lineNotes').value;
                    let productionLines = JSON.parse(localStorage.getItem('productionLines')) || [];

                    if (!lineName || !plantId || !productType || !capacity || !status) {
                        alert('Please fill in all required fields.');
                        return;
                    }

                    if (lineId) {
                        // Update existing
                        const index = productionLines.findIndex(l => l.id === lineId);
                        if (index !== -1) {
                            productionLines[index] = {
                                ...productionLines[index],
                                name: lineName,
                                plantId,
                                productType,
                                capacity,
                                currentRate,
                                status,
                                lastMaintenance,
                                nextMaintenance,
                                notes
                            };
                        }
                    } else {
                        // Add new
                        const newLine = {
                            id: 'PL-' + Date.now().toString().slice(-6),
                            name: lineName,
                            plantId,
                            productType,
                            capacity,
                            currentRate,
                            status,
                            lastMaintenance,
                            nextMaintenance,
                            notes,
                            createdAt: new Date().toISOString()
                        };
                        productionLines.push(newLine);
                    }
                    localStorage.setItem('productionLines', JSON.stringify(productionLines));
                    loadProductionLines();
                    hideLineForm();
                    alert('Production line saved successfully!');
                }

                function deleteLine(lineId) {
                    if (confirm('Are you sure you want to delete this production line?')) {
                        let productionLines = JSON.parse(localStorage.getItem('productionLines')) || [];
                        productionLines = productionLines.filter(l => l.id !== lineId);
                        localStorage.setItem('productionLines', JSON.stringify(productionLines));
                        loadProductionLines();
                    }
                }

                function updateStats() {
                    const productionLines = JSON.parse(localStorage.getItem('productionLines')) || [];
                    document.getElementById('totalLinesCount').textContent = productionLines.length;
                    const activeLines = productionLines.filter(l => l.status === 'active').length;
                    document.getElementById('activeLinesCount').textContent = activeLines;
                    const totalCapacity = productionLines.reduce((sum, line) => sum + (parseInt(line.capacity) || 0), 0);
                    const totalRate = productionLines.reduce((sum, line) => sum + (parseInt(line.currentRate) || 0), 0);
                    const avgUtilization = totalCapacity > 0 ? Math.round((totalRate / totalCapacity) * 100) : 0;
                    document.getElementById('avgUtilization').textContent = avgUtilization + '%';
                    const today = new Date().toISOString().split('T')[0];
                    const maintenanceDue = productionLines.filter(l => l.nextMaintenance && l.nextMaintenance <= today).length;
                    document.getElementById('maintenanceDueCount').textContent = maintenanceDue;
                }

                function exportLines() {
                    const productionLines = JSON.parse(localStorage.getItem('productionLines')) || [];
                    const plants = JSON.parse(localStorage.getItem('processingPlants')) || [];
                    let csvContent = "Line ID,Name,Plant,Product Type,Capacity (L/hr),Current Rate (L/hr),Status,Last Maintenance,Next Maintenance\n";
                    productionLines.forEach(line => {
                        const plant = plants.find(p => p.id === line.plantId) || {};
                        csvContent += `"${line.id}","${line.name}","${plant.name || ''}","${formatProductType(line.productType)}",` +
                            `${line.capacity},${line.currentRate || ''},"${formatStatus(line.status)}",` +
                            `${line.lastMaintenance || ''},${line.nextMaintenance || ''}\n`;
                    });
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.setAttribute('href', url);
                    link.setAttribute('download', 'production_lines_export.csv');
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
            </script>



            <script>
                let outlets = [
                    { id: 1, name: 'Outlet A', location: 'Hyderabad', manager: 'Anil Kumar', contact: '9876543210' },
                    { id: 2, name: 'Outlet B', location: 'Vijayawada', manager: 'Sunita Rao', contact: '9988776655' },
                    { id: 3, name: 'Outlet C', location: 'Hyderabad', manager: 'Sunita Rao', contact: '9012345678' },
                    { id: 4, name: 'Outlet D', location: 'Warangal', manager: 'Ramesh T', contact: '9123456780' }
                ];
                let editingOutletId = null;

                function renderOutletTable() {
                    const tbody = document.getElementById('retail-outlet-tbody');
                    tbody.innerHTML = '';
                    if (outlets.length === 0) {
                        const tr = document.createElement('tr');
                        tr.innerHTML = '<td colspan="5" style="text-align:center;color:#adb5bd;">No retail outlets found.</td>';
                        tbody.appendChild(tr);
                    } else {
                        outlets.forEach(outlet => {
                            const tr = document.createElement('tr');
                            tr.innerHTML = `
                <td>${outlet.name}</td>
                <td>${outlet.location}</td>
                <td>${outlet.manager}</td>
                <td>${outlet.contact}</td>
                <td>
                    <button class="btn-success" title="Edit" onclick="editOutlet(${outlet.id})"><i class="fa fa-edit"></i></button>
                    <button class="edit-btn" title="Delete" onclick="deleteOutlet(${outlet.id})"><i class="fa fa-trash"></i></button>
                </td>
            `;
                            tbody.appendChild(tr);
                        });
                    }
                    updateOutletCharts();
                }

                function showAddOutletModal() {
                    editingOutletId = null;
                    document.getElementById('outlet-form-title').innerText = 'Add Outlet';
                    document.getElementById('outlet-form').reset();
                    document.getElementById('outlet-id').value = '';
                    document.getElementById('outlet-modal').style.display = 'flex';
                }
                function closeOutletModal() {
                    document.getElementById('outlet-modal').style.display = 'none';
                }
                function saveOutlet() {
                    const id = document.getElementById('outlet-id').value;
                    const name = document.getElementById('outlet-name').value.trim();
                    const location = document.getElementById('outlet-location').value.trim();
                    const manager = document.getElementById('outlet-manager').value.trim();
                    const contact = document.getElementById('outlet-contact').value.trim();

                    if (!name || !location || !manager || !contact) return;

                    if (id) {
                        // Update
                        const idx = outlets.findIndex(m => m.id == id);
                        if (idx > -1) {
                            outlets[idx] = { id: Number(id), name, location, manager, contact };
                        }
                    } else {
                        // Add
                        const newId = outlets.length ? Math.max(...outlets.map(m => m.id)) + 1 : 1;
                        outlets.push({ id: newId, name, location, manager, contact });
                    }
                    closeOutletModal();
                    renderOutletTable();
                }
                function editOutlet(id) {
                    const outlet = outlets.find(m => m.id === id);
                    if (outlet) {
                        document.getElementById('outlet-form-title').innerText = 'Edit Outlet';
                        document.getElementById('outlet-id').value = outlet.id;
                        document.getElementById('outlet-name').value = outlet.name;
                        document.getElementById('outlet-location').value = outlet.location;
                        document.getElementById('outlet-manager').value = outlet.manager;
                        document.getElementById('outlet-contact').value = outlet.contact;
                        document.getElementById('outlet-modal').style.display = 'flex';
                    }
                }
                function deleteOutlet(id) {
                    if (confirm('Are you sure you want to delete this outlet?')) {
                        outlets = outlets.filter(m => m.id !== id);
                        renderOutletTable();
                    }
                }

                // Chart.js Bar and Pie Chart for Retail Outlet
                let outletBarChart, outletPieChart;
                function updateOutletCharts() {
                    // Bar: Outlets by Location
                    const locationCount = {};
                    outlets.forEach(m => {
                        locationCount[m.location] = (locationCount[m.location] || 0) + 1;
                    });
                    // Pie: Manager Distribution
                    const managerCount = {};
                    outlets.forEach(m => {
                        managerCount[m.manager] = (managerCount[m.manager] || 0) + 1;
                    });

                    // Bar Chart
                    const barCtx = document.getElementById('outletBarChart').getContext('2d');
                    if (outletBarChart) outletBarChart.destroy();
                    outletBarChart = new Chart(barCtx, {
                        type: 'bar',
                        data: {
                            labels: Object.keys(locationCount),
                            datasets: [{
                                label: 'Outlet Count',
                                data: Object.values(locationCount),
                                backgroundColor: ['#00b4d8', '#e76f51', '#e9c46a', '#2a9d8f', '#caf0f8']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } },
                            scales: { y: { beginAtZero: true, precision: 0 } }
                        }
                    });

                    // Pie Chart
                    const pieCtx = document.getElementById('outletPieChart').getContext('2d');
                    if (outletPieChart) outletPieChart.destroy();
                    outletPieChart = new Chart(pieCtx, {
                        type: 'pie',
                        data: {
                            labels: Object.keys(managerCount),
                            datasets: [{
                                data: Object.values(managerCount),
                                backgroundColor: ['#0077b6', '#e76f51', '#e9c46a', '#2a9d8f', '#caf0f8', '#adb5bd']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: true, position: 'bottom' } }
                        }
                    });
                }

                // Modal close on background click
                document.addEventListener('DOMContentLoaded', function () {
                    renderOutletTable();
                    document.getElementById('outlet-modal').addEventListener('click', function (e) {
                        if (e.target === this) closeOutletModal();
                    });
                });
            </script>


            <script>
                // Profile Section JavaScript

                // Wait for DOM to load before initializing
                document.addEventListener('DOMContentLoaded', function () {
                    // Initialize profile data
                    loadProfileData();

                    // Set up event listeners for profile section
                    document.getElementById('editProfileBtn').addEventListener('click', enableProfileEditing);
                    document.getElementById('saveProfileBtn').addEventListener('click', saveProfile);
                    document.getElementById('cancelEditBtn').addEventListener('click', cancelProfileEditing);
                    document.getElementById('changeAvatarBtn').addEventListener('click', function (e) {
                        e.preventDefault();
                        document.getElementById('avatarInput').click();
                    });
                    document.getElementById('avatarInput').addEventListener('change', handleAvatarUpload);
                });

                // Load profile information from localStorage or defaults
                function loadProfileData() {
                    const profileData = JSON.parse(localStorage.getItem('userProfile')) || {
                        fullName: 'D. JOY',
                        phone: '+91',
                        email: '',
                        address: '',
                        avatar: ''
                    };

                    document.getElementById('fullName').value = profileData.fullName;
                    document.getElementById('phone').value = profileData.phone;
                    document.getElementById('email').value = profileData.email;
                    document.getElementById('address').value = profileData.address;

                    // Update avatar display
                    const avatarDisplay = document.getElementById('avatarDisplay');
                    if (profileData.avatar) {
                        avatarDisplay.style.backgroundImage = `url(${profileData.avatar})`;
                        avatarDisplay.style.backgroundSize = 'cover';
                        avatarDisplay.textContent = '';
                    } else {
                        // Display initials
                        const names = profileData.fullName.split(' ');
                        const initials = names[0].charAt(0) + (names.length > 1 ? names[names.length - 1].charAt(0) : '');
                        avatarDisplay.style.backgroundImage = '';
                        avatarDisplay.textContent = initials;
                    }
                }

                // Enable form for editing
                function enableProfileEditing() {
                    const inputs = document.querySelectorAll('#profileForm input, #profileForm textarea');
                    inputs.forEach(input => {
                        input.readOnly = false;
                        input.style.backgroundColor = 'white';
                        input.style.border = '1px solid var(--primary)';
                    });

                    document.getElementById('formActions').style.display = 'block';
                    document.getElementById('editProfileBtn').style.display = 'none';
                }

                // Cancel editing and revert to saved profile
                function cancelProfileEditing() {
                    const inputs = document.querySelectorAll('#profileForm input, #profileForm textarea');
                    inputs.forEach(input => {
                        input.readOnly = true;
                        input.style.backgroundColor = '';
                        input.style.border = '1px solid var(--dark)';
                    });

                    document.getElementById('formActions').style.display = 'none';
                    document.getElementById('editProfileBtn').style.display = 'block';

                    // Reload original data
                    loadProfileData();
                }

                // Save profile information and update localStorage
                function saveProfile() {
                    const profileData = {
                        fullName: document.getElementById('fullName').value,
                        phone: document.getElementById('phone').value,
                        email: document.getElementById('email').value,
                        address: document.getElementById('address').value,
                        avatar: localStorage.getItem('userAvatar') || ''
                    };

                    localStorage.setItem('userProfile', JSON.stringify(profileData));

                    // Update avatar display
                    const avatarDisplay = document.getElementById('avatarDisplay');
                    if (profileData.avatar) {
                        avatarDisplay.style.backgroundImage = `url(${profileData.avatar})`;
                        avatarDisplay.style.backgroundSize = 'cover';
                        avatarDisplay.textContent = '';
                    } else {
                        const names = profileData.fullName.split(' ');
                        const initials = names[0].charAt(0) + (names.length > 1 ? names[names.length - 1].charAt(0) : '');
                        avatarDisplay.style.backgroundImage = '';
                        avatarDisplay.textContent = initials;
                    }

                    // Disable editing
                    cancelProfileEditing();

                    alert('Profile saved successfully!');
                }

                // Handle avatar image upload and store in localStorage
                function handleAvatarUpload(event) {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            const avatarDisplay = document.getElementById('avatarDisplay');
                            avatarDisplay.style.backgroundImage = `url(${e.target.result})`;
                            avatarDisplay.style.backgroundSize = 'cover';
                            avatarDisplay.textContent = '';

                            // Save avatar image to localStorage
                            localStorage.setItem('userAvatar', e.target.result);

                            // Update profile data with the new avatar
                            const profileData = JSON.parse(localStorage.getItem('userProfile')) || {};
                            profileData.avatar = e.target.result;
                            localStorage.setItem('userProfile', JSON.stringify(profileData));
                        };
                        reader.readAsDataURL(file);
                    }
                }
            </script>





            <script>
                function toggleSidebar() {
                    const sidebar = document.getElementById('sidebar');
                    const content = document.querySelector('.content-area');

                    sidebar.classList.toggle('collapsed');
                    content.classList.toggle('expanded');
                }
            </script>


            <script>
                function toggleSidebar() {
                    const sidebar = document.getElementById('sidebar');
                    const content = document.querySelector('.content-area');

                    if (sidebar.classList.contains('collapsed')) {
                        sidebar.classList.remove('collapsed');
                        content.classList.remove('expanded');
                    } else {
                        sidebar.classList.add('collapsed');
                        content.classList.add('expanded');
                    }
                }
            </script>


            <script>
                function showFarmerList() {
                    document.getElementById('farmerRegistrationForm').style.display = 'none';
                    document.getElementById('registeredFarmersList').style.display = 'block';
                }

                function showRegistrationForm() {
                    document.getElementById('farmerRegistrationForm').style.display = 'block';
                    document.getElementById('registeredFarmersList').style.display = 'none';
                }

                document.addEventListener('DOMContentLoaded', function () {
                    const form = document.getElementById('farmerRegistrationForm');
                    const list = document.getElementById('registeredFarmersList');
                    if (form && list) {
                        list.style.display = 'none';
                        form.style.display = 'block';
                    }
                });
            </script>

</body>
</div>
</div>
</div>
<script>
    // Add Payment - Show form
    document.getElementById("addPaymentBtn")?.addEventListener('click', function () {
        document.getElementById("addPaymentForm").style.display = "block";
    });

    document.getElementById("cancelPaymentBtn")?.addEventListener('click', function () {
        document.getElementById("addPaymentForm").style.display = "none";
    });

    // Export to PDF - Use html2canvas and jsPDF
    document.getElementById("exportPaymentPdfBtn")?.addEventListener('click', function () {
        const element = document.getElementById("paymentTable");
        html2canvas(element).then((canvas) => {
            const imgData = canvas.toDataURL("image/png");
            const pdf = new jspdf.jsPDF();
            pdf.addImage(imgData, "PNG", 10, 10, 190, 0);
            pdf.save("payment-details.pdf");
        });
    });

    // Generate Invoice - Dummy PDF content
    document.getElementById("generateInvoiceBtn")?.addEventListener('click', function () {
        const pdf = new jspdf.jsPDF();
        pdf.text("Invoice Generated", 20, 20);
        pdf.save("invoice.pdf");
    });

    // Print Schedule
    document.getElementById("printScheduleBtn")?.addEventListener('click', function () {
        window.print();
    });
</script>



<script>
    document.getElementById("generateInvoiceBtn")?.addEventListener('click', function () {
        const doc = new jspdf.jsPDF();
        doc.setFontSize(16);
        doc.text("Payment Invoice", 105, 20, null, null, "center");

        const table = document.getElementById("paymentTable");
        let rows = [];
        let headers = [];

        // Extract table headers
        table.querySelectorAll("thead th").forEach(th => {
            headers.push(th.innerText.trim());
        });

        // Extract table rows
        table.querySelectorAll("tbody tr").forEach(tr => {
            let row = [];
            tr.querySelectorAll("td").forEach(td => {
                row.push(td.innerText.trim().replace(/\n/g, " "));
            });
            rows.push(row);
        });

        // AutoTable from jsPDF
        if (rows.length > 0) {
            doc.autoTable({
                head: [headers],
                body: rows,
                startY: 30
            });
        }

        doc.save("Payment_Invoice.pdf");
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        let editingIndex = -1;

        function showUserForm() {
            document.getElementById('userForm').style.display = 'block';
        }

        function hideUserForm() {
            document.getElementById('userForm').style.display = 'none';
            document.getElementById('userName').value = '';
            document.getElementById('userEmail').value = '';
            document.getElementById('userPassword').value = '';
            editingIndex = -1;
        }

        function saveUser() {
            let users = JSON.parse(localStorage.getItem('users') || '[]');
            const name = document.getElementById('userName').value;
            const email = document.getElementById('userEmail').value;
            const password = document.getElementById('userPassword').value;

            if (!name || !email || !password) {
                alert('All fields are required');
                return;
            }

            if (editingIndex === -1) {
                users.push({ name, email, password });
            } else {
                users[editingIndex] = { name, email, password };
            }

            localStorage.setItem('users', JSON.stringify(users));
            renderUsers();
            hideUserForm();
        }

        function renderUsers() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const tbody = document.getElementById('userTableBody');
            tbody.innerHTML = '';
            users.forEach((user, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                            < td > ${user.name}</td >
                <td>${user.email}</td>
                <td>${user.password}</td>
                <td>
                    <button onclick="editUser(${index})">Edit</button>
                    <button onclick="deleteUser(${index})">Delete</button>
                </td>
            `;
                tbody.appendChild(row);
            });
        }

        window.editUser = function (index) {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users[index];
            document.getElementById('userName').value = user.name;
            document.getElementById('userEmail').value = user.email;
            document.getElementById('userPassword').value = user.password;
            editingIndex = index;
            showUserForm();
        }

        window.deleteUser = function (index) {
            if (confirm('Are you sure you want to delete this user?')) {
                let users = JSON.parse(localStorage.getItem('users') || '[]');
                users.splice(index, 1);
                localStorage.setItem('users', JSON.stringify(users));
                renderUsers();
            }
        }

        window.showUserForm = showUserForm;
        window.hideUserForm = hideUserForm;
        window.saveUser = saveUser;

        renderUsers();
    });
</script>
<script>
    // Collection Schedule JavaScript
    document.addEventListener('DOMContentLoaded', function () {
        // Initialize collections data from local storage
        let collections = JSON.parse(localStorage.getItem('milkCollections')) || [];
        let currentPage = 1;
        const itemsPerPage = 10;

        // Sample farmer data
        const farmers = [
            { id: 'F-1001', name: 'Rajesh Patel', village: 'Anand' },
            { id: 'F-1002', name: 'Sunita Sharma', village: 'Mehsana' },
            { id: 'F-1003', name: 'Vijay Singh', village: 'Kheda' },
            { id: 'F-1004', name: 'Meena Desai', village: 'Sabarkantha' },
            { id: 'F-1005', name: 'Arun Gupta', village: 'Gandhinagar' }
        ];

        // Initialize the page
        initCollectionSchedule();

        // Event listeners
        document.getElementById('addCollectionBtn').addEventListener('click', showAddCollectionForm);
        document.getElementById('closeCollectionForm').addEventListener('click', hideCollectionForm);
        document.getElementById('cancelCollectionForm').addEventListener('click', hideCollectionForm);
        document.getElementById('collectionForm').addEventListener('submit', saveCollection);
        document.getElementById('applyFiltersBtn').addEventListener('click', applyFilters);
        document.getElementById('resetFiltersBtn').addEventListener('click', resetFilters);
        document.getElementById('prevCollectionPage').addEventListener('click', () => changeCollectionPage(-1));
        document.getElementById('nextCollectionPage').addEventListener('click', () => changeCollectionPage(1));

        // Initialize collection schedule
        function initCollectionSchedule() {
            // If no data in local storage, create sample data
            if (collections.length === 0) {
                createSampleCollections();
            }

            // Populate farmer dropdown
            const farmerSelect = document.getElementById('collectionFarmer');
            farmerSelect.innerHTML = '<option value="">Select Farmer</option>';
            farmers.forEach(farmer => {
                const option = document.createElement('option');
                option.value = farmer.id;
                option.textContent = `${farmer.name} (${farmer.id}) - ${farmer.village} `;
                farmerSelect.appendChild(option);
            });

            // Load collections
            loadCollections();
            updateStats();
            initCharts();
        }

        // Create sample collections if none exist
        function createSampleCollections() {
            const today = new Date();
            const tomorrow = new Date();
            tomorrow.setDate(today.getDate() + 1);

            const sampleCollections = [
                {
                    id: 'MC-' + Math.floor(Math.random() * 9000 + 1000),
                    farmerId: 'F-1001',
                    farmerName: 'Rajesh Patel',
                    center: 'Ahmedabad',
                    date: formatDate(today),
                    expectedQty: 45.5,
                    actualQty: 46.0,
                    timeSlot: 'Morning (6-9 AM)',
                    status: 'completed',
                    notes: 'Good quality milk'
                },
                {
                    id: 'MC-' + Math.floor(Math.random() * 9000 + 1000),
                    farmerId: 'F-1002',
                    farmerName: 'Sunita Sharma',
                    center: 'Gandhinagar',
                    date: formatDate(today),
                    expectedQty: 38.0,
                    actualQty: 37.5,
                    timeSlot: 'Late Morning (9-12 PM)',
                    status: 'completed',
                    notes: 'Slightly less than expected'
                },
                {
                    id: 'MC-' + Math.floor(Math.random() * 9000 + 1000),
                    farmerId: 'F-1003',
                    farmerName: 'Vijay Singh',
                    center: 'Vadodara',
                    date: formatDate(today),
                    expectedQty: 52.0,
                    actualQty: null,
                    timeSlot: 'Afternoon (12-3 PM)',
                    status: 'in-progress',
                    notes: 'Expected high yield today'
                },
                {
                    id: 'MC-' + Math.floor(Math.random() * 9000 + 1000),
                    farmerId: 'F-1004',
                    farmerName: 'Meena Desai',
                    center: 'Surat',
                    date: formatDate(tomorrow),
                    expectedQty: 41.5,
                    actualQty: null,
                    timeSlot: 'Morning (6-9 AM)',
                    status: 'scheduled',
                    notes: ''
                },
                {
                    id: 'MC-' + Math.floor(Math.random() * 9000 + 1000),
                    farmerId: 'F-1005',
                    farmerName: 'Arun Gupta',
                    center: 'Rajkot',
                    date: formatDate(tomorrow),
                    expectedQty: 47.0,
                    actualQty: null,
                    timeSlot: 'Evening (3-6 PM)',
                    status: 'scheduled',
                    notes: ''
                }
            ];

            collections = sampleCollections;
            saveCollectionsToLocalStorage();
        }

        // Load collections into the table
        function loadCollections(filteredCollections = null) {
            const collectionsToDisplay = filteredCollections || collections;
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedCollections = collectionsToDisplay.slice(startIndex, endIndex);

            const tableBody = document.getElementById('collectionTableBody');
            tableBody.innerHTML = '';

            if (paginatedCollections.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="9" style="text-align: center;">No collections found</td>';
                tableBody.appendChild(row);
            } else {
                paginatedCollections.forEach(collection => {
                    const row = document.createElement('tr');

                    // Format actual quantity display
                    const actualQtyDisplay = collection.actualQty !== null ?
                        collection.actualQty + ' L' : '--';

                    // Format status badge
                    let statusClass = '';
                    let statusText = '';
                    switch (collection.status) {
                        case 'scheduled':
                            statusClass = 'scheduled';
                            statusText = 'Scheduled';
                            break;
                        case 'in-progress':
                            statusClass = 'processing';
                            statusText = 'In Progress';
                            break;
                        case 'completed':
                            statusClass = 'completed';
                            statusText = 'Completed';
                            break;
                        case 'cancelled':
                            statusClass = 'pending';
                            statusText = 'Cancelled';
                            break;
                    }

                    row.innerHTML = `
                            <tr>
    <td>${collection.id}</td>
    <td>${collection.date}</td>
    <td>${collection.farmerName} (${collection.farmerId})</td>
    <td>${collection.center} Center</td>
    <td>${collection.expectedQty} L</td>
    <td>${actualQtyDisplay}</td>
    <td>${collection.timeSlot}</td>
    <td>
        <span class="status ${statusClass}">${statusText}</span>
    </td>
    <td class="actions-cell">
        <button class="btn-primary edit-collection" data-id="${collection.id}">
            <i class="fas fa-edit"></i>
        </button>
        <button class="delete-btn delete-collection" data-id="${collection.id}" style="margin-left: 2px; margin-top:2px;">
            <i class="fas fa-trash"></i>
        </button>
    </td>
</tr>

                        `;

                    tableBody.appendChild(row);
                });

                // Add event listeners to edit and delete buttons
                document.querySelectorAll('.edit-collection').forEach(button => {
                    button.addEventListener('click', function () {
                        editCollection(this.getAttribute('data-id'));
                    });
                });

                document.querySelectorAll('.delete-collection').forEach(button => {
                    button.addEventListener('click', function () {
                        deleteCollection(this.getAttribute('data-id'));
                    });
                });
            }

            // Update pagination info
            updatePaginationInfo(collectionsToDisplay.length);
        }

        // Update pagination information
        function updatePaginationInfo(totalItems) {
            const startItem = ((currentPage - 1) * itemsPerPage) + 1;
            const endItem = Math.min(currentPage * itemsPerPage, totalItems);

            document.getElementById('collectionPaginationInfo').textContent =
                `Showing ${startItem} to ${endItem} of ${totalItems} collections`;

            // Enable/disable pagination buttons
            document.getElementById('prevCollectionPage').disabled = currentPage === 1;
            document.getElementById('nextCollectionPage').disabled =
                currentPage * itemsPerPage >= totalItems;
        }

        // Change page
        function changeCollectionPage(direction) {
            const totalPages = Math.ceil(collections.length / itemsPerPage);

            if (direction === 1 && currentPage < totalPages) {
                currentPage++;
                loadCollections();
            } else if (direction === -1 && currentPage > 1) {
                currentPage--;
                loadCollections();
            }
        }

        // Show add collection form
        function showAddCollectionForm() {
            document.getElementById('collectionFormTitle').textContent = 'Add New Collection';
            document.getElementById('collectionId').value = '';
            document.getElementById('collectionForm').reset();
            document.getElementById('collectionActualQty').disabled = false;

            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('collectionDate').value = today;

            document.getElementById('collectionFormContainer').style.display = 'block';
            document.getElementById('collectionTable').style.display = 'none';
        }

        // Hide collection form
        function hideCollectionForm() {
            document.getElementById('collectionFormContainer').style.display = 'none';
            document.getElementById('collectionTable').style.display = 'table';
        }

        // Edit collection
        function editCollection(id) {
            const collection = collections.find(c => c.id === id);
            if (!collection) return;

            document.getElementById('collectionFormTitle').textContent = 'Edit Collection';
            document.getElementById('collectionId').value = collection.id;
            document.getElementById('collectionFarmer').value = collection.farmerId;
            document.getElementById('collectionCenter').value = collection.center;
            document.getElementById('collectionDate').value = collection.date;
            document.getElementById('collectionTimeSlot').value = collection.timeSlot;
            document.getElementById('collectionExpectedQty').value = collection.expectedQty;
            document.getElementById('collectionActualQty').value = collection.actualQty || '';
            document.getElementById('collectionStatus').value = collection.status;
            document.getElementById('collectionNotes').value = collection.notes || '';

            // Disable actual quantity if status is scheduled
            document.getElementById('collectionActualQty').disabled = collection.status === 'scheduled';

            document.getElementById('collectionFormContainer').style.display = 'block';
            document.getElementById('collectionTable').style.display = 'none';
        }

        // Save collection (add or update)
        function saveCollection(e) {
            e.preventDefault();

            const id = document.getElementById('collectionId').value;
            const farmerId = document.getElementById('collectionFarmer').value;
            const center = document.getElementById('collectionCenter').value;
            const date = document.getElementById('collectionDate').value;
            const timeSlot = document.getElementById('collectionTimeSlot').value;
            const expectedQty = parseFloat(document.getElementById('collectionExpectedQty').value);
            const actualQty = document.getElementById('collectionActualQty').value ?
                parseFloat(document.getElementById('collectionActualQty').value) : null;
            const status = document.getElementById('collectionStatus').value;
            const notes = document.getElementById('collectionNotes').value;

            // Find farmer name
            const farmer = farmers.find(f => f.id === farmerId);
            const farmerName = farmer ? farmer.name : '';

            if (id) {
                // Update existing collection
                const index = collections.findIndex(c => c.id === id);
                if (index !== -1) {
                    collections[index] = {
                        id,
                        farmerId,
                        farmerName,
                        center,
                        date,
                        expectedQty,
                        actualQty,
                        timeSlot,
                        status,
                        notes
                    };
                }
            } else {
                // Add new collection
                const newId = 'MC-' + Math.floor(Math.random() * 9000 + 1000);
                collections.push({
                    id: newId,
                    farmerId,
                    farmerName,
                    center,
                    date,
                    expectedQty,
                    actualQty,
                    timeSlot,
                    status,
                    notes
                });
            }

            saveCollectionsToLocalStorage();
            hideCollectionForm();
            loadCollections();
            updateStats();
        }

        // Delete collection
        function deleteCollection(id) {
            if (confirm('Are you sure you want to delete this collection?')) {
                collections = collections.filter(c => c.id !== id);
                saveCollectionsToLocalStorage();
                loadCollections();
                updateStats();
            }
        }

        // Apply filters
        function applyFilters() {
            const centerFilter = document.getElementById('collectionCenterFilter').value;
            const statusFilter = document.getElementById('collectionStatusFilter').value;
            const dateFilter = document.getElementById('collectionDateFilter').value;

            let filteredCollections = collections;

            if (centerFilter) {
                filteredCollections = filteredCollections.filter(c => c.center === centerFilter);
            }

            if (statusFilter) {
                filteredCollections = filteredCollections.filter(c => c.status === statusFilter);
            }

            if (dateFilter) {
                filteredCollections = filteredCollections.filter(c => c.date === dateFilter);
            }

            currentPage = 1;
            loadCollections(filteredCollections);
        }

        // Reset filters
        function resetFilters() {
            document.getElementById('collectionCenterFilter').value = '';
            document.getElementById('collectionStatusFilter').value = '';
            document.getElementById('collectionDateFilter').value = '';

            currentPage = 1;
            loadCollections();
        }

        // Update statistics
        function updateStats() {
            const today = formatDate(new Date());

            // Scheduled today
            const scheduledToday = collections.filter(c =>
                c.date === today && c.status === 'scheduled').length;
            document.getElementById('scheduledToday').textContent = scheduledToday;

            // Completed today
            const completedToday = collections.filter(c =>
                c.date === today && c.status === 'completed').length;
            document.getElementById('completedToday').textContent = completedToday;

            // Pending collections (scheduled or in-progress)
            const pendingCollections = collections.filter(c =>
                c.status === 'scheduled' || c.status === 'in-progress').length;
            document.getElementById('pendingCollections').textContent = pendingCollections;

            // Calculate changes (simplified for demo)
            document.getElementById('scheduledChange').textContent = '5%';
            document.getElementById('completedChange').textContent = '3%';
            document.getElementById('pendingChange').textContent = '2';
        }

        // Initialize charts
        function initCharts() {
            // Scheduled vs Completed Chart
            const scheduledCtx = document.getElementById('scheduledChart').getContext('2d');
            new Chart(scheduledCtx, {
                type: 'bar',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
                    datasets: [{
                        label: 'Scheduled',
                        data: [12, 15, 13, 14, 16, 10],
                        backgroundColor: '#0077b6'
                    }, {
                        label: 'Completed',
                        data: [10, 12, 11, 13, 14, 8],
                        backgroundColor: '#2a9d8f'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });

            // Completed Chart
            const completedCtx = document.getElementById('completedChart').getContext('2d');
            new Chart(completedCtx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
                    datasets: [{
                        label: 'Completed Collections',
                        data: [10, 12, 11, 13, 14, 8],
                        borderColor: '#2a9d8f',
                        backgroundColor: 'rgba(42, 157, 143, 0.1)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });

            // Pending Chart
            const pendingCtx = document.getElementById('pendingChart').getContext('2d');
            new Chart(pendingCtx, {
                type: 'doughnut',
                data: {

                    datasets: [{
                        data: [15, 8, 30, 2],
                        backgroundColor: [
                            '#0077b6',
                            '#e9c46a',
                            '#2a9d8f',
                            '#e76f51'
                        ]
                    }]
                },
                options: {
                    responsive: true
                }
            });
        }

        // Save collections to local storage
        function saveCollectionsToLocalStorage() {
            localStorage.setItem('milkCollections', JSON.stringify(collections));
        }

        // Helper function to format date as YYYY-MM-DD
        function formatDate(date) {
            const d = new Date(date);
            let month = '' + (d.getMonth() + 1);
            let day = '' + d.getDate();
            const year = d.getFullYear();

            if (month.length < 2) month = '0' + month;
            if (day.length < 2) day = '0' + day;

            return [year, month, day].join('-');
        }

        // Status change handler
        document.getElementById('collectionStatus').addEventListener('change', function () {
            const actualQtyField = document.getElementById('collectionActualQty');
            if (this.value === 'scheduled') {
                actualQtyField.disabled = true;
                actualQtyField.value = '';
            } else {
                actualQtyField.disabled = false;
            }
        });
    });
</script>


<script>
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const content = document.querySelector('.content-area');

        sidebar.classList.toggle('collapsed');
        content.classList.toggle('expanded');
    }
</script>


<script>
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const content = document.querySelector('.content-area');

        if (sidebar.classList.contains('collapsed')) {
            sidebar.classList.remove('collapsed');
            content.classList.remove('expanded');
        } else {
            sidebar.classList.add('collapsed');
            content.classList.add('expanded');
        }
    }
</script>




<script>


    // Initialize Product Inventory Charts
    document.addEventListener('DOMContentLoaded', function () {
        if (document.getElementById('product-inventory-section')) {
            // Total Products Chart
            new Chart(document.getElementById('totalProductsChart').getContext('2d'), {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        data: [20, 22, 23, 25, 26, 28],
                        borderColor: '#0077b6',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { display: false }, x: { display: false } }
                }
            });

            // Stock Value Chart
            new Chart(document.getElementById('stockValueChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        data: [1.8, 2.0, 2.2, 2.4, 2.6, 2.8],
                        backgroundColor: '#00b4d8',
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { display: false }, x: { display: false } }
                }
            });

            // Stock Days Chart
            new Chart(document.getElementById('stockDaysChart').getContext('2d'), {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        data: [18, 17, 16, 15, 15, 14],
                        borderColor: '#2a9d8f',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { display: false }, x: { display: false } }
                }
            });

            // Low Stock Chart
            new Chart(document.getElementById('lowStockChart').getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: ['Normal', 'Low'],
                    datasets: [{
                        data: [23, 5],
                        backgroundColor: ['#2a9d8f', '#e76f51'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    cutout: '70%'
                }
            });

            // Stock by Category Chart
            new Chart(document.getElementById('stockCategoryChart').getContext('2d'), {
                type: 'pie',
                data: {
                    labels: ['Liquid Milk', 'Cheese', 'Dairy Fat', 'Fermented', 'Other'],
                    datasets: [{
                        data: [45, 20, 15, 12, 8],
                        backgroundColor: ['#0077b6', '#00b4d8', '#2a9d8f', '#e9c46a', '#e76f51']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        title: {
                            display: true,
                            text: 'Stock Distribution by Category',
                            font: { size: 14 }
                        }
                    }
                }
            });

            // Inventory Turnover Chart
            new Chart(document.getElementById('inventoryTurnoverChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['Liquid Milk', 'Cheese', 'Dairy Fat', 'Fermented', 'Other'],
                    datasets: [{
                        label: 'Turnover (Days)',
                        data: [7, 14, 21, 10, 15],
                        backgroundColor: ['#0077b6', '#00b4d8', '#2a9d8f', '#e9c46a', '#e76f51']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Average Inventory Turnover',
                            font: { size: 14 }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Days'
                            }
                        }
                    }
                }
            });

            // Add Product button functionality
            document.getElementById('addInventoryBtn').addEventListener('click', function () {
                document.getElementById('addProductForm').style.display = 'block';
            });

            document.getElementById('closeProductForm').addEventListener('click', function () {
                document.getElementById('addProductForm').style.display = 'none';
            });

            document.getElementById('cancelProductForm').addEventListener('click', function () {
                document.getElementById('addProductForm').style.display = 'none';
            });

            document.getElementById('productForm').addEventListener('submit', function (e) {
                e.preventDefault();
                alert('Product added successfully!');
                document.getElementById('productForm').reset();
                document.getElementById('addProductForm').style.display = 'none';
            });

            document.getElementById('inventoryFilter').addEventListener('change', function () {
                console.log('Filtering by:', this.value);
            });
            document.getElementById('inventoryTimeRange').addEventListener('change', function () {
                console.log('Loading data for:', this.value);
            });


        }
    });




</script>


<script>
    function showFarmerList() {
        document.getElementById('farmerRegistrationForm').style.display = 'none';
        document.getElementById('registeredFarmersList').style.display = 'block';
    }

    function showRegistrationForm() {
        document.getElementById('farmerRegistrationForm').style.display = 'block';
        document.getElementById('registeredFarmersList').style.display = 'none';
    }

    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('farmerRegistrationForm');
        const list = document.getElementById('registeredFarmersList');
        if (form && list) {
            list.style.display = 'none';
            form.style.display = 'block';
        }
    });
</script>

</body>

</html>